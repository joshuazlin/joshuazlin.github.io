{"version":3,"sources":["HuesCanvas.js","HuesCore.js","HuesEditor.js","HuesInfo.js","HuesSettings.js","HuesUI.js","HuesWindow.js","ResourceManager.js","ResourcePack.js","SoundManager.js","string_score.min.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","window","document","HuesCanvas","root","soundManager","core","this","audio","addEventListener","resetEffects","bind","setImage","setColour","beat","setInvert","settingsUpdated","animationLoop","needsRedraw","colour","image","smartAlign","animTimeout","animFrame","lastBeat","blurDecay","blurAmount","blurIterations","blurDelta","blurAlpha","blurStart","blurDistance","xBlur","yBlur","sliceDistance","sliceStart","slices","x","makeSliceObj","y","trippyStart","trippyRadii","trippyOn","trippyRadius","blackout","blackoutColour","blackoutTimeout","invert","colourFade","colourFadeStart","colourFadeLength","oldColour","newColour","blendMode","setBlurAmount","setBlurQuality","setBlurDecay","canvas","createElement","context","getContext","width","height","className","appendChild","offCanvas","offContext","resize","value","avgSegments","count","segments","distances","setSmartAlign","localStorage","clientHeight","ratio","clientWidth","Math","min","ceil","max","offset","bOpacity","cTime","currentTime","globalAlpha","globalCompositeOperation","blackoutStart","fillStyle","fillRect","drawInvert","bitmap","bitmaps","animated","drawHeight","drawWidth","align","drawSlice","drawBlur","drawImage","drawTrippy","intToHex","clearRect","bitmapXOffset","drawXOffset","xSegment","sliceXDistance","segmentBitmapWidth","segmentDrawWidth","bitmapYOffset","drawYOffset","j","ySegment","sliceYDistance","segmentBitmapHeight","segmentDrawHeight","floor","baseInvert","invertC","normalC","sort","a","b","beginPath","arc","PI","fill","closePath","num","toString","slice","delta","fadeVal","stopFade","mixColours","clearBlackout","beatsPerAnim","currentSong","charsPerBeat","syncAnim","frameDurations","exp","dist","blurUpdated","transitionPercent","now","sliceRampUp","sliceTransitionTime","sliceRampDown","longTransition","endEffect","redraw","animBeat","song","index","beatIndex","getBeatLength","interp","beatLoc","aLen","syncOffset","isFade","c","whiteout","userInterface","hide","show","beatTime","doInstantBlackout","doBlackout","pow","percent","oldR","oldG","oldB","newR","newG","newB","mixR","mixG","mixB","saveTrippy","doXBlur","doYBlur","beatLength","beatCount","sliceX","sliceY","transitionTime","generateSliceSegments","resetSliceSegments","direction","even","spread","total","rando","random","decay","slow","medium","fast","faster!","quality","low","high","extreme","amount","HuesCore","defaults","_this","eventListeners","loaded","time","blurupdate","newsong","newimage","newcolour","newmode","frame","songstarted","settingsupdated","version","versionStr","toFixed","versionHex","buildLength","loopLength","currentImage","songIndex","imageIndex","lastSongArray","lastImageArray","colourIndex","colours","oldColours","isFullAuto","loopCount","doBuildup","uiArray","getElementById","body","classList","add","documentElement","innerHTML","makePreloader","onerror","msg","url","line","col","error","settings","HuesSettings","zip","workerScriptsPath","workersPath","HuesWindow","console","log","resourceManager","Resources","editor","HuesEditor","initUI","populateHuesInfo","selectTab","firstWindow","ui","push","RetroUI","WeedUI","ModernUI","XmasUI","HalloweenUI","MinimalUI","autoSong","visualiser","vCtx","SoundManager","init","then","locked","getSizes","respacks","sizes","size","reduce","prev","curr","warning","unlock","clearMessage","setInterval","loopCheck","renderer","load","addAll","progress","preloader","style","backgroundPosition","scale","preloadMax","padding","preloadBase","preloadMsg","textContent","preloadPrefix","Array","join","display","callEventListeners","firstImage","setImageByName","autoplay","firstSong","setSongByName","setSong","disableKeyboard","e","event","defaultPrevented","altKey","ctrlKey","metaKey","shiftKey","tagName","toLowerCase","type","contentEditable","keyCode","which","keyHandler","ev","args","call","arguments","forEach","callback","apply","Error","filter","preloadTitle","preloadSubMsg","initVisualiser","logArrays","getVisualiserData","gradient","createLinearGradient","addColorStop","barWidth","barHeight","vals","requestAnimationFrame","playing","updateVisualiser","clampedTime","buildupPlayed","getBeat","beater","forcedNow","build","buildupRhythm","rhythm","mapSoFar","match","invertCount","getBeatIndex","enabledSongs","name","songs","bestSong","bestScore","score","title","leaveArray","_this2","undefined","source","crc","sound","enabled","filename","buildup","playSong","resetAudio","fillBuildup","updateBeatLength","independentBuild","buildBeats","recalcBeatIndex","songCount","indexOf","randomSong","noRepeat","shift","onLoop","doAutoSong","_this3","func","nextSong","fadeOut","songDataUpdated","len","enabledImages","randomImage","cull","img","fullname","images","setIsFullAuto","randomColourIndex","getBeatString","doTrippyX","doTrippyY","doShortBlackout","randomColour","doColourFade","timeToNextBeat","doSlice","charsToNextBeat","toggleInvert","maxSearch","nextBeat","playbackRate","beatString","auto","hideLists","disconnect","connectCore","changeUI","pastelColours","weedColours","remove","vReady","rebuildEnabled","toggleSongList","toggleImageList","open","previousImage","nextImage","previousSong","decreaseVolume","increaseVolume","seek","toggleMute","toggleHide","set","toggle","message","color","n","WAVE_PIXELS_PER_SECOND","WAVE_HEIGHT_PIXELS","huesWin","buildEditSize","buildEdit","loopEdit","editArea","wrapAt","hilightWidth","hilightHeight","undoBuffer","redoBuffer","batchUndoArray","buildWave","loopWave","buildWaveBuff","loopWaveBuff","waveContext","waveCanvas","respack","linked","enableWindow","onBeat","onNewSong","addTab","titleButtons","saveBtn","createButton","saveXML","copyBtn","copyXML","undoBtn","undo","redoBtn","redo","help","backgroundColor","statusMsg","topBar","uiCreateInfo","uiCreateImport","uiCreateEditArea","uiCreateControls","uiCreateVisualiser","preventDefault","noHilightCalc","innerHeight","boxHeight","offsetHeight","bHeadHeight","_header","lHeadHeight","handleHeight","resizeHandle","minHeight","maxHeight","buildHeight","_box","loopHeight","timeLock","hilight","grid","removeChild","updateInfo","updateWaveform","_hilight","map","offsetX","offsetY","left","top","_beatmap","_beatCount","regex","RegExp","replace","seekStart","seekLoop","_removeBtn","_locker","loopLen","buildLen","beatLen","_fileInput","files","newSong","newlyLinked","_sound","getOther","file","blobToArrayBuffer","buffer","testSong","test","loadBuffer","noExt","buildupName","getText","setText","setIndependentBuild","alert","_rhythm","reflow","stop","updateHalveDoubleButtons","blob","Promise","resolve","reject","fr","FileReader","onload","result","readAsArrayBuffer","Respack","author","description","addPack","rebuildArrays","setSongOject","newSongBtn","fromSongBtn","disabled","clearUndoRedo","updateIndependentBuild","setLocked","hasBuild","hasLoop","indep","lock","_locked","trimUndo","updateUndoUI","oldText","newText","undoObj","songVar","text","undoRedo","from","to","fromArray","pop","toArray","fromData","commit","batchUndo","other","halveBeats","commitUndo","doubleBeats","_halveBtn","_doubleBtn","txtLen","label","subtitle","parent","div","caption","container","input","extraClass","button","contains","stopPropagation","stopImmediatePropagation","toUpperCase","info","songUpdate","createTextInput","oninput","_this4","imports","songEdits","fromSong","songInfos","uiCreateSongStat","valueSpan","_this5","locker","uiCreateSingleEditor","_seek","handleContainer","handle","editTop","getBoundingClientRect","handleSize","resizer","clientY","mouseup","removeEventListener","soundName","rhythmName","_this6","header","nameLabel","_lockedBtn","textLen","rightHeader","fileInput","accept","multiple","onchange","loadAudio","click","removeAudio","editBox","beatmap","spellcheck","textUpdated","oncontextmenu","rightClick","beatHilight","_this7","controls","changeRate","change","rate","setRate","newRate","playRateLab","speedControl","speedDown","speedUp","wrapControl","wrapLab","parseInt","wave","drawWave","coords","getTextCoords","caret","totalLen","setCaret","seekTime","bLen","el","isNaN","offsetLeft","offsetTop","scrollLeft","scrollTop","offsetParent","clientX","caretFromEnd","getCaret","newLen","round","otherMap","wasLocked","pushUndo","onbeforeunload","confirmLeave","editable","sel","getSelection","rangeCount","range","getRangeAt","childNodes","commonAncestorContainer","endOffset","createRange","setStart","collapse","removeAllRanges","addRange","otherLock","renderWave","loop","samplesPerPixel","sampleRate","waveData","numberOfChannels","getChannelData","channels","pixel","halfHeight","avgHi","avgLo","chan","sample","maxPix","minPix","strokeStyle","moveTo","lineTo","stroke","maxAvg","minAvg","timespan","minTime","maxTime","drawTime","drawOffset","waveOffset","drawOneWave","err","loopPoints","drawWaveBar","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","point","lineWidth","offsetWidth","xml","generateXML","element","setAttribute","encodeURIComponent","textArea","select","success","execCommand","huesName","about","addReference","beatGlossary","shortcuts","titleText","list","ref","listElem","elem","item","defaultSettings","respackPath","overwriteLocal","disableRemoteResources","showWindow","blurQuality","currentUI","colourSet","blackoutUI","playBuildups","shuffleImages","autoSongDelay","autoSongShuffle","autoSongFadeout","trippyMode","volume","skipPreloader","ephemeralSettings","settingsCategories","Functionality","Graphics","Visuals","Interface","settingsOptions","options","variable","inputType","visiblity","ret","updated","hasUI","settingCheckboxes","textCallbacks","visCallbacks","attr","hasOwnProperty","querySettings","getQuerySettings","concat","results","query","location","search","substring","vars","split","pair","packs","intValidator","self","updateConditionals","cat","catContainer","cats","_loop","setName","setContainer","setting","buttonContainer","option","checkbox","unique","id","checked","onclick","htmlFor","autofocus","visibility","opt","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","getPrototypeOf","getter","HuesUI","imageName","imageLink","songName","songLink","hueName","imagePrev","imageNext","songPrev","songNext","timer","settingsToggle","hideToggle","callbacks","listContainer","visualiserContainer","hidden","songList","imageList","addCoreCallback","newImage","updateTime","resizeHandler","listView","firstElementChild","vol","href","pad","str","abs","prefix","_HuesUI","mode","beatBar","imageMode","imageModeManual","imageModeAuto","subControl","subControls","hideRestore","newMode","isAuto","beats","rest","resizeVisualiser","_RetroUI","_RetroUI2","xVariance","yVariance","beatLeft","beatRight","beatCenter","rot","round10","transform","MozTransform","webkitTransform","setTimeout","removeBeat","_HuesUI2","textSize_normal","textSize_small","songLink_size","imageLink_size","currentBeat","_this8","leftBox","volCluster","volBar","volLabel","infoToggle","step","volInput","setVolume","parseFloat","rightBox","songBlock","songControls","songShuffle","imageBlock","imageControls","toggleFullAuto","leftInfo","rightInfo","span","ownerDocument","oldContent","textWidth","resizeSong","resizeImage","parentSize","chars","resizeElement","_ModernUI","_this9","initSnow","lights","wires","xleft","l","light","newLight","angle","right","xright","bottomHelper","bottom","xbottom","snowContext","startSnow","stopSnow","on","off","hue","lightOn","lightOff","bulb","randomLight","lightRecolour","lightFadeOut","snowCanvas","snowing","maxSnow","snowAngle","lastSnow","snowflakes","drawSnow","r","d","Date","flake","cos","sin","innerWidth","savedFill","_ModernUI2","_this10","leftBoxTomb","songTomb","insertBefore","firstChild","imageTomb","topLeft","topRight","bottomRight","leftHand","rightHand","vignette","eyes","windowshown","tabselected","actualWindow","closeButton","tabContainer","contentContainer","contents","tabs","tabNames","tabName","tabContent","content","dontShowWin","TAB_SONGS","TAB_IMAGES","getAndIncrementUnique","packsURL","resourcePacks","allSongs","allImages","progressState","progressCallback","enabledSongList","enabledImageList","packView","pack","creator","imageCount","packButtons","totalSongs","totalImages","packsView","respackList","remoteList","loadRemote","progressBar","progressStatus","progressCurrent","progressTop","progressPercent","currentTab","remotes","fileParseQueue","urls","promises","p","xhr","XMLHttpRequest","onreadystatechange","readyState","DONE","bytes","getResponseHeader","req","status","send","code","all","Number","valueOf","respackPromises","progressFunc","updateProgress","loadFromURL","sequence","packPromise","addResourcesToArrays","updateTotals","appendListItem","selectPack","allAnimations","appendSimpleListItem","splice","names","loadFromBlob","localProgress","localComplete","filesLoaded","filesToLoad","progStat","packsContainer","packHeader","packList","remoteHeader","loadRemotes","buttons","loadCurrentRemote","loadLocal","progressContainer","progressFilled","progressTexts","indivView","packName","packInfo","packCreator","packCreatorText","packSize","packDesc","enableAll","disableAll","totalCounts","totalSongsCont","totalSongsLabel","totalImagesCont","totalImagesLabel","me","toggleVisible","link","truncateNum","selectResourceCallback","clickResourceCallback","res","isSong","arr","elName","tab","getEnabledTabContents","oncheck","checkStyler","responseType","response","populateRemotes","selectRemotePack","songcount","imagecount","moreSongs","moreImages","remoteProgress","remoteComplete","downloaded","debug","debugConsole","audioExtensions","imageExtensions","songQueue","imageQueue","_xmlQueue","totalFiles","loadedFromURL","override","getBlob","onprogress","lengthComputable","fs","FS","importBlob","parseZip","entries","directory","parseFile","parseSongQueue","parseImageQueue","parseXML","parseSong","parseImage","endsWith","loadXML","containsSong","extension","mime","oldSong","getSong","songPromise","getImage","containsImage","existing","loadImage","imgFile","imageObj","getData64URI","imagePromise","newImg","Image","src","parser","DOMParser","dom","parseFromString","nodeName","parseSongFile","parseImageFile","parseInfoFile","newSongs","nextElementSibling","attributes","getTag","forceTrim","newImages","frameDur","strSplit","localeCompare","Element","tag","def","t","getElementsByTagName","initPromise","lockedPromise","oggSupport","buildSource","loopSource","startTime","gainNode","mute","lastVol","vBars","vTotalBars","splitter","analysers","analyserArrays","binCutoffs","linBins","logBins","maxBinLin","AudioContext","webkitAudioContext","suspend","resume","createGain","connect","destination","decodeAudioData","miniOgg","audioWorker","createWorker","pingListener","terminate","postMessage","ping","ogg","state","unlocker","createBuffer","createBufferSource","start","playBuild","forcePlay","gain","cancelScheduledValues","setMute","loadSong","buffers","duration","dontDeleteBuffers","noPlayingUpdate","loopStart","loopEnd","_loadPromise","view","Uint8Array","backup","decoded","data","arrayBuffer","audioBufFromRaw","rawAudio","raw","array","samples","audioBuf","channel","Float32Array","copyToChannel","Worker","bars","attachVisualiser","channelCount","createChannelSplitter","analyser","createAnalyser","fftSize","smoothingTimeConstant","minDecibels","maxDecibels","frequencyBinCount","getByteTimeDomainData","binCount","binWidth","logLow","log2","logDiff","cutoff","freqCutoff","binCutoff","getByteFrequencyData","scaled","sumArray","updateVolume","val","setValueAtTime","exponentialRampToValueAtTime","miniOggRaw","miniOggBin","atob","ArrayBuffer","charCodeAt","String","f","g","h","k","m"],"mappings":"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","file":"hues-min.js","sourcesContent":["/* Copyright (c) 2015 William Toohey <will@mon.im>\n * Portions Copyright (c) 2015 Calvin Walton <calvin.walton@kepstin.ca>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n(function(window, document) {\n\"use strict\";\n\n/*  Takes root element to attach to, and an audio context element for\n    getting the current time with reasonable accuracy */\nclass HuesCanvas {\n    constructor(root, soundManager, core) {\n        this.audio = soundManager;\n        soundManager.addEventListener(\"seek\", this.resetEffects.bind(this));\n        core.addEventListener(\"newsong\", this.resetEffects.bind(this));\n        core.addEventListener(\"newimage\", this.setImage.bind(this));\n        core.addEventListener(\"newcolour\", this.setColour.bind(this));\n        core.addEventListener(\"beat\", this.beat.bind(this));\n        core.addEventListener(\"invert\", this.setInvert.bind(this));\n        core.addEventListener(\"settingsupdated\", this.settingsUpdated.bind(this));\n        core.addEventListener(\"frame\", this.animationLoop.bind(this));\n        this.core = core;\n\n        this.needsRedraw = false;\n        this.colour = 0xFFFFFF;\n        this.image = null;\n        this.smartAlign = true; // avoid string comparisons every frame\n\n        this.animTimeout = null;\n        this.animFrame = null;\n        this.lastBeat = 0;\n\n        // set later\n        this.blurDecay = null;\n        this.blurAmount = null;\n        this.blurIterations = null;\n        this.blurDelta = null;\n        this.blurAlpha = null;\n        // dynamic\n        this.blurStart = 0;\n        this.blurDistance = 0;\n        this.xBlur = false;\n        this.yBlur = false;\n        \n        this.sliceDistance = 0;\n        this.sliceStart = 0;\n        this.slices = {\n            x : this.makeSliceObj(25),\n            y : this.makeSliceObj(15)\n        };\n        \n        // trippy mode\n        this.trippyStart = [0, 0]; // x, y\n        this.trippyRadii = [0, 0]; // x, y\n        // force trippy mode\n        this.trippyOn = false;\n        this.trippyRadius = 0;\n\n        this.blackout = false;\n        this.blackoutColour = \"#000\"; // for the whiteout case we must store this\n        this.blackoutTimeout = null;\n        \n        this.invert = false;\n\n        this.colourFade = false;\n        this.colourFadeStart=0;\n        this.colourFadeLength=0;\n        this.oldColour=0xFFFFFF;\n        this.newColour=0xFFFFFF;\n\n        this.blendMode = \"hard-light\";\n        // Chosen because they look decent\n        this.setBlurAmount(\"medium\");\n        this.setBlurQuality(\"high\");\n        this.setBlurDecay(\"fast\");\n        \n        this.canvas = document.createElement('canvas');\n        this.context = this.canvas.getContext(\"2d\");\n        this.canvas.width = 1280;\n        this.canvas.height = 720;\n        this.canvas.className = \"hues-canvas\";\n        root.appendChild(this.canvas);\n        \n        this.offCanvas = document.createElement('canvas');\n        this.offContext = this.offCanvas.getContext('2d');\n        \n        window.addEventListener('resize', this.resize.bind(this));\n        this.resize();\n    }\n    \n    makeSliceObj(avgSegments) {\n        return {\n            count       : 0,\n            avgSegments : avgSegments,\n            segments    : [],\n            distances   : []\n        };\n    }\n\n    setInvert(invert) {\n        this.invert = invert;\n        this.needsRedraw = true;\n    }\n\n    settingsUpdated() {\n        this.setSmartAlign(localStorage[\"smartAlign\"]);\n        this.setBlurAmount(localStorage[\"blurAmount\"]);\n        this.setBlurDecay(localStorage[\"blurDecay\"]);\n        this.setBlurQuality(localStorage[\"blurQuality\"]);\n        this.trippyOn = localStorage[\"trippyMode\"] == \"on\";\n    }\n    \n    resetEffects() {\n        this.colourFadeStart = 0;\n        this.colourFade = false;\n        this.trippyStart = [0, 0];\n        this.sliceStart = 0;\n        this.blurStart = 0;\n        this.blurDistance = 0;\n        this.xBlur = false;\n        this.yBlur = false;\n    }\n\n    resize() {\n        // height is max 720px, we expand width to suit\n        let height = this.core.root.clientHeight;\n        let ratio = this.core.root.clientWidth / height;\n        this.canvas.height = Math.min(height, 720);\n        this.canvas.width = Math.ceil(this.canvas.height * ratio);\n        this.offCanvas.height = this.canvas.height;\n        this.offCanvas.width = this.canvas.width;\n        this.trippyRadius = Math.max(this.canvas.width, this.canvas.height) / 2;\n        this.needsRedraw = true;\n    }\n\n    redraw() {\n        let offset; // for centering/right/left align\n        let bOpacity;\n        let width = this.canvas.width;\n        let height = this.canvas.height;\n\n        let cTime = this.audio.currentTime;\n        // white BG for the hard light filter\n        this.context.globalAlpha = 1;\n        this.context.globalCompositeOperation = \"source-over\";\n        if(this.blackout) {\n            // original is 3 frames at 30fps, this is close\n            bOpacity = (cTime - this.blackoutStart)*10;\n            if(bOpacity > 1) { // optimise the draw\n                this.context.fillStyle = this.blackoutColour;\n                this.context.fillRect(0,0,width,height);\n                this.needsRedraw = false;\n                this.drawInvert();\n                return;\n            }\n        } else {\n            this.context.fillStyle = \"#FFF\";\n            this.context.fillRect(0,0,width,height);\n        }\n\n        if(this.image && (this.image.bitmap || this.image.bitmaps)) {\n            let bitmap = this.image.animated ?\n                this.image.bitmaps[this.animFrame] : this.image.bitmap;\n            let drawHeight = bitmap.height * (height / bitmap.height);\n            let drawWidth = (bitmap.width / bitmap.height) * drawHeight;\n            if(this.smartAlign) {\n                switch(this.image.align) {\n                    case \"left\":\n                        offset = 0;\n                        break;\n                    case \"right\":\n                        offset = width - drawWidth;\n                        break;\n                    default:\n                        offset = width/2 - drawWidth/2;\n                        break;\n                }\n            } else {\n                offset = width/2 - drawWidth/2;\n            }\n            \n            if(this.sliceStart) {\n                bitmap = this.drawSlice(bitmap, drawWidth, drawHeight, width, height);\n                drawWidth = width;\n                drawHeight = height;\n            }\n            \n            if(this.xBlur || this.yBlur) {\n                this.drawBlur(bitmap, offset, drawWidth, drawHeight);\n            }else {\n                this.context.globalAlpha = 1;\n                this.context.drawImage(bitmap, offset, 0, drawWidth, drawHeight);\n            }\n        }\n        \n        if(this.trippyStart[0] || this.trippyStart[1]) {\n            this.drawTrippy(width, height);\n        } else {\n            this.offContext.fillStyle = this.intToHex(this.colour);\n            this.offContext.fillRect(0,0,width,height);\n        }\n        this.context.globalAlpha = 0.7;\n        this.context.globalCompositeOperation = this.blendMode;\n        this.context.drawImage(this.offCanvas, 0, 0);\n        if(this.blackout) {\n            this.context.globalAlpha = bOpacity;\n            this.context.fillStyle = this.blackoutColour;\n            this.context.fillRect(0,0,width,height);\n            this.needsRedraw = true;\n        } else {\n            this.needsRedraw = false;\n        }\n        this.drawInvert();\n    }\n\n    drawInvert() {\n        if(this.invert) {\n            this.context.globalAlpha = 1;\n            this.context.globalCompositeOperation = \"difference\";\n            this.context.fillStyle = \"#FFF\";\n            this.context.fillRect(0,0,this.canvas.width,this.canvas.height);\n        }\n    }\n\n    drawSlice(bitmap, drawWidth, drawHeight, width, height) {\n        this.offContext.clearRect(0,0,width,height);\n\n        let bitmapXOffset = 0;\n        let drawXOffset = 0;\n        for (let i = 0; i < this.slices.x.count; i++) {\n            let xSegment = this.slices.x.segments[i];\n            let sliceXDistance = this.slices.x.distances[i] * this.sliceDistance;\n            let segmentBitmapWidth = Math.ceil(xSegment * bitmap.width);\n            let segmentDrawWidth = Math.ceil(xSegment * drawWidth);\n\n            let bitmapYOffset = 0;\n            let drawYOffset = 0;\n            for (let j = 0; j < this.slices.y.count; j++) {\n                let ySegment = this.slices.y.segments[j];\n                let sliceYDistance = this.slices.y.distances[j] * this.sliceDistance;\n                let segmentBitmapHeight = Math.ceil(ySegment * bitmap.height);\n                let segmentDrawHeight = Math.ceil(ySegment * drawHeight);\n\n                this.offContext.drawImage(bitmap,\n                    bitmapXOffset, bitmapYOffset,            // subsection x, y\n                    segmentBitmapWidth, segmentBitmapHeight, // subsection w, h\n                    drawXOffset + sliceYDistance, drawYOffset + sliceXDistance, // drawn x, y\n                    segmentDrawWidth, segmentDrawHeight);    // drawn w, h\n\n                bitmapYOffset += segmentBitmapHeight;\n                drawYOffset += segmentDrawHeight;\n            }\n\n            bitmapXOffset += segmentBitmapWidth;\n            drawXOffset += segmentDrawWidth;\n        }\n        \n        return this.offCanvas;\n    }\n    \n    drawBlur(bitmap, offset, drawWidth, drawHeight) {\n        this.context.globalAlpha = this.blurAlpha;\n        if(this.xBlur) {\n            if(this.blurIterations < 0) {\n                this.context.globalAlpha = 1;\n                this.context.drawImage(bitmap, Math.floor(offset - this.blurDistance/2), 0,\n                    drawWidth + this.blurDistance, drawHeight);\n            } else {\n                for(let i=-1; i<=1; i+= this.blurDelta) {\n                    this.context.drawImage(bitmap, Math.floor(this.blurDistance * i) + offset, 0, drawWidth, drawHeight);\n                }\n            }\n        } else if(this.yBlur) {\n            if(this.blurIterations < 0) {\n                this.context.globalAlpha = 1;\n                this.context.drawImage(bitmap, offset, Math.floor(-this.blurDistance/2),\n                    drawWidth, drawHeight + this.blurDistance);\n            } else {\n                for(let i=-1; i<=1; i+= this.blurDelta) {\n                    this.context.drawImage(bitmap, offset, Math.floor(this.blurDistance * i), drawWidth, drawHeight);\n                }\n            }\n        }\n    }\n\n    // draws the correct trippy colour circles onto the offscreen canvas\n    drawTrippy(width, height) {\n        // x blur moves inwards from the corners, y comes out\n        // So the base colour is inverted for y, normal for x\n        // Thus if the y start is more recent, we invert\n        let baseInvert = this.trippyStart[1] > this.trippyStart[0];\n        let invertC = this.intToHex(0xFFFFFF ^ this.colour);\n        let normalC = this.intToHex(this.colour);\n        this.offContext.fillStyle = baseInvert ? invertC : normalC;\n        this.offContext.fillRect(0,0,width,height);\n        \n        // sort high to low\n        this.trippyRadii.sort(function(a,b) {\n            return b - a;\n        });\n        \n        let invert = !baseInvert;\n        for(let i = 0; i < 2; i++) {\n            if(this.trippyRadii[i] === 0) {\n                continue;\n            }\n            // Invert for each subsequent draw\n            this.offContext.beginPath();\n            this.offContext.fillStyle = this.intToHex(invert ? invertC : normalC);\n            this.offContext.arc(width/2, height/2, this.trippyRadii[i], 0, 2 * Math.PI, false);\n            this.offContext.fill();\n            this.offContext.closePath();\n            invert = !invert;\n        }\n    }\n\n    /* Second fastest method from\n     http://stackoverflow.com/questions/10073699/pad-a-number-with-leading-zeros-in-javascript\n     It stil does millions of ops per second, and isn't ugly like the integer if/else */\n    intToHex(num) {\n        return '#' + (\"00000\"+num.toString(16)).slice(-6);\n    }\n\n    animationLoop() {\n        if (this.colourFade) {\n            let delta = this.audio.currentTime - this.colourFadeStart;\n            let fadeVal = delta / this.colourFadeLength;\n            if (fadeVal >= 1) {\n                this.stopFade();\n                this.colour = this.newColour;\n            } else {\n                this.mixColours(fadeVal);\n            }\n            this.needsRedraw = true;\n        }\n        if(this.blackoutTimeout && this.audio.currentTime > this.blackoutTimeout) {\n            this.clearBlackout();\n        }\n        if(this.image && this.image.animated){\n            if(this.image.beatsPerAnim && this.core.currentSong && this.core.currentSong.charsPerBeat) {\n                let a = this.animFrame;\n                this.syncAnim();\n                if(this.animFrame != a) {\n                    this.needsRedraw = true;\n                    // If you change to a non-synced song, this needs to be reset\n                    this.animTimeout = this.audio.currentTime;\n                }\n            } else if(this.animTimeout < this.audio.currentTime) {\n                this.animFrame++;\n                this.animFrame %= this.image.frameDurations.length;\n                // Don't rebase to current time otherwise we may lag\n                this.animTimeout += this.image.frameDurations[this.animFrame]/1000;\n                this.needsRedraw = true;\n            }\n        }\n        if(this.blurStart) {\n            // flash offsets blur gen by a frame\n            let delta = this.audio.currentTime - this.blurStart + (1/30);\n            this.blurDistance = this.blurAmount * Math.exp(-this.blurDecay * delta);\n            \n            // Update UI\n            let dist = this.blurDistance / this.blurAmount;\n            if(this.xBlur)\n                this.core.blurUpdated(dist, 0);\n            else\n                this.core.blurUpdated(0, dist);\n        }\n        if(this.sliceStart) {\n            let transitionPercent = 0.8;\n            let delta;\n            let now = this.audio.currentTime;\n            if(now < this.sliceRampUp) {\n                delta = this.sliceRampUp - now;\n                this.sliceDistance = (1-(delta / this.sliceTransitionTime)) * transitionPercent;\n            } else if(now < this.sliceRampDown) {\n                delta = this.sliceRampDown - now;\n                let longTransition = this.sliceRampDown - this.sliceRampUp;\n                this.sliceDistance = transitionPercent + ((1-(delta / longTransition)) * (1-transitionPercent));\n            } else {\n                let endEffect = this.sliceRampDown + this.sliceTransitionTime;\n                if(now > endEffect) {\n                    this.sliceStart = 0;\n                    this.sliceDistance = 0;\n                } else {\n                    delta = endEffect - now;\n                    this.sliceDistance = delta / this.sliceTransitionTime;\n                }\n            }\n            this.needsRedraw = true;\n        }\n        for(let i = 0; i < 2; i++) {\n            if(this.trippyStart[i] || this.trippyRadii[i]) {\n                this.needsRedraw = true;\n                this.trippyRadii[i] = Math.floor((this.audio.currentTime - this.trippyStart[i]) * this.trippyRadius) * 2;\n                if(this.trippyRadii[i] > this.trippyRadius) {\n                    this.trippyStart[i] = 0;\n                    this.trippyRadii[i] = 0;\n                    continue;\n                }\n                // x comes from outside the window\n                if(i % 2 === 0) {\n                    this.trippyRadii[i] = this.trippyRadius - this.trippyRadii[i];\n                }\n            }\n        }\n        \n        if(this.blurStart && this.blurDistance < 1) {\n            this.core.blurUpdated(0, 0);\n            this.blurDistance = 0;\n            this.blurStart = 0;\n            this.xBlur = this.yBlur = false;\n            this.redraw();\n        } else if(this.blurStart) {\n            this.redraw();\n        } else if(this.needsRedraw){\n            this.redraw();\n        }\n    }\n\n    setImage(image) {\n        if(this.image == image) {\n            return;\n        }\n        this.needsRedraw = true;\n        this.image = image;\n        // Null images don't need anything interesting done to them\n        if(!image || (!image.bitmap && !image.bitmaps)) {\n            return;\n        }\n        if(image.animated) {\n            this.animBeat = null;\n            this.animFrame = 0;\n            this.animTimeout = this.audio.currentTime + image.frameDurations[0]/1000;\n            if(image.beatsPerAnim && this.core.currentSong && this.core.currentSong.charsPerBeat) {\n                this.syncAnim();\n            }\n        }\n    }\n\n    beat() {\n        this.lastBeat = this.audio.currentTime;\n    }\n\n    syncAnim() {\n        let song = this.core.currentSong;\n        if(!song) { // fallback to default\n           return;\n        }\n        let index = this.core.beatIndex;\n        // When animation has more frames than song has beats, or part thereof\n        if(this.lastBeat && this.core.getBeatLength()) {\n            let interp = (this.audio.currentTime - this.lastBeat) / this.core.getBeatLength();\n            index += Math.min(interp, 1);\n        }\n        // This loops A-OK because the core's beatIndex never rolls over for a new loop\n        let beatLoc = (index / song.charsPerBeat) % this.image.beatsPerAnim;\n\n        let aLen = this.image.bitmaps.length;\n        this.animFrame = Math.floor(aLen * (beatLoc / this.image.beatsPerAnim));\n        if(this.image.syncOffset) {\n            this.animFrame += this.image.syncOffset;\n        }\n        // Because negative mods are different in JS\n        this.animFrame = ((this.animFrame % aLen) + aLen) % aLen;\n    }\n\n    setColour(colour, isFade) {\n        if(colour.c == this.colour) {\n            return;\n        }\n        if(isFade) {\n            this.newColour = colour.c;\n        } else {\n            this.stopFade();\n            this.colour = colour.c;\n        }\n        this.needsRedraw = true;\n    }\n\n    doBlackout(whiteout) {\n        if(typeof(whiteout) === 'undefined') whiteout = false;\n        if(whiteout) {\n            this.blackoutColour = \"#FFF\";\n        } else {\n            this.blackoutColour = \"#000\";\n        }\n        this.blackoutTimeout = 0; // indefinite\n        // Don't restart the blackout animation if we're already blacked out\n        if(!this.blackout) {\n            this.blackoutStart = this.audio.currentTime;\n        }\n        this.blackout = true;\n        this.needsRedraw = true;\n        if(localStorage[\"blackoutUI\"] == \"on\") {\n            this.core.userInterface.hide();\n        }\n    }\n\n    clearBlackout() {\n        this.blackout = false;\n        this.blackoutTimeout = 0;\n        this.needsRedraw = true;\n        if(localStorage[\"blackoutUI\"] == \"on\") {\n            this.core.userInterface.show();\n        }\n    }\n\n    doShortBlackout(beatTime) {\n        // looks better if we go right to black\n        this.doInstantBlackout();\n        this.blackoutTimeout = this.audio.currentTime + beatTime / 1.7;\n    }\n    \n    doInstantBlackout() {\n        this.doBlackout();\n        // sufficiently negative\n        this.blackoutStart = -Math.pow(2, 32);\n    }\n\n    doColourFade(length) {\n        this.colourFade = true;\n        this.colourFadeLength = length;\n        this.colourFadeStart = this.audio.currentTime;\n        this.oldColour = this.colour;\n    }\n\n    stopFade() {\n        this.colourFade = false;\n        this.colourFadeStart = 0;\n        this.colourFadeLength = 0;\n    }\n\n    mixColours(percent) {\n        percent = Math.min(1, percent);\n        let oldR = this.oldColour >> 16 & 0xFF;\n        let oldG = this.oldColour >> 8  & 0xFF;\n        let oldB = this.oldColour       & 0xFF;\n        let newR = this.newColour >> 16 & 0xFF;\n        let newG = this.newColour >> 8  & 0xFF;\n        let newB = this.newColour       & 0xFF;\n        let mixR = oldR * (1 - percent) + newR * percent;\n        let mixG = oldG * (1 - percent) + newG * percent;\n        let mixB = oldB * (1 - percent) + newB * percent;\n        this.colour = mixR << 16 | mixG << 8 | mixB;\n    }\n\n    doXBlur() {\n        this.blurStart = this.audio.currentTime;\n        if(this.trippyOn)\n            this.trippyStart[0] = this.blurStart;\n        this.blurDistance = this.blurAmount;\n        this.xBlur = true;\n        this.yBlur = false;\n        this.needsRedraw = true;\n    }\n\n    doYBlur() {\n        this.blurStart = this.audio.currentTime;\n        if(this.trippyOn)\n            this.trippyStart[1] = this.blurStart;\n        this.blurDistance = this.blurAmount;\n        this.xBlur = false;\n        this.yBlur = true;\n        this.needsRedraw = true;\n    }\n\n    doTrippyX() {\n        let saveTrippy = this.trippyOn;\n        // force trippy\n        this.trippyOn = true;\n        this.doXBlur();\n        this.trippyOn = saveTrippy;\n    }\n\n    doTrippyY() {\n        let saveTrippy = this.trippyOn;\n        // force trippy\n        this.trippyOn = true;\n        this.doYBlur();\n        this.trippyOn = saveTrippy;\n    }\n    \n    doSlice(beatLength, beatCount, sliceX, sliceY) {\n        let transitionTime = Math.min(0.06, beatLength);\n        \n        this.sliceStart = this.audio.currentTime;\n        this.sliceRampUp = this.sliceStart + transitionTime;\n        this.sliceRampDown = this.sliceStart + (beatLength * beatCount) - transitionTime;\n        this.sliceTransitionTime = transitionTime;\n        \n        if (sliceX)\n            this.generateSliceSegments('x');\n        else\n            this.resetSliceSegments('x');\n        if (sliceY)\n            this.generateSliceSegments('y');\n        else\n            this.resetSliceSegments('y');\n\n        this.needsRedraw = true;\n    }\n    \n    generateSliceSegments(direction) {\n        let even = 1.0 / this.slices[direction].avgSegments;\n        let spread = even / 2;\n        let total = 0;\n        let i;\n        for(i = 0; ; i++) {\n            let rando = even + Math.random() * spread * 2 - spread;\n            this.slices[direction].segments[i] = rando;\n            total += rando;\n            \n            this.slices[direction].distances[i] =\n                Math.random() * this.blurAmount - this.blurAmount / 2;\n            \n            if(total > 1.0) {\n                this.slices[direction].segments[i] -= total - 1.0;\n                break;\n            }\n        }\n        \n        this.slices[direction].count = i + 1;\n    }\n\n    resetSliceSegments(direction) {\n        this.slices[direction].count = 1;\n        this.slices[direction].segments[0] = 1;\n        this.slices[direction].distances[0] = 0;\n    }\n\n    setBlurDecay(decay) {\n        this.blurDecay = {\"slow\" : 7.8, \"medium\" : 14.1, \"fast\" : 20.8, \"faster!\" : 28.7}[decay];\n    }\n\n    setBlurQuality(quality) {\n        this.blurIterations = {\"low\" : -1, \"medium\" : 11, \"high\" : 19, \"extreme\" : 35}[quality];\n        this.blurDelta = 1 / (this.blurIterations/2);\n        this.blurAlpha = 1 / (this.blurIterations/2);\n    }\n\n    setBlurAmount(amount) {\n        this.blurAmount = {\"low\" : 48, \"medium\" : 96, \"high\" : 384}[amount];\n    }\n\n    setSmartAlign(align) {\n        this.smartAlign = align == \"on\";\n    }\n}\n\nwindow.HuesCanvas = HuesCanvas;\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n/* We don't  want localstorage variables 'optimised' to different identifiers*/\n/*jshint -W069 */\n\n(function(window, document) {\n\"use strict\";\n\nclass HuesCore {\n    constructor(defaults) {\n        this.eventListeners = {\n            /* callback loaded()\n             *\n             * When everything has completely loaded and we're ready to go\n             */\n            loaded : [],\n            \n            /* callback time(seconds)\n             *\n             * When the song time is updated - negative for buildup\n             * Returns a floating point number denoting seconds\n             */\n            time : [],\n            \n            /* callback blurUpdate(xPercent, yPercent)\n             *\n             * The current blur amounts, in percent of full blur\n             */\n            blurupdate : [],\n            \n            /* callback newsong(song)\n             *\n             * Called on song change, whether user triggered or autosong.\n             * Song object is passed.\n             */\n            newsong : [],\n            \n            /* callback newimage(image)\n             *\n             * Called on image change, whether user triggered or FULL AUTO mode.\n             * Image object is passed.\n             */\n            newimage : [],\n            \n            /* callback newcolour(colour, isFade)\n             *\n             * Called on colour change.\n             * colour: colour object.\n             * isFade: if the colour is fading from the previous value\n             */\n            newcolour : [],\n            \n            /* callback newmode(mode)\n             *\n             * Called on mode change.\n             * Mode is passed as a boolean.\n             */\n            newmode : [],\n            \n            /* callback beat(beatString, beatIndex)\n             *\n             * Called on every new beat.\n             * beatString is a 256 char long array of current and upcoming beat chars\n             * beatIndex is the beat index. Negative during buildups\n             */\n            beat : [],\n            \n            /* callback invert(isInverted)\n             *\n             * Called whenever the invert state changes.\n             * Invert state is passed as a boolean.\n             */\n            invert : [],\n            \n            /* callback frame()\n             *\n             * Called on each new frame, at the end of all other frame processing\n             */\n            frame : [],\n            \n            /* callback songstarted(song)\n             *\n             * Called when the song actually begins to play, not just when the\n             * new song processing begins. Song object passed.\n             */\n            songstarted : [],\n            \n            /* callback settingsupdated()\n             *\n             * Called when settings are updated and should be re-read from localStorage\n             */\n            settingsupdated : []\n        };\n\n        // Bunch-o-initialisers\n        this.version = 33;\n        this.versionStr = (this.version/10).toFixed(1);\n        this.versionHex = this.version.toString(16);\n        this.beatIndex = 0;\n        \n        // How long a beat lasts for in each section\n        this.buildLength = -1;\n        this.loopLength = -1;\n        \n        this.currentSong = null;\n        this.currentImage = null;\n        this.songIndex = -1;\n        this.imageIndex = -1;\n        this.lastSongArray = [];\n        this.lastImageArray = [];\n        \n        this.colourIndex = 0x3f;\n        this.colours = HuesCore.oldColours;\n        \n        this.isFullAuto = true;\n        this.invert = false;\n        this.loopCount = 0;\n        this.doBuildup = true;\n        this.userInterface = null;\n        this.uiArray = [];\n        \n        // What's our root element?\n        this.root = null;\n        if(!defaults.root) {\n            this.root = document.body;\n        } else if(typeof defaults.root === \"string\") {\n            if(defaults.root && document.getElementById(defaults.root)) {\n                this.root = document.getElementById(defaults.root);\n            } else {\n                this.root = document.body;\n            }\n        } else { // been given an element\n            this.root = defaults.root;\n        }\n        this.root.classList.add(\"hues-root\");\n        // Special case for full page Hues\n        if(this.root === document.body) {\n            document.documentElement.className = \"hues-root\";\n        }\n        // Yes, we do indeed have Javascript\n        this.root.innerHTML = \"\";\n        \n        this.makePreloader(this.root, defaults);\n\n        window.onerror = (msg, url, line, col, error) => {\n            this.error(msg);\n            // Get more info in console\n            return false;\n        };\n        \n        this.settings = new HuesSettings(defaults);\n        // Update with merged defaults\n        defaults = this.settings.defaults;\n        zip.workerScriptsPath = defaults.workersPath;\n        \n        this.window = new HuesWindow(this.root, defaults);\n        \n        console.log(\"0x40 Hues v\" + this.versionStr + \" - start your engines!\");\n        \n        this.resourceManager = new Resources(this, this.window);\n        this.editor = new HuesEditor(this, this.window);\n        this.settings.initUI(this.window);\n        populateHuesInfo(this.versionStr, this.window, defaults);\n        \n        this.window.selectTab(defaults.firstWindow, true);\n\n        let ui = document.createElement(\"div\");\n        ui.className = \"hues-ui\";\n        this.root.appendChild(ui);\n        this.uiArray.push(new RetroUI(ui), new WeedUI(ui), new ModernUI(ui),\n                          new XmasUI(ui), new HalloweenUI(ui), new MinimalUI(ui));\n        \n        this.autoSong = localStorage[\"autoSong\"];\n        \n        this.visualiser = document.createElement(\"canvas\");\n        this.visualiser.className = \"hues-visualiser\";\n        this.visualiser.height = \"64\";\n        this.vCtx = this.visualiser.getContext(\"2d\");\n        \n        this.soundManager = new SoundManager(this);\n        \n        this.soundManager.init().then(() => {\n            if(!this.soundManager.locked && localStorage[\"skipPreloader\"] == \"on\") {\n                return null;\n            } else {\n                return this.resourceManager.getSizes(defaults.respacks);\n            }\n        }).then( sizes => {\n            if(sizes === null) {\n                return;\n            }\n            \n            let size = sizes.reduce( (prev, curr) => {\n                return typeof curr === 'number' ? prev + curr : null;\n            }, 0);\n            if(typeof size === 'number') {\n                size = size.toFixed(1);\n            } else {\n                size = '<abbr title=\"Content-Length header not present for respack URLs\">???</abbr>';\n            }\n            \n            let warning = size + \"MB of music/images.<br />\" +\n                \"Flashing lights.<br />\" +\n                \"<b>Tap or click to start</b>\";\n                \n            if(!this.soundManager.locked) {\n                warning += \"<br /><span>Skip this screen from Options</span>\";\n            }\n            this.warning(warning);\n            // Even if not locked, this steals clicks which is useful here\n            return this.soundManager.unlock();\n        }).then(() => {\n            this.clearMessage();\n            setInterval(this.loopCheck.bind(this), 1000);\n            this.renderer = new HuesCanvas(this.root, this.soundManager, this);\n            // Now all our objects are instantiated, we fire the updated settings\n            this.settings.addEventListener(\"updated\", this.settingsUpdated.bind(this));\n            this.settingsUpdated();\n            this.setColour(this.colourIndex);\n            this.animationLoop();\n            \n            if(defaults.load) {\n                return this.resourceManager.addAll(defaults.respacks, progress => {\n                    this.preloader.style.backgroundPosition = (100 - progress*100) + \"% 0%\";\n                    let scale = Math.floor(progress * defaults.preloadMax);\n                    let padding = defaults.preloadMax.toString(defaults.preloadBase).length;\n                    this.preloadMsg.textContent = defaults.preloadPrefix + (Array(padding).join(\"0\")+scale.toString(defaults.preloadBase)).slice(-padding);\n                });\n            } else {\n                this.preloader.style.display = \"none\";\n                return;\n            }\n        }).then(() => {\n            this.preloader.classList.add(\"hues-preloader--loaded\");\n            this.callEventListeners(\"loaded\");\n            if(defaults.firstImage) {\n                this.setImageByName(defaults.firstImage);\n            } else {\n                this.setImage(0);\n            }\n            if(defaults.autoplay) {\n                if(defaults.firstSong) {\n                    this.setSongByName(defaults.firstSong);\n                } else {\n                    this.setSong(0);\n                }\n            }\n        }).catch(error => { // Comment this out to get proper stack traces\n            this.error(error);\n        });\n\n        if(!defaults.disableKeyboard) {\n            document.addEventListener(\"keydown\", e => {\n                e = e || window.event;\n                if(e.defaultPrevented) {\n                    return true;\n                }\n                // Ignore modifiers so we don't steal other events\n                if (e.altKey || e.ctrlKey || e.metaKey || e.shiftKey) {\n                    return true;\n                }\n                // If we've focused a text input, let the input go through!\n                if((e.target.tagName.toLowerCase() == \"input\" && e.target.type == \"text\") ||\n                    e.target.contentEditable === \"true\") {\n                    return true;\n                }\n                let key = e.keyCode || e.which;\n                return this.keyHandler(key);\n            });\n        }\n    }\n\n    callEventListeners(ev) {\n        let args = Array.prototype.slice.call(arguments, 1);\n        this.eventListeners[ev].forEach(function(callback) {\n            callback.apply(null, args);\n        });\n    }\n\n    addEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev].push(callback);\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n\n    removeEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\n                return (a !== callback);\n            });\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n\n    makePreloader(root, defaults) {\n        this.preloader = document.createElement(\"div\");\n        this.preloader.className = \"hues-preloader\";\n        root.appendChild(this.preloader);\n        \n        if(defaults.preloadTitle) {\n            this.preloadTitle = document.createElement(\"div\");\n            this.preloadTitle.className = \"hues-preloader__title\";\n            this.preloadTitle.textContent = defaults.preloadTitle;\n            this.preloader.appendChild(this.preloadTitle);\n        }\n        \n        this.preloadMsg = document.createElement(\"div\");\n        this.preloadMsg.className = \"hues-preloader__text\";\n        this.preloadMsg.textContent = \"Initialising...\";\n        this.preloader.appendChild(this.preloadMsg);\n        \n        this.preloadSubMsg = document.createElement(\"div\");\n        this.preloadSubMsg.className = \"hues-preloader__subtext\";\n        this.preloader.appendChild(this.preloadSubMsg);\n    }\n\n    resizeVisualiser() {\n        this.soundManager.initVisualiser(this.visualiser.width/2);\n    }\n\n    updateVisualiser() {\n        if(localStorage[\"visualiser\"] != \"on\") {\n            return;\n        }\n        \n        let logArrays = this.soundManager.getVisualiserData();\n        if(!logArrays) {\n            return;\n        }\n\n        this.vCtx.clearRect(0, 0, this.vCtx.canvas.width, this.vCtx.canvas.height);\n        \n        let gradient=this.vCtx.createLinearGradient(0,64,0,0);\n        if(this.invert) {\n            gradient.addColorStop(1,\"rgba(20,20,20,0.6)\");\n            gradient.addColorStop(0,\"rgba(255,255,255,0.6)\");\n        } else {\n            gradient.addColorStop(1,\"rgba(255,255,255,0.6)\");\n            gradient.addColorStop(0,\"rgba(20,20,20,0.6)\");\n        }\n        this.vCtx.fillStyle = gradient;\n        \n        let barWidth = 2;\n        let barHeight;\n        let x = 0;\n        for(let a = 0; a < logArrays.length; a++) {\n            let vals = logArrays[a];\n            for(let i = 0; i < vals.length; i++) {\n                let index = 0;\n                if(logArrays.length == 2 && a === 0) {\n                    index = vals.length - i - 1;\n                } else {\n                    index = i;\n                }\n                barHeight = vals[index]/4;\n                \n                this.vCtx.fillRect(x,this.vCtx.canvas.height-barHeight,barWidth,barHeight);\n\n                x += barWidth;\n            }\n        }\n    }\n\n    animationLoop() {\n        requestAnimationFrame(this.animationLoop.bind(this));\n        if(!this.soundManager.playing) {\n            this.callEventListeners(\"frame\");\n            return;\n        }\n        this.updateVisualiser();\n        let now = this.soundManager.currentTime;\n        this.callEventListeners(\"time\", this.soundManager.clampedTime);\n        if(now >= 0 && this.doBuildup) {\n            this.currentSong.buildupPlayed = true;\n        }\n        for(let beatTime = this.beatIndex * this.getBeatLength(); beatTime < now;\n                beatTime = ++this.beatIndex * this.getBeatLength()) {\n            let beat = this.getBeat(this.beatIndex);\n            this.beater(beat);\n        }\n        this.callEventListeners(\"frame\");\n    }\n\n    recalcBeatIndex(forcedNow) {\n        let now = typeof forcedNow === \"number\" ? forcedNow : this.soundManager.currentTime;\n        // getBeatLength isn't updated with the right beatIndex yet\n        this.beatIndex = Math.floor(now / (now < 0 ? this.buildLength : this.loopLength));\n        // beatIndex is NaN, abort\n        if(this.beatIndex != this.beatIndex) {\n            this.setInvert(false);\n            return;\n        }\n        \n        // We should sync up to how many inverts there are\n        let build = this.currentSong.buildupRhythm;\n        let rhythm = this.currentSong.rhythm;\n        let mapSoFar;\n        if(this.beatIndex < 0) {\n            // Clamp to 0 in case we've juuust started\n            mapSoFar = build.slice(0, Math.max(this.beatIndex + build.length, 0));\n        } else {\n            // If the rhythm has an odd number of inverts, don't reset because it\n            // alternates on each loop anyway\n            if((rhythm.match(/i|I/g)||[]).length % 2) {\n                return;\n            }\n            mapSoFar = (build ? build : \"\") + rhythm.slice(0, this.beatIndex);\n        }\n        // If there's an odd amount of inverts thus far, invert our display\n        let invertCount = (mapSoFar.match(/i|I/g)||[]).length;\n        this.setInvert(invertCount % 2);\n    }\n\n    getBeatIndex() {\n        if(!this.soundManager.playing) {\n            return 0;\n        } else if(this.beatIndex < 0) {\n            return this.beatIndex;\n        } else {\n            return this.beatIndex % this.currentSong.rhythm.length;\n        }\n    }\n\n    getSafeBeatIndex() {\n        let index = this.getBeatIndex();\n        if(index < 0) {\n            return 0;\n        } else {\n            return index;\n        }\n    }\n\n    blurUpdated(x, y) {\n        this.callEventListeners(\"blurupdate\", x, y);\n    }\n\n    nextSong() {\n        let index = (this.songIndex + 1) % this.resourceManager.enabledSongs.length;\n        this.setSong(index);\n    }\n\n    previousSong() {\n        let index = ((this.songIndex - 1) + this.resourceManager.enabledSongs.length) % this.resourceManager.enabledSongs.length;\n        this.setSong(index);\n    }\n\n    setSongByName(name) {\n        let songs = this.resourceManager.enabledSongs;\n        let bestSong = 0;\n        let bestScore = 0;\n        for(let i = 0; i < songs.length; i++) {\n            let score = songs[i].title.score(name);\n            if(score > bestScore) {\n                bestScore = score;\n                bestSong = i;\n            }\n        }\n        return this.setSong(bestSong);\n    }\n\n    /* To set songs via reference instead of index - used in HuesEditor */\n    setSongOject(song) {\n        for(let i = 0; i < this.resourceManager.enabledSongs.length; i++) {\n            if(this.resourceManager.enabledSongs[i] === song) {\n                return this.setSong(i);\n            }\n        }\n    }\n\n    setSong(index, leaveArray) {\n        if(this.currentSong == this.resourceManager.enabledSongs[index]) {\n            return;\n        }\n        // When not randoming, clear this\n        if(!leaveArray) {\n            this.lastSongArray = [];\n        }\n        this.lastSongArray.push(index);\n        this.songIndex = index;\n        this.currentSong = this.resourceManager.enabledSongs[this.songIndex];\n        if (this.currentSong === undefined) {\n            this.currentSong = {\"name\":\"None\", \"title\":\"None\", \"rhythm\":\".\", \"source\":null, \"crc\":\"none\", \"sound\":null, \"enabled\":true, \"filename\":\"none\"};\n        }\n        console.log(\"Next song:\", this.songIndex, this.currentSong);\n        this.callEventListeners(\"newsong\", this.currentSong);\n        this.loopCount = 0;\n        if (this.currentSong.buildup) {\n            switch (localStorage[\"playBuildups\"]) {\n            case \"off\":\n                this.currentSong.buildupPlayed = true;\n                this.doBuildup = false;\n                break;\n            case \"on\":\n                this.currentSong.buildupPlayed = false;\n                this.doBuildup = true;\n                break;\n            case \"once\":\n                this.doBuildup = !this.currentSong.buildupPlayed;\n                break;\n            }\n        }\n        this.setInvert(false);\n        this.renderer.doInstantBlackout();\n        return this.soundManager.playSong(this.currentSong, this.doBuildup)\n        .then(() => {\n            this.resetAudio();\n            this.fillBuildup();\n            this.callEventListeners(\"songstarted\", this.currentSong);\n        });\n    }\n\n    updateBeatLength() {\n        this.loopLength = this.soundManager.loopLength / this.currentSong.rhythm.length;\n        if(this.currentSong.buildup) {\n            if (!this.currentSong.buildupRhythm) {\n                this.currentSong.buildupRhythm = \".\";\n            }\n            this.buildLength = this.soundManager.buildLength / this.currentSong.buildupRhythm.length;\n        } else {\n            this.buildLength = -1;\n        }\n    }\n\n    getBeatLength() {\n        if(this.beatIndex < 0) {\n            return this.buildLength;\n        } else {\n            return this.loopLength;\n        }\n    }\n\n    fillBuildup() {\n        // update loop length for flash style filling\n        this.updateBeatLength();\n        if(this.currentSong.buildup) {\n            if(this.currentSong.independentBuild) {\n                console.log(\"New behaviour - separate build/loop lengths\");\n                // Do nothing\n            } else {\n                console.log(\"Flash behaviour - filling buildup\");\n                let buildBeats = Math.floor(this.soundManager.buildLength / this.loopLength);\n                if(buildBeats < 1) {\n                    buildBeats = 1;\n                }\n                while (this.currentSong.buildupRhythm.length < buildBeats) {\n                    this.currentSong.buildupRhythm = this.currentSong.buildupRhythm + \".\";\n                }\n                console.log(\"Buildup length:\", buildBeats);\n            }\n        }\n        // update with a buildup of possibly different length\n        this.updateBeatLength();\n        // If we're in the build or loop this will adjust\n        // If we've lagged a bit, we'll miss the first beat. Rewind!\n        this.recalcBeatIndex(this.doBuildup ? -this.soundManager.buildLength : 0);\n    }\n\n    randomSong() {\n        let songCount = this.resourceManager.enabledSongs.length;\n        let index=Math.floor((Math.random() * songCount));\n        if (songCount > 1 && (index == this.songIndex || this.lastSongArray.indexOf(index) != -1)) {\n            this.randomSong();\n        } else {\n            console.log(\"Randoming a song!\");\n            this.setSong(index, true);\n            let noRepeat = Math.min(5, Math.floor(songCount / 2));\n            while (this.lastSongArray.length > noRepeat && noRepeat >= 0) {\n                this.lastSongArray.shift();\n            }\n        }\n    }\n\n    /* This is its own function because requestAnimationFrame is called very very\n       rarely when the tab is backgrounded. As autoSong is often used to chill with\n       music, it's important to keep checking the loop so songs don't go for too\n       long. */\n    loopCheck() {\n        if(Math.floor(this.soundManager.currentTime / this.soundManager.loopLength) > this.loopCount) {\n            this.onLoop();\n        }\n    }\n\n    onLoop() {\n        this.loopCount++;\n        switch (localStorage[\"autoSong\"]) {\n        case \"loop\":\n            console.log(\"Checking loops\");\n            if (this.loopCount >= localStorage[\"autoSongDelay\"]) {\n                this.doAutoSong();\n            }\n            break;\n        case \"time\":\n            console.log(\"Checking times\");\n            if (this.soundManager.loopLength * this.loopCount >= localStorage[\"autoSongDelay\"] * 60) {\n                this.doAutoSong();\n            }\n            break;\n        }\n    }\n\n    doAutoSong() {\n        let func = null;\n        if(this.resourceManager.enabledSongs.length < 2) {\n            return; // don't move if there's nothing to move to\n        }\n        if(localStorage[\"autoSongShuffle\"] == \"on\") {\n            func = this.randomSong;\n        } else {\n            func = this.nextSong;\n        }\n        if(localStorage[\"autoSongFadeout\"] == \"on\") {\n            this.soundManager.fadeOut(() => {\n                func.call(this);\n            });\n        } else {\n            func.call(this);\n        }\n    }\n\n    songDataUpdated() {\n        if (this.currentSong) {\n            this.callEventListeners(\"newsong\", this.currentSong);\n            this.callEventListeners(\"newimage\", this.currentImage);\n        }\n    }\n\n    resetAudio() {\n        this.beatIndex = 0;\n        this.songDataUpdated();\n        if(localStorage[\"visualiser\"] == \"on\") {\n            this.soundManager.initVisualiser(this.visualiser.width/2);\n        }\n    }\n\n    randomImage() {\n        if(localStorage[\"shuffleImages\"] == \"on\") {\n            let len = this.resourceManager.enabledImages.length;\n            let index = Math.floor(Math.random() * len);\n            if ((index == this.imageIndex || this.lastImageArray.indexOf(index) != -1) && len > 1) {\n                this.randomImage();\n            } else {\n                this.setImage(index, true);\n                this.lastImageArray.push(index);\n                let cull = Math.min(20, Math.floor((len / 2)));\n                while (this.lastImageArray.length > cull && cull >= 0) {\n                    this.lastImageArray.shift();\n                }\n            }\n        } else { // jk, not actually random\n            let img=(this.imageIndex + 1) % this.resourceManager.enabledImages.length;\n            this.setImage(img);\n        }\n    }\n\n    setImage(index, leaveArray) {\n        // If there are no images, this corrects NaN to 0\n        this.imageIndex = index ? index : 0;\n        let img=this.resourceManager.enabledImages[this.imageIndex];\n        if (img == this.currentImage && img !== null) {\n            return;\n        }\n        // When not randoming, clear this\n        if(!leaveArray) {\n            this.lastImageArray = [];\n        }\n        if (img) {\n            this.currentImage = img;\n        } else {\n            this.currentImage = {\"name\":\"None\", \"fullname\":\"None\", \"align\":\"center\", \"bitmap\":null, \"source\":null, \"enabled\":true};\n            this.imageIndex = -1;\n            this.lastImageArray = [];\n        }\n        this.callEventListeners(\"newimage\", this.currentImage);\n    }\n\n    setImageByName(name) {\n        let images = this.resourceManager.enabledImages;\n        for(let i = 0; i < images.length; i++) {\n            if(images[i].name == name || images[i].fullname == name) {\n                this.setImage(i);\n                return;\n            }\n        }\n        this.setImage(0); // fallback\n    }\n\n    nextImage() {\n        this.setIsFullAuto(false);\n        let img=(this.imageIndex + 1) % this.resourceManager.enabledImages.length;\n        this.setImage(img);\n    }\n\n    previousImage() {\n        this.setIsFullAuto(false);\n        let img=((this.imageIndex - 1) + this.resourceManager.enabledImages.length) % this.resourceManager.enabledImages.length;\n        this.setImage(img);\n    }\n\n    randomColourIndex() {\n        let index=Math.floor((Math.random() * this.colours.length));\n        if (index == this.colourIndex) {\n            return this.randomColourIndex();\n        }\n        return index;\n    }\n\n    randomColour(isFade) {\n        let index=this.randomColourIndex();\n        this.setColour(index, isFade);\n    }\n\n    setColour(index, isFade) {\n        this.colourIndex = index;\n        let colour = this.colours[this.colourIndex];\n        this.callEventListeners(\"newcolour\", colour, isFade);\n    }\n\n    getBeat(index) {\n        if(index < 0) {\n            return this.currentSong.buildupRhythm[this.currentSong.buildupRhythm.length+index];\n        } else {\n            return this.currentSong.rhythm[index % this.currentSong.rhythm.length];\n        }\n    }\n\n    beater(beat) {\n        this.callEventListeners(\"beat\", this.getBeatString(), this.getBeatIndex());\n        switch(beat) {\n            case 'X':\n            case 'x':\n                this.renderer.doYBlur();\n                break;\n            case 'O':\n            case 'o':\n                this.renderer.doXBlur();\n                break;\n            case ')':\n                this.renderer.doTrippyX();\n                break;\n            case '(':\n                this.renderer.doTrippyY();\n                break;\n            case '+':\n                this.renderer.doXBlur();\n                this.renderer.doBlackout();\n                break;\n            case '¤':\n                this.renderer.doXBlur();\n                this.renderer.doBlackout(true);\n                break;\n            case '|':\n                this.renderer.doShortBlackout(this.getBeatLength());\n                this.randomColour();\n                break;\n            case ':':\n                this.randomColour();\n                break;\n            case '*':\n                if(this.isFullAuto) {\n                    this.randomImage();\n                }\n                break;\n            case '=':\n                if(this.isFullAuto) {\n                    this.randomImage();\n                }\n                /* falls through */\n            case '~':\n                this.renderer.doColourFade(this.timeToNextBeat());\n                this.randomColour(true);\n                break;\n            case 'S':\n            case 's':\n                this.renderer.doSlice(this.getBeatLength(), this.charsToNextBeat(), false, true);\n                break;\n            case 'V':\n            case 'v':\n                this.renderer.doSlice(this.getBeatLength(), this.charsToNextBeat(), true, false);\n                break;\n            case '@':\n            case '#':\n                this.renderer.doSlice(this.getBeatLength(), this.charsToNextBeat(), true, true);\n                break;\n            case 'I':\n                if (this.isFullAuto) {\n                    this.randomImage();\n                }\n                /* falls through */\n            case 'i':\n                this.toggleInvert();\n                break;\n            }\n            if ([\".\", \"+\", \"|\", \"¤\"].indexOf(beat) == -1) {\n                this.renderer.clearBlackout();\n            }\n            if([\".\", \"+\", \"¤\", \":\", \"*\", \"X\", \"O\", \"~\", \"=\", \"i\", \"I\", \"s\", \"v\", \"#\"].indexOf(beat) == -1) {\n                this.randomColour();\n                if (this.isFullAuto) {\n                    this.randomImage();\n                }\n        }\n    }\n    \n    \n    charsToNextBeat() {\n        // case: fade in build, not in rhythm. Must max out fade timer.\n        let maxSearch = this.currentSong.rhythm.length;\n        if(this.beatIndex < 0) {\n            maxSearch -= this.beatIndex;\n        }\n        let nextBeat;\n        for (nextBeat = 1; nextBeat <= maxSearch; nextBeat++) {\n            if (this.getBeat(nextBeat + this.beatIndex) != \".\") {\n                break;\n            }\n        }\n        return nextBeat;\n    }\n    \n    timeToNextBeat() {\n        return (this.charsToNextBeat() * this.getBeatLength()) / this.soundManager.playbackRate;\n    }\n\n    getBeatString(length) {\n        length = length ? length : 256;\n\n        let beatString = \"\";\n        let song = this.currentSong;\n        if (song) {\n            if(this.beatIndex < 0) {\n                beatString = song.buildupRhythm.slice(\n                        song.buildupRhythm.length + this.beatIndex);\n            } else {\n                beatString = song.rhythm.slice(this.beatIndex % song.rhythm.length);\n            }\n            while (beatString.length < length) {\n                beatString += song.rhythm;\n            }\n        }\n\n        return beatString;\n    }\n\n    setIsFullAuto(auto) {\n        this.isFullAuto = auto;\n        if (this.userInterface) {\n            this.callEventListeners(\"newmode\", this.isFullAuto);\n        }\n    }\n\n    toggleFullAuto() {\n        this.setIsFullAuto(!this.isFullAuto);\n    }\n\n    setInvert(invert) {\n        this.invert = !!invert;\n        this.callEventListeners(\"invert\", invert);\n    }\n\n    toggleInvert() {\n        this.setInvert(!this.invert);\n    }\n\n    respackLoaded() {\n        this.init();\n    }\n\n    changeUI(index) {\n        if (index >= 0 && this.uiArray.length > index && this.userInterface != this.uiArray[index]) {\n            this.hideLists();\n            if(this.userInterface) {\n                this.userInterface.disconnect();\n            }\n            this.userInterface = this.uiArray[index];\n            this.userInterface.connectCore(this);\n            this.callEventListeners(\"newmode\", this.isFullAuto);\n            this.callEventListeners(\"newsong\", this.currentSong);\n            this.callEventListeners(\"newimage\", this.currentImage);\n            this.callEventListeners(\"newcolour\", this.colours[this.colourIndex], false);\n            this.callEventListeners(\"beat\", this.getBeatString(), this.getBeatIndex());\n            this.callEventListeners(\"invert\", this.invert);\n        }\n    }\n\n    settingsUpdated() {\n        this.callEventListeners(\"settingsupdated\");\n        switch (localStorage[\"currentUI\"]) {\n        case \"retro\":\n            this.changeUI(0);\n            break;\n        case \"v4.20\":\n            this.changeUI(1);\n            break;\n        case \"modern\":\n            this.changeUI(2);\n            break;\n        case \"xmas\":\n            this.changeUI(3);\n            break;\n        case \"hlwn\":\n            this.changeUI(4);\n            break;\n        case \"mini\":\n            this.changeUI(5);\n            break;\n        }\n        switch (localStorage[\"colourSet\"]) {\n        case \"normal\":\n            this.colours = HuesCore.oldColours;\n            break;\n        case \"pastel\":\n            this.colours = HuesCore.pastelColours;\n            break;\n        case \"v4.20\":\n            this.colours = HuesCore.weedColours;\n            break;\n        }\n        switch (localStorage[\"blackoutUI\"]) {\n        case \"off\":\n            this.userInterface.show();\n            break;\n        case \"on\":\n            if(this.renderer.blackout) {\n                this.userInterface.hide();\n            }\n            break;\n        }\n        switch (localStorage[\"visualiser\"]) {\n        case \"off\":\n            this.visualiser.classList.add(\"hidden\");\n            break;\n        case \"on\":\n            this.visualiser.classList.remove(\"hidden\");\n            if(!this.soundManager.vReady) {\n                this.soundManager.initVisualiser(this.visualiser.width/2);\n            }\n            break;\n        }\n        if (this.autoSong == \"off\" && localStorage[\"autoSong\"] != \"off\") {\n            console.log(\"Resetting loopCount since AutoSong was enabled\");\n            this.loopCount = 0;\n        }\n        this.autoSong = localStorage[\"autoSong\"];\n    }\n\n    enabledChanged() {\n        this.resourceManager.rebuildEnabled();\n    }\n\n    hideLists() {\n        this.resourceManager.hideLists();\n    }\n\n    toggleSongList() {\n        this.window.hide();\n        this.resourceManager.toggleSongList();\n    }\n\n    toggleImageList() {\n        this.window.hide();\n        this.resourceManager.toggleImageList();\n    }\n\n    openSongSource() {\n        if (this.currentSong && this.currentSong.source) {\n            window.open(this.currentSong.source,'_blank');\n        }\n    }\n\n    openImageSource() {\n        if (this.currentImage && this.currentImage.source) {\n            window.open(this.currentImage.source,'_blank');\n        }\n    }\n\n    keyHandler(key) {\n        switch (key) {\n        case 37: // LEFT\n            this.previousImage();\n            break;\n        case 39: // RIGHT\n            this.nextImage();\n            break;\n        case 38: // UP\n            this.nextSong();\n            break;\n        case 40: // DOWN\n            this.previousSong();\n            break;\n        case 70: // F\n            this.setIsFullAuto(!this.isFullAuto);\n            break;\n        case 109: // NUMPAD_SUBTRACT\n        case 189: // MINUS\n        case 173: // MINUS, legacy\n            this.soundManager.decreaseVolume();\n            break;\n        case 107: // NUMPAD_ADD\n        case 187: // EQUAL\n        case 61: // EQUAL, legacy\n            this.soundManager.increaseVolume();\n            break;\n        case 66: // B\n            this.soundManager.seek(-this.soundManager.buildLength);\n            break;\n        case 77: // M\n            this.soundManager.toggleMute();\n            break;\n        case 72: // H\n            this.userInterface.toggleHide();\n            break;\n        case 82: // R\n            this.window.selectTab(\"RESOURCES\");\n            break;\n        case 69: // E\n            this.window.selectTab(\"EDITOR\");\n            break;\n        case 79: // O\n            this.window.selectTab(\"OPTIONS\");\n            break;\n        case 73: // I\n            this.window.selectTab(\"INFO\");\n            break;\n        case 49: // NUMBER_1\n            this.settings.set(\"currentUI\", \"retro\");\n            break;\n        case 50: // NUMBER_2\n            this.settings.set(\"currentUI\", \"v4.20\");\n            break;\n        case 51: // NUMBER_3\n            this.settings.set(\"currentUI\", \"modern\");\n            break;\n        case 52: // NUMBER_4\n            this.settings.set(\"currentUI\", \"xmas\");\n            break;\n        case 53: // NUMBER_5\n            this.settings.set(\"currentUI\", \"hlwn\");\n            break;\n        case 54: // NUMBER_6\n            this.settings.set(\"currentUI\", \"mini\");\n            break;\n        case 67: // C\n            this.toggleImageList();\n            break;\n        case 83: // S\n            this.toggleSongList();\n            break;\n        case 87: // W\n            this.window.toggle();\n            break;\n        case 78: // N\n            this.randomSong();\n            break;\n        default:\n            return true;\n        }\n        return false;\n    }\n\n    error(message) {\n        console.log(message);\n        this.preloadSubMsg.textContent = message;\n        this.preloadMsg.style.color = \"#F00\";\n    }\n\n    warning(message) {\n        console.log(message);\n        this.preloadSubMsg.innerHTML = message;\n        this.preloadMsg.style.color = \"#F93\";\n    }\n\n    clearMessage() {\n        this.preloadSubMsg.textContent = \"\";\n        this.preloadMsg.style.color = \"\";\n    }\n}\n\nHuesCore.oldColours =\n   [{'c': 0x000000, 'n': 'black'},\n    {'c': 0x550000, 'n': 'brick'},\n    {'c': 0xAA0000, 'n': 'crimson'},\n    {'c': 0xFF0000, 'n': 'red'},\n    {'c': 0x005500, 'n': 'turtle'},\n    {'c': 0x555500, 'n': 'sludge'},\n    {'c': 0xAA5500, 'n': 'brown'},\n    {'c': 0xFF5500, 'n': 'orange'},\n    {'c': 0x00AA00, 'n': 'green'},\n    {'c': 0x55AA00, 'n': 'grass'},\n    {'c': 0xAAAA00, 'n': 'maize'},\n    {'c': 0xFFAA00, 'n': 'citrus'},\n    {'c': 0x00FF00, 'n': 'lime'},\n    {'c': 0x55FF00, 'n': 'leaf'},\n    {'c': 0xAAFF00, 'n': 'chartreuse'},\n    {'c': 0xFFFF00, 'n': 'yellow'},\n    {'c': 0x000055, 'n': 'midnight'},\n    {'c': 0x550055, 'n': 'plum'},\n    {'c': 0xAA0055, 'n': 'pomegranate'},\n    {'c': 0xFF0055, 'n': 'rose'},\n    {'c': 0x005555, 'n': 'swamp'},\n    {'c': 0x555555, 'n': 'dust'},\n    {'c': 0xAA5555, 'n': 'dirt'},\n    {'c': 0xFF5555, 'n': 'blossom'},\n    {'c': 0x00AA55, 'n': 'sea'},\n    {'c': 0x55AA55, 'n': 'ill'},\n    {'c': 0xAAAA55, 'n': 'haze'},\n    {'c': 0xFFAA55, 'n': 'peach'},\n    {'c': 0x00FF55, 'n': 'spring'},\n    {'c': 0x55FF55, 'n': 'mantis'},\n    {'c': 0xAAFF55, 'n': 'brilliant'},\n    {'c': 0xFFFF55, 'n': 'canary'},\n    {'c': 0x0000AA, 'n': 'navy'},\n    {'c': 0x5500AA, 'n': 'grape'},\n    {'c': 0xAA00AA, 'n': 'mauve'},\n    {'c': 0xFF00AA, 'n': 'purple'},\n    {'c': 0x0055AA, 'n': 'cornflower'},\n    {'c': 0x5555AA, 'n': 'deep'},\n    {'c': 0xAA55AA, 'n': 'lilac'},\n    {'c': 0xFF55AA, 'n': 'lavender'},\n    {'c': 0x00AAAA, 'n': 'aqua'},\n    {'c': 0x55AAAA, 'n': 'steel'},\n    {'c': 0xAAAAAA, 'n': 'grey'},\n    {'c': 0xFFAAAA, 'n': 'pink'},\n    {'c': 0x00FFAA, 'n': 'bay'},\n    {'c': 0x55FFAA, 'n': 'marina'},\n    {'c': 0xAAFFAA, 'n': 'tornado'},\n    {'c': 0xFFFFAA, 'n': 'saltine'},\n    {'c': 0x0000FF, 'n': 'blue'},\n    {'c': 0x5500FF, 'n': 'twilight'},\n    {'c': 0xAA00FF, 'n': 'orchid'},\n    {'c': 0xFF00FF, 'n': 'magenta'},\n    {'c': 0x0055FF, 'n': 'azure'},\n    {'c': 0x5555FF, 'n': 'liberty'},\n    {'c': 0xAA55FF, 'n': 'royalty'},\n    {'c': 0xFF55FF, 'n': 'thistle'},\n    {'c': 0x00AAFF, 'n': 'ocean'},\n    {'c': 0x55AAFF, 'n': 'sky'},\n    {'c': 0xAAAAFF, 'n': 'periwinkle'},\n    {'c': 0xFFAAFF, 'n': 'carnation'},\n    {'c': 0x00FFFF, 'n': 'cyan'},\n    {'c': 0x55FFFF, 'n': 'turquoise'},\n    {'c': 0xAAFFFF, 'n': 'powder'},\n    {'c': 0xFFFFFF, 'n': 'white'}];\nHuesCore.pastelColours =\n   [{'c': 0xCD4A4A, 'n': 'Mahogany'},\n    {'c': 0xFAE7B5, 'n': 'Banana Mania'},\n    {'c': 0x9F8170, 'n': 'Beaver'},\n    {'c': 0x232323, 'n': 'Black'},\n    {'c': 0xBC5D58, 'n': 'Chestnut'},\n    {'c': 0xDD9475, 'n': 'Copper'},\n    {'c': 0x9ACEEB, 'n': 'Cornflower'},\n    {'c': 0x2B6CC4, 'n': 'Denim'},\n    {'c': 0xEFCDB8, 'n': 'Desert Sand'},\n    {'c': 0x6E5160, 'n': 'Eggplant'},\n    {'c': 0x1DF914, 'n': 'Electric Lime'},\n    {'c': 0x71BC78, 'n': 'Fern'},\n    {'c': 0xFCD975, 'n': 'Goldenrod'},\n    {'c': 0xA8E4A0, 'n': 'Granny Smith Apple'},\n    {'c': 0x95918C, 'n': 'Gray'},\n    {'c': 0x1CAC78, 'n': 'Green'},\n    {'c': 0xFF1DCE, 'n': 'Hot Magenta'},\n    {'c': 0xB2EC5D, 'n': 'Inch Worm'},\n    {'c': 0x5D76CB, 'n': 'Indigo'},\n    {'c': 0xFDFC74, 'n': 'Laser Lemon'},\n    {'c': 0xFCB4D5, 'n': 'Lavender'},\n    {'c': 0xFFBD88, 'n': 'Macaroni and Cheese'},\n    {'c': 0x979AAA, 'n': 'Manatee'},\n    {'c': 0xFF8243, 'n': 'Mango Tango'},\n    {'c': 0xFDBCB4, 'n': 'Melon'},\n    {'c': 0x1A4876, 'n': 'Midnight Blue'},\n    {'c': 0xFFA343, 'n': 'Neon Carrot'},\n    {'c': 0xBAB86C, 'n': 'Olive Green'},\n    {'c': 0xFF7538, 'n': 'Orange'},\n    {'c': 0xE6A8D7, 'n': 'Orchid'},\n    {'c': 0x414A4C, 'n': 'Outer Space'},\n    {'c': 0xFF6E4A, 'n': 'Outrageous Orange'},\n    {'c': 0x1CA9C9, 'n': 'Pacific Blue'},\n    {'c': 0xC5D0E6, 'n': 'Periwinkle'},\n    {'c': 0x8E4585, 'n': 'Plum'},\n    {'c': 0x7442C8, 'n': 'Purple Heart'},\n    {'c': 0xD68A59, 'n': 'Raw Sienna'},\n    {'c': 0xE3256B, 'n': 'Razzmatazz'},\n    {'c': 0xEE204D, 'n': 'Red'},\n    {'c': 0x1FCECB, 'n': 'Robin Egg Blue'},\n    {'c': 0x7851A9, 'n': 'Royal Purple'},\n    {'c': 0xFF9BAA, 'n': 'Salmon'},\n    {'c': 0xFC2847, 'n': 'Scarlet'},\n    {'c': 0x9FE2BF, 'n': 'Sea Green'},\n    {'c': 0xA5694F, 'n': 'Sepia'},\n    {'c': 0x8A795D, 'n': 'Shadow'},\n    {'c': 0x45CEA2, 'n': 'Shamrock'},\n    {'c': 0xFB7EFD, 'n': 'Shocking Pink'},\n    {'c': 0xECEABE, 'n': 'Spring Green'},\n    {'c': 0xFD5E53, 'n': 'Sunset Orange'},\n    {'c': 0xFAA76C, 'n': 'Tan'},\n    {'c': 0xFC89AC, 'n': 'Tickle Me Pink'},\n    {'c': 0xDBD7D2, 'n': 'Timberwolf'},\n    {'c': 0x17806D, 'n': 'Tropical Rain Forest'},\n    {'c': 0x77DDE7, 'n': 'Turquoise Blue'},\n    {'c': 0xFFA089, 'n': 'Vivid Tangerine'},\n    {'c': 0x8F509D, 'n': 'Vivid Violet'},\n    {'c': 0xEDEDED, 'n': 'White'},\n    {'c': 0xFF43A4, 'n': 'Wild Strawberry'},\n    {'c': 0xFC6C85, 'n': 'Wild Watermelon'},\n    {'c': 0xCDA4DE, 'n': 'Wisteria'},\n    {'c': 0xFCE883, 'n': 'Yellow'},\n    {'c': 0xC5E384, 'n': 'Yellow Green'},\n    {'c': 0xFFB653, 'n': 'Yellow Orange'}];\nHuesCore.weedColours =\n   [{'c': 0x00FF00, 'n': 'Green'},\n    {'c': 0x5A6351, 'n': 'Lizard'},\n    {'c': 0x636F57, 'n': 'Cactus'},\n    {'c': 0x4A7023, 'n': 'Kakapo'},\n    {'c': 0x3D5229, 'n': 'Wet Moss'},\n    {'c': 0x659D32, 'n': 'Tree Moss'},\n    {'c': 0x324F17, 'n': 'Lime Rind'},\n    {'c': 0x7F8778, 'n': 'Flight Jacket'},\n    {'c': 0xBCED91, 'n': 'Green Mist'},\n    {'c': 0x488214, 'n': 'Holly'},\n    {'c': 0x577A3A, 'n': 'Mtn Dew Bottle'},\n    {'c': 0x748269, 'n': 'Seaweed Roll'},\n    {'c': 0x83F52C, 'n': 'Neon Green'},\n    {'c': 0xC0D9AF, 'n': 'Lichen'},\n    {'c': 0xA6D785, 'n': 'Guacamole'},\n    {'c': 0x687E5A, 'n': 'Pond Scum'},\n    {'c': 0x3F602B, 'n': 'Douglas Fir'},\n    {'c': 0x3F6826, 'n': 'Royal Palm'},\n    {'c': 0x646F5E, 'n': 'Seaweed'},\n    {'c': 0x476A34, 'n': 'Noble Fir'},\n    {'c': 0x5DFC0A, 'n': 'Green Led'},\n    {'c': 0x435D36, 'n': 'Spinach'},\n    {'c': 0x84BE6A, 'n': 'Frog'},\n    {'c': 0x5B9C64, 'n': 'Emerald'},\n    {'c': 0x3A6629, 'n': 'Circuit Board'},\n    {'c': 0x308014, 'n': 'Sapgreen'},\n    {'c': 0x31B94D, 'n': 'Pool Table'},\n    {'c': 0x55AE3A, 'n': 'Leaf'},\n    {'c': 0x4DBD33, 'n': 'Grass'},\n    {'c': 0x596C56, 'n': 'Snake'},\n    {'c': 0x86C67C, 'n': '100 Euro'},\n    {'c': 0x7BCC70, 'n': 'Night Vision'},\n    {'c': 0xA020F0, 'n': 'Purple'},\n    {'c': 0x9B30FF, 'n': 'Purple'},\n    {'c': 0x912CEE, 'n': 'Purple'},\n    {'c': 0x7D26CD, 'n': 'Purple'},\n    {'c': 0xAA00FF, 'n': 'Purple'},\n    {'c': 0x800080, 'n': 'Purple'},\n    {'c': 0xA74CAB, 'n': 'Turnip'},\n    {'c': 0x8F5E99, 'n': 'Violet'},\n    {'c': 0x816687, 'n': 'Eggplant'},\n    {'c': 0xCC00FF, 'n': 'Grape'},\n    {'c': 0x820BBB, 'n': 'Wild Violet'},\n    {'c': 0x660198, 'n': 'Concord Grape'},\n    {'c': 0x71637D, 'n': 'Garden Plum'},\n    {'c': 0xB272A6, 'n': 'Purple Fish'},\n    {'c': 0x5C246E, 'n': 'Ultramarine Violet'},\n    {'c': 0x5E2D79, 'n': 'Purple Rose'},\n    {'c': 0x683A5E, 'n': 'Sea Urchin'},\n    {'c': 0x91219E, 'n': 'Cobalt Violet Deep'},\n    {'c': 0x8B668B, 'n': 'Plum'},\n    {'c': 0x9932CD, 'n': 'Dark Orchid'},\n    {'c': 0xBF5FFF, 'n': 'Violet Flower'},\n    {'c': 0xBDA0CB, 'n': 'Purple Candy'},\n    {'c': 0x551A8B, 'n': 'Deep Purple'},\n    {'c': 0xB5509C, 'n': 'Thistle'},\n    {'c': 0x871F78, 'n': 'Dark Purple'},\n    {'c': 0x9C6B98, 'n': 'Purple Ink'},\n    {'c': 0xDB70DB, 'n': 'Orchid'},\n    {'c': 0x990099, 'n': 'True Purple'},\n    {'c': 0x8B008B, 'n': 'Darkmagenta'},\n    {'c': 0xB62084, 'n': \"Harold's Crayon\"},\n    {'c': 0x694489, 'n': 'Purple Rain'},\n    {'c': 0xFFD700, 'n': 'Gold'}];\n    \nwindow.HuesCore = HuesCore;\n\n})(window, document);","/* Copyright (c) William Toohey <will@mon.im>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n \n(function(window, document) {\n\"use strict\";\n\nlet WAVE_PIXELS_PER_SECOND = 100;\nlet WAVE_HEIGHT_PIXELS = 20;\n\nclass HuesEditor {\n    constructor(core, huesWin) {\n        this.buildEditSize = 80; // pixels, including header\n        this.buildEdit = null;\n        this.loopEdit = null;\n        this.editArea = null;\n        this.wrapAt = 32;\n        \n        this.hilightWidth = 0;\n        this.hilightHeight = 0;\n        \n        this.undoBuffer = [];\n        this.redoBuffer = [];\n        // Will be an array if many actions are performed in one undo\n        this.batchUndoArray = null;\n        \n        // For rendering the waveform\n        this.buildWave = null;\n        this.loopWave = null;\n        this.buildWaveBuff = null;\n        this.loopWaveBuff = null;\n        this.waveContext = null;\n        this.waveCanvas = null;\n        \n        // for storing respacks created with \"new\"\n        this.respack = null;\n        // when we're actually following the playing song\n        this.linked = false;\n        \n        this.core = core;\n        if(core.settings.defaults.enableWindow) {\n            this.initUI();\n            core.addEventListener(\"beat\", this.onBeat.bind(this));\n            core.addEventListener(\"newsong\", this.onNewSong.bind(this));\n            huesWin.addTab(\"EDITOR\", this.root);\n        }\n    }\n\n    initUI() {\n        this.root = document.createElement(\"div\");\n        this.root.className = \"editor\";\n        let titleButtons = document.createElement(\"div\");\n        titleButtons.className = \"editor__title-buttons\";\n        this.root.appendChild(titleButtons);\n        this.saveBtn = this.createButton(\"Save XML\", titleButtons, true);\n        this.saveBtn.addEventListener(\"click\", this.saveXML.bind(this));\n        this.copyBtn = this.createButton(\"Copy XML\", titleButtons, true);\n        this.copyBtn.addEventListener(\"click\", this.copyXML.bind(this));\n        this.undoBtn = this.createButton(\"Undo\", titleButtons, true);\n        this.undoBtn.addEventListener(\"click\", this.undo.bind(this));\n        this.redoBtn = this.createButton(\"Redo\", titleButtons, true);\n        this.redoBtn.addEventListener(\"click\", this.redo.bind(this));\n        let help = this.createButton(\"Help?\", titleButtons);\n        help.style.backgroundColor = \"rgba(0,160,0,0.3)\";\n        help.addEventListener(\"click\", () => {\n            window.open(\"https://github.com/mon/0x40-web/tree/master/docs/Editor.md\", '_blank');\n        });\n        \n        this.statusMsg = document.createElement(\"span\");\n        this.statusMsg.className = \"editor__status-msg\";\n        titleButtons.appendChild(this.statusMsg);\n        \n        this.topBar = document.createElement(\"div\");\n        this.topBar.className = \"editor__top-bar\";\n        this.root.appendChild(this.topBar);\n        \n        this.uiCreateInfo();\n        this.uiCreateImport();\n        this.root.appendChild(document.createElement(\"hr\"));\n        this.uiCreateEditArea();\n        this.uiCreateControls();\n        this.uiCreateVisualiser();\n        \n        document.addEventListener(\"keydown\", e => {\n            e = e || window.event;\n            if(e.defaultPrevented) {\n                return true;\n            }\n            let key = e.keyCode || e.which;\n            \n            if (e.ctrlKey) {\n                if(key == 90) { // Z\n                    this.undo();\n                } else if(key == 89) { // Y\n                    this.redo();\n                }\n                if(key == 90 || key == 89) {\n                    e.preventDefault();\n                    return false;\n                }\n            }\n            return true;\n        });\n        \n        window.addEventListener('resize', this.resize.bind(this));\n        // Fix Chrome rendering - redraw on tab load\n        // tabselected passes the name of the selected tab, we force noHilightCalc to false\n        this.core.window.addEventListener(\"tabselected\", this.resize.bind(this, false));\n        this.resize();\n    }\n\n    resize(noHilightCalc) {\n        this.root.style.height = (window.innerHeight - 200) + \"px\";\n        let boxHeight = this.editArea.offsetHeight;\n        let bHeadHeight = this.buildEdit._header.offsetHeight;\n        let lHeadHeight = this.loopEdit._header.offsetHeight;\n        let handleHeight = this.resizeHandle.offsetHeight;\n        let minHeight = bHeadHeight;\n        let maxHeight = boxHeight - handleHeight - lHeadHeight - bHeadHeight;\n        let buildHeight = Math.min(maxHeight, Math.max(minHeight, this.buildEditSize - handleHeight));\n        this.buildEdit.style.height = buildHeight + \"px\";\n        this.buildEdit._box.style.height = (buildHeight - bHeadHeight) + \"px\";\n        let loopHeight = maxHeight - buildHeight + lHeadHeight;\n        this.loopEdit.style.height = loopHeight + \"px\";\n        this.loopEdit._box.style.height = (loopHeight - lHeadHeight) + \"px\";\n        \n        // For window resizing down situation\n        if(this.editArea.offsetHeight != boxHeight) {\n            this.resize();\n        }\n        \n        // Resize the time lock\n        this.timeLock.style.height = (buildHeight + handleHeight) + \"px\";\n        \n        // Save to fix Chrome rendering and to enable right click to seek\n        // We only resize on a window resize event, not when dragging the handle\n        if(!noHilightCalc) {\n            let hilight = document.createElement(\"div\");\n            hilight.className = \"beat-hilight\";\n            // Because clientWidth is rounded, we need to take the average. 100 is plenty.\n            let grid = \"\";\n            // height goes to 99 because we always have 1 line\n            for(let i = 0; i < 99; i++) {\n                grid += \"<br />\";\n            }\n            // width\n            for(let i = 0; i < 100; i++) {\n                grid += \"&nbsp;\";\n            }\n            hilight.innerHTML = grid;\n            this.loopEdit.appendChild(hilight);\n            this.hilightWidth = hilight.clientWidth / 100;\n            this.hilightHeight = hilight.clientHeight / 100;\n            this.loopEdit.removeChild(hilight);\n            \n            this.waveCanvas.width = this.waveCanvas.clientWidth;\n        }\n    }\n\n    getOther(editor) {\n        return editor == this.loopEdit ? this.buildEdit : this.loopEdit;\n    }\n\n    onNewSong(song) {\n        if(this.linked) {\n            if(song == this.song) {\n                // Because you can \"edit current\" before it loads\n                this.updateInfo();\n                this.updateWaveform();\n            } else {\n                this.linked = false;\n                // Clear beat hilight\n                this.buildEdit._hilight.innerHTML = \"&block;\";\n                this.loopEdit._hilight.innerHTML = \"&block;\";\n                this.buildEdit._hilight.className = \"beat-hilight invisible\";\n                this.loopEdit._hilight.className = \"beat-hilight invisible\";\n                // Clear the waveform\n                this.waveContext.clearRect(0, 0, this.waveCanvas.width, WAVE_HEIGHT_PIXELS);\n            }\n        } else if(song == this.song) { // went to another song then came back\n            this.linked = true;\n        }\n    }\n\n    onBeat(map, index) {\n        if(!this.song || this.core.currentSong != this.song) {\n            return;\n        }\n        let editor;\n        if(index < 0) {\n            index += this.core.currentSong.buildupRhythm.length;\n            editor = this.buildEdit;\n            this.loopEdit._hilight.className = \"beat-hilight invisible\";\n        } else {\n            editor = this.loopEdit;\n            if(this.song.buildup) {\n                this.buildEdit._hilight.className = \"beat-hilight invisible\";\n            }\n        }\n        editor._hilight.className = \"beat-hilight\";\n        let offsetX = index % this.wrapAt;\n        let offsetY = Math.floor(index / this.wrapAt);\n        // Not computing width/height here due to Chrome bug\n        editor._hilight.style.left = Math.floor(offsetX * this.hilightWidth) + \"px\";\n        editor._hilight.style.top = Math.floor(offsetY * this.hilightHeight) + \"px\";\n    }\n\n    reflow(editor, map) {\n        if(!map) { // NOTHING TO SEE HERE\n            editor._beatmap.textContent = \"\";\n            editor._hilight.textContent = \"[none]\";\n            editor._hilight.className = \"beat-hilight\";\n            editor._hilight.style.top = \"0\";\n            editor._hilight.style.left = \"0\";\n            editor._beatCount.textContent = \"0 beats\";\n            return;\n        } else {\n            editor._hilight.innerHTML = \"&block;\";\n        }\n        editor._beatCount.textContent = map.length + \" beats\";\n        // http://stackoverflow.com/a/27012001\n        // if it's too long to wrap, scroll in the x direction\n        let regex = new RegExp(\"(.{\" + this.wrapAt + \"})\", \"g\");\n        editor._beatmap.innerHTML = map.replace(regex, \"$1<br />\");\n    }\n\n    updateInfo() {\n        // Avoid a bunch of nested elses\n        this.seekStart.classList.add(\"hues-button--disabled\");\n        this.seekLoop.classList.add(\"hues-button--disabled\");\n        this.saveBtn.classList.add(\"hues-button--disabled\");\n        this.copyBtn.classList.add(\"hues-button--disabled\");\n        this.buildEdit._removeBtn.classList.add(\"hues-button--disabled\");\n        this.loopEdit._removeBtn.classList.add(\"hues-button--disabled\");\n        \n        if(!this.song) {\n            return;\n        }\n        \n        this.saveBtn.classList.remove(\"hues-button--disabled\");\n        this.copyBtn.classList.remove(\"hues-button--disabled\");\n        \n        if(this.song.independentBuild) {\n            this.timeLock._locker.innerHTML = \"&#xe904;\";\n            this.timeLock.classList.add(\"edit-area__timelock--unlocked\");\n        } else {\n            this.timeLock._locker.innerHTML = \"&#xe905;\";\n            this.timeLock.classList.remove(\"edit-area__timelock--unlocked\");\n        }\n        if(this.song.sound) {\n            this.seekLoop.classList.remove(\"hues-button--disabled\");\n            this.loopEdit._removeBtn.classList.remove(\"hues-button--disabled\");\n        }\n        if(this.song.buildup) {\n            this.seekStart.classList.remove(\"hues-button--disabled\");\n            this.buildEdit._removeBtn.classList.remove(\"hues-button--disabled\");\n        }\n        \n        if(!this.linked) {\n            return;\n        }\n        \n        let loopLen = this.core.soundManager.loopLength;\n        let buildLen = this.core.soundManager.buildLength;\n        let beatLen = (loopLen / this.song.rhythm.length) * 1000;\n        \n        this.loopLen.textContent = loopLen.toFixed(2);\n        this.buildLen.textContent = buildLen.toFixed(2);\n        this.beatLen.textContent = beatLen.toFixed(2);\n    }\n\n    loadAudio(editor) {\n        if(editor._fileInput.files.length < 1) {\n            return;\n        }\n        // If first load, this makes fresh, gets the core synced up\n        this.newSong(this.song);\n        \n        // Have we just added a build to a song with a rhythm, or vice versa?\n        // If so, link their lengths\n        let newlyLinked = !this.song[editor._sound] && !!this.song[this.getOther(editor)._sound];\n        \n        // Disable load button TODO\n        let file = editor._fileInput.files[0];\n        \n        // load audio\n        this.blobToArrayBuffer(file)\n        .then(buffer => {\n            // Is this buffer even decodable?\n            let testSong = {test: buffer};\n            return this.core.soundManager.loadBuffer(testSong, \"test\")\n                   // keep the buffer moving through the chain\n                   // remember it's been passed through to a worker, so we update the reference\n                   .then(() => {\n                       return testSong.test;\n                   });\n        }).then(buffer => {\n            this.song[editor._sound] = buffer;\n            // Save filename for XML export\n            let noExt = file.name.replace(/\\.[^/.]+$/, \"\");\n            if(editor._sound == \"sound\") {\n                this.song.name = noExt;\n            } else {\n                this.song.buildupName = noExt;\n            }\n            // make empty map if needed\n            if(!this.getText(editor)) {\n                this.setText(editor, \"x...o...x...o...\");\n            }\n            // Do we have a loop to play?\n            if(this.song.sound) {\n                // Force refresh\n                return this.core.soundManager.playSong(this.song, true, true);\n            }\n        }).then(() => {\n            if(newlyLinked) {\n                this.setIndependentBuild(false);\n            }\n            this.updateInfo();\n            this.core.updateBeatLength();\n            // We may have to go backwards in time\n            this.core.recalcBeatIndex();\n            this.updateWaveform();\n        }).catch(error => {\n            console.log(error);\n            this.alert(\"Couldn't load song! Is it a LAME encoded MP3?\");\n        });\n    }\n\n    removeAudio(editor) {\n        if(!this.song) {\n            return;\n        }\n        \n        this.song[editor._sound] = null;\n        this.song[editor._rhythm] = \"\";\n        this.setIndependentBuild(true);\n        this.reflow(editor, \"\");\n        // Is the loop playable?\n        if(this.song.sound && this.linked) {\n            this.core.soundManager.playSong(this.song, true, true)\n            .then(() => {\n                this.updateWaveform();\n            });\n        } else {\n            this.core.soundManager.stop();\n            this.updateWaveform();\n        }\n        this.updateInfo();\n        this.updateHalveDoubleButtons(editor);\n    }\n\n    blobToArrayBuffer(blob) {\n        return new Promise((resolve, reject) => {\n            let fr = new FileReader();\n            fr.onload = () => {\n                resolve(fr.result);\n            };\n            fr.onerror = () => {\n                reject(new Error(\"File read failed!\"));\n            };\n            fr.readAsArrayBuffer(blob);\n        });\n    }\n\n    newSong(song) {\n        if(!song) {\n            song = {\"name\":\"Name\",\n               \"title\":\"Title\",\n               \"rhythm\":\"\",\n               \"source\":\"\",\n               \"sound\":null,\n               \"enabled\":true,\n               \"filename\":null,\n               \"charsPerBeat\": null,\n               // Because new songs are empty\n               \"independentBuild\": true};\n           if(!this.respack) {\n               this.respack = new Respack();\n               this.respack.name = \"Editor Respack\";\n               this.respack.author = \"You!\";\n               this.respack.description = \"An internal resourcepack for editing new songs\";\n               this.core.resourceManager.addPack(this.respack);\n           }\n           this.respack.songs.push(song);\n           this.core.resourceManager.rebuildArrays();\n           this.core.resourceManager.rebuildEnabled();\n           this.core.setSongOject(song);\n        }\n        // Clear instructions\n        this.buildEdit._hilight.className = \"beat-hilight invisible\";\n        this.loopEdit._hilight.className = \"beat-hilight invisible\";\n        \n        // Clear helpful glows\n        this.newSongBtn.classList.remove(\"hues-button--glow\");\n        this.fromSongBtn.classList.remove(\"hues-button--glow\");\n        \n        // Enable title edits\n        this.title.disabled = false;\n        this.source.disabled = false;\n        \n        this.clearUndoRedo();\n        \n        this.song = song;\n        this.reflow(this.buildEdit, song.buildupRhythm);\n        this.reflow(this.loopEdit, song.rhythm);\n        this.title.value = song.title;\n        this.source.value = song.source;\n        \n        // Force independent build if only 1 source is present\n        this.updateIndependentBuild();\n        \n        // Unlock beatmap lengths\n        this.setLocked(this.buildEdit, 0);\n        this.setLocked(this.loopEdit, 0);\n        \n        this.linked = true;\n        this.updateInfo();\n        this.updateWaveform();\n    }\n\n    updateIndependentBuild() {\n        // Force independent build if only 1 source is present\n        \n        // Effectively buildup XOR loop - does only 1 exist?\n        let hasBuild = !!this.song.buildup;\n        let hasLoop = !!this.song.sound;\n        if(hasBuild != hasLoop) {\n            this.setIndependentBuild(true);\n        }\n    }\n\n    setIndependentBuild(indep) {\n        this.song.independentBuild = indep;\n        if(!indep) {\n            // If both are locked, we lock the result, otherwise unlock both\n            let lock = this.loopEdit._locked && this.buildEdit._locked;\n            // Then unlock both so text adjustment can occur\n            this.loopEdit._locked = 0;\n            this.buildEdit._locked = 0;\n            // Correct the lengths\n            this.setText(this.loopEdit, this.getText(this.loopEdit));\n            // Restore locked state\n            if(lock) {\n                this.loopEdit._locked = this.song.rhythm.length;\n                this.buildEdit._locked = this.song.buildupRhythm.length;\n            }\n        }\n        this.updateInfo();\n    }\n\n    batchUndo() {\n        if(!this.batchUndoArray)\n            this.batchUndoArray = [];\n    }\n\n    commitUndo() {\n        if(this.batchUndoArray) {\n            this.undoBuffer.push(this.batchUndoArray);\n            this.trimUndo();\n            this.batchUndoArray = null;\n            this.updateUndoUI();\n        }\n    }\n\n    pushUndo(name, editor, oldText, newText) {\n        if(oldText == newText) {\n            return;\n        }\n        this.redoBuffer = [];\n        \n        let undoObj = {songVar: name,\n                       editor: editor,\n                       text: oldText,\n                       indep: this.song.independentBuild};\n        if(this.batchUndoArray) {\n            this.batchUndoArray.push(undoObj);\n        } else {\n            // 1 element array so undoRedo is neater\n            this.undoBuffer.push([undoObj]);\n            this.trimUndo();\n        }\n        this.updateUndoUI();\n    }\n\n    trimUndo() {\n        while(this.undoBuffer.length > 50) {\n            this.undoBuffer.shift();\n        }\n    }\n\n    undo() {\n        this.undoRedo(this.undoBuffer, this.redoBuffer);\n    }\n\n    redo() {\n        this.undoRedo(this.redoBuffer, this.undoBuffer);\n    }\n\n    undoRedo(from, to) {\n        if(from.length === 0 || !this.song) {\n            return;\n        }\n        // Remove old data\n        let fromArray = from.pop();\n        let toArray = [];\n        for(let i = 0; i < fromArray.length; i++) {\n            let fromData = fromArray[i];\n            // Make restore from current\n            toArray.push({songVar: fromData.songVar,\n                          editor: fromData.editor,\n                          text: this.song[fromData.songVar],\n                          indep: this.song.independentBuild});\n            // Restore to editor\n            this.song[fromData.songVar] = fromData.text;\n            this.song.independentBuild = fromData.indep;\n            // Don't have weird behaviour there\n            if(fromData.editor._locked) {\n                fromData.editor._locked = fromData.text.length;\n            }\n            this.reflow(fromData.editor, this.song[fromData.songVar]);\n            this.updateHalveDoubleButtons(fromData.editor);\n        }\n        to.push(toArray);\n        this.updateUndoUI();\n        this.updateInfo();\n        this.core.updateBeatLength();\n        this.core.recalcBeatIndex();\n    }\n\n    clearUndoRedo() {\n        this.undoBuffer = [];\n        this.redoBuffer = [];\n        this.updateUndoUI();\n    }\n\n    updateUndoUI() {\n        this.undoBtn.className = \"hues-button hues-button--disabled\";\n        this.redoBtn.className = \"hues-button hues-button--disabled\";\n        \n        if(this.undoBuffer.length > 0) {\n            this.undoBtn.classList.remove(\"hues-button--disabled\");\n        }\n        if(this.redoBuffer.length > 0) {\n            this.redoBtn.classList.remove(\"hues-button--disabled\");\n        }\n    }\n\n    halveBeats(editor) {\n        let commit = false;\n        if(!this.song.independentBuild) {\n            commit = true;\n            this.batchUndo();\n            // halve them both\n            let other = this.getOther(editor);\n            this.song.independentBuild = true;\n            this.halveBeats(other);\n        }\n        this.setText(editor, this.song[editor._rhythm].replace(/(.)./g, \"$1\"));\n        if(commit) {\n            this.commitUndo();\n            // We set it so any rounding is padded\n            this.setIndependentBuild(false);\n        }\n    }\n\n    doubleBeats(editor) {\n        let commit = false;\n        if(!this.song.independentBuild) {\n            commit = true;\n            this.batchUndo();\n            // Double them both\n            let other = this.getOther(editor);\n            this.song.independentBuild = true;\n            this.doubleBeats(other);\n        }\n        this.setText(editor, this.song[editor._rhythm].replace(/(.)/g, \"$1.\"));\n        if(commit) {\n            this.commitUndo();\n            // We set it so any rounding is padded\n            this.setIndependentBuild(false);\n        }\n    }\n\n    updateHalveDoubleButtons(editor) {\n        editor._halveBtn.className = \"hues-button hues-button--disabled\";\n        editor._doubleBtn.className = \"hues-button hues-button--disabled\";\n\n        if(!editor._locked) {\n            let txtLen = this.getText(editor).length;\n            if(!this.song.independentBuild) {\n                let other = this.getOther(editor);\n                txtLen = Math.min(txtLen, this.getText(other).length);\n            }\n            if(txtLen > 0) {\n                editor._doubleBtn.className = \"hues-button\";\n            }\n            if(txtLen > 1) {\n                editor._halveBtn.className = \"hues-button\";\n            }\n        }\n    }\n\n    createTextInput(label, subtitle, parent) {\n        let div = document.createElement(\"div\");\n        div.className = \"editor__label\";\n        let caption = document.createElement(\"label\");\n        caption.innerHTML = label;\n        div.appendChild(caption);\n        let container = document.createElement(\"span\");\n        container.className = \"editor__textinput-container\";\n        let input = document.createElement(\"input\");\n        input.className = \"editor__textinput\";\n        input.type = \"text\";\n        input.value = subtitle;\n        container.appendChild(input);\n        div.appendChild(container);\n        \n        parent.appendChild(div);\n        \n        return input;\n    }\n\n    createButton(label, parent, disabled, extraClass) {\n        let button = document.createElement(\"span\");\n        button.className = \"hues-button\";\n        if(disabled) {\n            button.classList.add(\"hues-button--disabled\");\n        }\n        if(extraClass) {\n            button.className += \" \" + extraClass;\n        }\n        // Automagically make disabled buttons ignore clicks\n        button.addEventListener(\"click\", event => {\n            if(button.classList.contains(\"hues-button--disabled\")) {\n                event.preventDefault();\n                event.stopPropagation();\n                event.stopImmediatePropagation();\n                return false;\n            } else {\n                return true;\n            }\n        });\n        button.innerHTML = label.toUpperCase();\n        parent.appendChild(button);\n        return button;\n    }\n\n    uiCreateInfo() {\n        let info = document.createElement(\"div\");\n        this.topBar.appendChild(info);\n        info.className = \"editor__info\";\n        \n        let songUpdate = function(name) {\n            if(!this.song ) {\n                return;\n            }\n            this.song[name] = this[name].value;\n            if(this.song != this.core.currentSong) {\n                return;\n            }\n            this.core.callEventListeners(\"newsong\", this.song);\n        };\n        \n        this.title = this.createTextInput(\"Title:\", \"Song name\", info);\n        this.title.oninput = songUpdate.bind(this, \"title\");\n        this.title.disabled = true;\n        this.source = this.createTextInput(\"Link:&nbsp;\", \"Source link\", info);\n        this.source.oninput = songUpdate.bind(this, \"source\");\n        this.source.disabled = true;\n    }\n\n    uiCreateImport() {\n        let imports = document.createElement(\"div\");\n        this.topBar.appendChild(imports);\n        imports.className = \"editor__imports\";\n        \n        let songEdits = document.createElement(\"div\");\n        imports.appendChild(songEdits);\n        let newSongBtn = this.createButton(\"New song\", songEdits, false, \"hues-button--glow\");\n        newSongBtn.addEventListener(\"click\", () => {\n            this.newSong();\n        });\n        this.newSongBtn = newSongBtn;\n        let fromSong = this.createButton(\"Edit current song\", songEdits, false, \"hues-button--glow\");\n        fromSong.addEventListener(\"click\", () => {\n            if(this.core.currentSong) {\n                this.newSong(this.core.currentSong);\n            }\n        });\n        this.fromSongBtn = fromSong;\n        \n        let songInfos = document.createElement(\"div\");\n        songInfos.className = \"settings-individual editor__song-stats\";\n        imports.appendChild(songInfos);\n        \n        this.loopLen = this.uiCreateSongStat(\"Loop length (s):\", \"0.00\", songInfos);\n        this.buildLen = this.uiCreateSongStat(\"Build length (s):\", \"0.00\", songInfos);\n        this.beatLen = this.uiCreateSongStat(\"Beat length (ms):\", \"0.00\", songInfos);\n    }\n\n    uiCreateSongStat(name, value, parent) {\n        let container = document.createElement(\"div\");\n        parent.appendChild(container);\n        let label = document.createElement(\"span\");\n        label.textContent = name;\n        container.appendChild(label);\n        let valueSpan = document.createElement(\"span\");\n        valueSpan.textContent = value;\n        valueSpan.className = \"editor__song-stats__value\";\n        container.appendChild(valueSpan);\n        return valueSpan;\n    }\n\n    uiCreateEditArea() {\n        let editArea = document.createElement(\"div\");\n        this.editArea = editArea;\n        editArea.className = \"edit-area\";\n        this.root.appendChild(editArea);\n        \n        // Lock build/loop lengths\n        this.timeLock = document.createElement(\"div\");\n        editArea.appendChild(this.timeLock);\n        this.timeLock.className = \"hues-icon edit-area__timelock edit-area__timelock--unlocked\";\n        // CHAIN-BROKEN, use &#xe905; for CHAIN\n        let locker = this.createButton(\"&#xe904;\", this.timeLock);\n        locker.addEventListener(\"click\", () => {\n            // Only allow if both song bits exist\n            if(!this.song || !this.song.buildup || !this.song.sound) {\n                return;\n            }\n            this.setIndependentBuild(!this.song.independentBuild);\n        });\n        this.timeLock._locker = locker;\n        \n        this.buildEdit = this.uiCreateSingleEditor(\"Buildup\", \"buildup\", \"buildupRhythm\", editArea);\n        this.seekStart = this.buildEdit._seek;\n        // FIRST |<<\n        this.seekStart.innerHTML = \"&#xe90b;\";\n        this.seekStart.addEventListener(\"click\", () => {\n            this.core.soundManager.seek(-this.core.soundManager.buildLength);\n        });\n        \n        // drag handle\n        let handleContainer = document.createElement(\"div\");\n        handleContainer.className = \"resize-handle\";\n        editArea.appendChild(handleContainer);\n        let handle = document.createElement(\"div\");\n        handle.className = 'hues-icon resize-handle__handle';\n        handle.innerHTML = \"&#xe908;\"; // DRAG HANDLE\n        handleContainer.appendChild(handle);\n        this.resizeHandle = handleContainer;\n        \n        handleContainer.addEventListener(\"mousedown\", (e) => {\n            e.preventDefault();\n            let editTop = this.editArea.getBoundingClientRect().top;\n            let handleSize = this.resizeHandle.clientHeight;\n            \n            let resizer = (e) => {\n                this.buildEditSize = Math.floor(e.clientY - editTop + handleSize/2);\n                this.resize(true);\n            };\n            \n            let mouseup = function(e) {\n                document.removeEventListener(\"mousemove\", resizer);\n                document.removeEventListener(\"mouseup\", mouseup);\n            };\n            \n            document.addEventListener(\"mousemove\", resizer);\n            document.addEventListener(\"mouseup\", mouseup);\n        });\n\n        this.loopEdit = this.uiCreateSingleEditor(\"Rhythm&nbsp;\", \"sound\", \"rhythm\", editArea);\n        this.seekLoop = this.loopEdit._seek;\n        // FIRST |<<\n        this.seekLoop.innerHTML = \"&#xe90b;\";\n        this.seekLoop.addEventListener(\"click\", () => {\n            this.core.soundManager.seek(0);\n        });\n        \n        this.buildEdit._hilight.textContent = \"[none]\";\n        this.loopEdit._hilight.innerHTML = \n            '<br />' + \n             'Click [LOAD RHYTHM] to load a loop! LAME encoded MP3s work best.<br />' + \n             '(LAME is important for seamless MP3 loops)<br />' +\n             '<br />' +\n             '[DOUBLE] doubles the selected map length by padding it with \".\"s.<br />' +\n             '[HALVE] shortens the map length by removing every other character.<br />' +\n             '<br />' +\n             'You can also add a buildup with [LOAD BUILDUP], or remove it<br />' +\n             'with [REMOVE].<br />' +\n             '<br />' +\n             '[NEW SONG] adds a completely empty song for you to edit, and<br />' +\n             '[EDIT CURRENT SONG] takes the current playing song to the editor.<br />' +\n             '<br />' +\n             '[COPY/SAVE XML] allow for storing the rhythms and easy <br />' +\n             'inclusion into a Resource Pack!';\n    }\n\n    uiCreateSingleEditor(title, soundName, rhythmName, parent) {\n        let container = document.createElement(\"div\");\n        parent.appendChild(container);\n        \n        let header = document.createElement(\"div\");\n        header.className = \"edit-area__header\";\n        container.appendChild(header);\n        \n        let nameLabel = document.createElement(\"span\");\n        header.appendChild(nameLabel);\n        nameLabel.innerHTML = title;\n        \n        let seek = this.createButton(\"\", header, true, \"hues-icon\");\n        header.appendChild(seek);\n        container._seek = seek;\n        \n        let beatCount = document.createElement(\"span\");\n        header.appendChild(beatCount);\n        beatCount.className = \"edit-area__beat-count\";\n        beatCount.textContent = \"0 beats\";\n        container._lockedBtn = this.createButton(\"&#xe907;\", header, false, \"hues-icon\");\n        container._lockedBtn.addEventListener(\"click\", () => {\n            if(container._locked) {\n                this.setLocked(container, 0);\n            } else {\n                let textLen = this.getText(container).length;\n                this.setLocked(container, textLen);\n            }\n        });\n        \n        let rightHeader = document.createElement(\"span\");\n        rightHeader.className = \"edit-area__header__right\";\n        header.appendChild(rightHeader);\n        \n        container._halveBtn = this.createButton(\"Halve\", rightHeader, true);\n        container._halveBtn.addEventListener(\"click\", this.halveBeats.bind(this, container));\n        container._doubleBtn = this.createButton(\"Double\", rightHeader, true);\n        container._doubleBtn.addEventListener(\"click\", this.doubleBeats.bind(this, container));\n        \n        let fileInput = document.createElement(\"input\");\n        fileInput.type =\"file\";\n        fileInput.accept=\".mp3, .wav, .ogg\";\n        fileInput.multiple = false;\n        fileInput.onchange = this.loadAudio.bind(this, container);\n        let load = this.createButton(\"Load \" + title.replace(/&nbsp;/g,\"\"), rightHeader);\n        load.addEventListener(\"click\", () => {fileInput.click();});\n        \n        container._removeBtn = this.createButton(\"Remove\", rightHeader, true);\n        container._removeBtn.addEventListener(\"click\", this.removeAudio.bind(this, container));\n        \n        let editBox = document.createElement(\"div\");\n        editBox.className = \"edit-area__box\";\n        let beatmap = document.createElement(\"div\");\n        beatmap.className = \"edit-area__beatmap\";\n        beatmap.contentEditable = true;\n        beatmap.spellcheck = false;\n        beatmap.oninput = this.textUpdated.bind(this, container);\n        beatmap.oncontextmenu = this.rightClick.bind(this, container);\n        \n        let beatHilight = document.createElement(\"div\");\n        beatHilight.className = \"beat-hilight\";\n        \n        editBox.appendChild(beatHilight);\n        editBox.appendChild(beatmap);\n        container.appendChild(editBox);\n        \n        container._header = header;\n        container._beatCount = beatCount;\n        container._box = editBox;\n        container._beatmap = beatmap;\n        container._hilight = beatHilight;\n        container._fileInput = fileInput;\n        \n        container._sound = soundName;\n        container._rhythm = rhythmName;\n            \n        // Are we in insert mode? Default = no\n        container._locked = 0;\n        \n        return container;\n    }\n\n    uiCreateControls() {\n        let controls = document.createElement(\"div\");\n        controls.className = \"edit__controls\";\n        this.root.appendChild(controls);\n        \n        let changeRate = function(change) {\n            let rate = this.core.soundManager.playbackRate;\n            rate += change;\n            this.core.soundManager.setRate(rate);\n            // In case it gets clamped, check\n            let newRate = this.core.soundManager.playbackRate;\n            playRateLab.textContent = newRate.toFixed(2) + \"x\";\n        };\n        \n        let speedControl = document.createElement(\"div\");\n        controls.appendChild(speedControl);\n        \n        // BACKWARD\n        let speedDown = this.createButton(\"&#xe909;\", speedControl, false, \"hues-icon\");\n        speedDown.addEventListener(\"click\", changeRate.bind(this, -0.25));\n        // FORWARD\n        let speedUp = this.createButton(\"&#xe90a;\", speedControl, false, \"hues-icon\");\n        speedUp.addEventListener(\"click\", changeRate.bind(this, 0.25));\n            \n        let playRateLab = document.createElement(\"span\");\n        playRateLab.className = \"settings-individual\";\n        playRateLab.textContent = \"1.00x\";\n        speedControl.appendChild(playRateLab);\n        \n        let wrapControl = document.createElement(\"div\");\n        controls.appendChild(wrapControl);\n        \n        let wrapLab = document.createElement(\"span\");\n        wrapLab.className = \"settings-individual\";\n        wrapLab.textContent = \"New line at beat \";\n        wrapControl.appendChild(wrapLab);\n        \n        let wrapAt = document.createElement(\"input\");\n        wrapAt.className = \"settings-input\";\n        wrapAt.value = this.wrapAt;\n        wrapAt.type = \"text\";\n        wrapAt.oninput = () => {\n            wrapAt.value = wrapAt.value.replace(/\\D/g,'');\n            if(wrapAt.value === \"\" || wrapAt.value < 1) {\n                wrapAt.value = \"\";\n                return;\n            }\n            this.wrapAt = parseInt(wrapAt.value);\n            this.reflow(this.buildEdit, this.song.buildupRhythm);\n            this.reflow(this.loopEdit, this.song.rhythm);\n            \n        };\n        wrapControl.appendChild(wrapAt);\n    }\n\n    uiCreateVisualiser() {\n        let wave = document.createElement(\"canvas\");\n        wave.className = \"waveform\";\n        wave.height = WAVE_HEIGHT_PIXELS;\n        this.root.appendChild(wave);\n        this.waveCanvas = wave;\n        this.waveContext = wave.getContext(\"2d\");\n        \n        this.core.addEventListener(\"frame\", this.drawWave.bind(this));\n    }\n\n    rightClick(editor, event) {\n        if(!this.linked) {\n            return;\n        }\n        // If the right click is also a focus event, caret doesn't move, so we have to use coords\n        let coords = this.getTextCoords(event);\n        \n        if(coords.x > this.wrapAt)\n            return true;\n\n        let caret = coords.y * this.wrapAt + coords.x;\n        let totalLen = this.getText(editor).length;\n        if(caret > totalLen)\n            return true;\n        \n        // in case of focus event\n        this.setCaret(editor._beatmap, caret);\n        let percent = caret / totalLen;\n        let seekTime = 0;\n        if(editor == this.loopEdit) { // loop\n            seekTime = this.core.soundManager.loopLength * percent;\n        } else { // build\n            let bLen = this.core.soundManager.buildLength;\n            seekTime = -bLen + bLen * percent;\n        }\n        this.core.soundManager.seek(seekTime);\n        \n        event.preventDefault();\n        return false;\n    }\n\n    getTextCoords(event) {\n        // http://stackoverflow.com/a/10816667\n        let el = event.target,\n            x = 0,\n            y = 0;\n\n        while (el && !isNaN(el.offsetLeft) && !isNaN(el.offsetTop)) {\n            x += el.offsetLeft - el.scrollLeft;\n            y += el.offsetTop - el.scrollTop;\n            el = el.offsetParent;\n        }\n\n        x = Math.floor((event.clientX - x) / this.hilightWidth);\n        y = Math.floor((event.clientY - y) / this.hilightHeight);\n        \n        return {x: x, y: y};\n    }\n\n    textUpdated(editor) {\n        if(!this.song || !this.song[editor._sound]) {\n            this.reflow(editor, \"\");\n            return;\n        }\n        // Space at start of line is nonbreaking, get it with \\u00a0\n        let input = editor._beatmap.textContent.replace(/ |\\u00a0/g, \"\");\n        if(input.length === 0) {\n            input = \".\";\n        }\n        this.setText(editor, input);\n    }\n\n    getText(editor) {\n        if(!this.song || !this.song[editor._rhythm]) {\n            return \"\";\n        } else {\n            return this.song[editor._rhythm];\n        }\n    }\n\n    setText(editor, text, caretFromEnd) {\n        if(!this.song || !this.song[editor._sound]) {\n            this.reflow(editor, \"\");\n            return;\n        }\n        let commitUndo = false;\n        let caret = caretFromEnd ? text.length : this.getCaret(editor._beatmap);\n        if(editor._locked) {\n            caret = Math.min(editor._locked, caret);\n            if(text.length > editor._locked) {\n                // Works for pastes too! Removes the different between sizes from the caret position\n                text = text.slice(0, caret) + text.slice(caret + (text.length - editor._locked), text.length);\n            } else {\n                while(text.length < editor._locked) {\n                    text += \".\";\n                }\n            }\n        // time to scale things to fit\n        } else if(!this.song.independentBuild && this.song.buildupRhythm && this.song.rhythm) {\n            let ratio;\n            if(editor == this.loopEdit) {\n                 ratio = this.core.soundManager.loopLength / this.core.soundManager.buildLength;\n            } else {\n                ratio = this.core.soundManager.buildLength / this.core.soundManager.loopLength;\n            }\n            let newLen = Math.round(text.length / ratio);\n            // We've tried to make the other map impossibly short, force us to be longer\n            while(newLen === 0) {\n                text += \".\";\n                newLen = Math.round(text.length / ratio);\n            }\n            let otherMap = this.getOther(editor);\n            let wasLocked = otherMap._locked;\n            // clamp the length\n            otherMap._locked = newLen;\n            // Make undos also sync\n            this.batchUndo();\n            commitUndo = true;\n            // avoid infinite loop\n            this.song.independentBuild = true;\n            // Use setText to update undo state and fill/clamp beats\n            this.setText(otherMap, this.song[otherMap._rhythm], true);\n            // Restore\n            this.song.independentBuild = false;\n            // Otherwise we'll lose the new length on the next edit\n            if(!wasLocked) {\n                otherMap._locked = 0;\n            }\n            // Fix the buttons\n            this.updateHalveDoubleButtons(otherMap);\n        }\n        this.pushUndo(editor._rhythm, editor, this.song[editor._rhythm], text);\n        // If we were linked, commit our 2 edits as 1 undo state\n        if(commitUndo) {\n            this.commitUndo();\n        }\n        // Make sure you can't accidentally close the tab\n        window.onbeforeunload = this.confirmLeave;\n        this.song[editor._rhythm] = text;\n        this.reflow(editor, this.song[editor._rhythm]);\n        this.setCaret(editor._beatmap, caret);\n        this.updateHalveDoubleButtons(editor);\n        \n        this.core.updateBeatLength();\n        // We may have to go backwards in time\n        this.core.recalcBeatIndex();\n        this.updateInfo();\n    }\n\n    getCaret(editable) {\n        let caret = 0;\n        let sel = window.getSelection();\n        if (sel.rangeCount) {\n          let range = sel.getRangeAt(0);\n          // <br> elements are empty, and pastes do weird things.\n          // So don't go up in multiples of 2 for getCaret\n          for(let i = 0; i < editable.childNodes.length; i++) {\n              if (range.commonAncestorContainer == editable.childNodes[i]) {\n                  caret += range.endOffset;\n                return caret;\n              } else {\n                  caret += editable.childNodes[i].textContent.length;\n              }\n          }\n        }\n        return 0;\n    }\n\n    setCaret(editable, caret) {\n        let range = document.createRange();\n        let sel = window.getSelection();\n        // <br> elements mean children go up in multiples of 2\n        for(let i = 0; i < editable.childNodes.length; i+= 2) {\n            let textLen = editable.childNodes[i].textContent.length;\n            if(caret > textLen) {\n                caret -= textLen;\n            } else {\n                range.setStart(editable.childNodes[i], caret);\n                range.collapse(true);\n                sel.removeAllRanges();\n                sel.addRange(range);\n                break;\n            }\n        }\n    }\n\n    setLocked(editor, locked) {\n        editor._locked = locked;\n        if(locked) {\n            editor._lockedBtn.innerHTML = \"&#xe906;\"; // LOCKED\n        } else {\n            editor._lockedBtn.innerHTML = \"&#xe907;\"; // UNLOCKED\n        }\n        // Synchronise locks when lengths are linked\n        if(!this.song.independentBuild) {\n            let other = this.getOther(editor);\n            let otherLock = locked ? this.getText(other).length : 0;\n            this.song.independentBuild = true;\n            this.setLocked(other, otherLock);\n            this.song.independentBuild = false;\n        }\n        this.updateHalveDoubleButtons(editor);\n    }\n\n    updateWaveform() {\n        if(this.buildWaveBuff != this.core.soundManager.buildup) {\n            this.buildWaveBuff = this.core.soundManager.buildup;\n            this.buildWave = this.renderWave(this.buildWaveBuff, this.core.soundManager.buildLength);\n        }\n        if(this.loopWaveBuff != this.core.soundManager.loop) {\n            this.loopWaveBuff = this.core.soundManager.loop;\n            this.loopWave = this.renderWave(this.loopWaveBuff, this.core.soundManager.loopLength);\n        }\n    }\n\n    renderWave(buffer, length) {\n        if(!buffer) {\n            return null;\n        }\n        // The individual wave section\n        let wave = document.createElement(\"canvas\");\n        let waveContext = wave.getContext(\"2d\");\n        \n        wave.height = WAVE_HEIGHT_PIXELS;\n        wave.width = Math.floor(WAVE_PIXELS_PER_SECOND * length);\n        \n        let samplesPerPixel = Math.floor(buffer.sampleRate / WAVE_PIXELS_PER_SECOND);\n        let waveData = [];\n        for(let i = 0; i < buffer.numberOfChannels; i++) {\n            waveData.push(buffer.getChannelData(i));\n        }\n        let channels = buffer.numberOfChannels;\n        // Half pixel offset makes things look crisp\n        let pixel = 0.5;\n        let halfHeight = WAVE_HEIGHT_PIXELS/2;\n        for(let i = 0; i < buffer.length; i += samplesPerPixel) {\n            let min = 0, max = 0, avgHi = 0, avgLo = 0;\n            let j;\n            for(j = 0; j < samplesPerPixel && i + j < buffer.length; j++) {\n                for(let chan = 0; chan < channels; chan++) {\n                    let sample = waveData[chan][i+j];\n                    if(sample > 0) {\n                        avgHi += sample;\n                    } else {\n                        avgLo += sample;\n                    }\n                    if(sample > max) max = sample;\n                    if(sample < min) min = sample;\n                }\n            }\n            let maxPix = Math.floor(halfHeight + max * halfHeight);\n            // Min is negative, addition is correct\n            let minPix = Math.floor(halfHeight + min * halfHeight);\n            waveContext.strokeStyle = \"black\";\n            waveContext.globalAlpha = \"1\";\n            waveContext.beginPath();\n            waveContext.moveTo(pixel, maxPix);\n            waveContext.lineTo(pixel, minPix);\n            waveContext.stroke();\n            \n            // Draw the average too, gives a better feel for the wave\n            avgHi /= j * channels;\n            avgLo /= j * channels;\n            let maxAvg = Math.floor(halfHeight + avgHi * halfHeight);\n            let minAvg = Math.floor(halfHeight + avgLo * halfHeight);\n            waveContext.strokeStyle = \"white\";\n            waveContext.globalAlpha = \"0.5\";\n            waveContext.beginPath();\n            waveContext.moveTo(pixel, maxAvg);\n            waveContext.lineTo(pixel, minAvg);\n            waveContext.stroke();\n            \n            pixel+=1;\n        }\n        \n        return wave;\n    }\n\n    drawWave() {\n        if((!this.buildWave && !this.loopWave) || !this.linked)\n            return;\n        \n        let width = this.waveCanvas.width;\n        let now = this.core.soundManager.currentTime;\n        let timespan = width / WAVE_PIXELS_PER_SECOND / 2;\n        let minTime = now - timespan;\n        let maxTime = now + timespan;\n        \n        let bLen = this.core.soundManager.buildLength;\n        let loopLen = this.core.soundManager.loopLength;\n        \n        let drawTime, drawOffset;\n        if(bLen) {\n            drawTime = Math.max(minTime, -bLen);\n        } else {\n            drawTime = Math.max(minTime, 0);\n        }\n        // drawOffset is \"pixels from the left\"\n        drawOffset = Math.floor((drawTime - minTime) * WAVE_PIXELS_PER_SECOND);\n        \n        this.waveContext.clearRect(0, 0, width, WAVE_HEIGHT_PIXELS);\n        \n        if(this.buildWave && bLen && minTime < 0) {\n            // Bit of legwork to convert negative to positive\n            let waveOffset = Math.floor((1 - drawTime / -bLen) * (this.buildWave.width-1));\n            try {\n                drawOffset = this.drawOneWave(this.buildWave, waveOffset, drawOffset, width);\n            } catch (err) {\n                console.log(this.waveCanvas);\n            }\n            // If there's more to draw after the build, it'll be from the start of the wave\n            drawTime = 0;\n        }\n        \n        let loopPoints = [];\n        if(this.loopWave && loopLen && maxTime > 0) {\n            while(drawOffset < width) {\n                if(drawTime === 0) {\n                    loopPoints.push(drawOffset);\n                }\n                \n                let waveOffset = Math.floor((drawTime / loopLen) * (this.loopWave.width-1));\n                drawOffset = this.drawOneWave(this.loopWave, waveOffset, drawOffset, width);\n                // If we're drawing more than 1 loop it's starting at 0\n                drawTime = 0;\n            }\n        }\n        \n        // trackbar\n        this.drawWaveBar(\"red\", width/2);\n        // Signify loop point with a green bar, drawing over the wave\n        for(let point of loopPoints) {\n            this.drawWaveBar(\"green\", point);\n        }\n    }\n\n    drawOneWave(wave, waveOffset, drawOffset, width) {\n        let drawWidth = Math.min(width - drawOffset, wave.width - waveOffset);\n        this.waveContext.drawImage(wave,\n                                   waveOffset, 0,                  // source x/y\n                                   drawWidth, WAVE_HEIGHT_PIXELS,  // source width/height\n                                   drawOffset, 0,                  // dest x/y\n                                   drawWidth, WAVE_HEIGHT_PIXELS); // dest width/height\n        return drawOffset + drawWidth;\n    }\n\n    drawWaveBar(colour, offset) {\n        this.waveContext.strokeStyle = colour;\n        this.waveContext.lineWidth = 2;\n        this.waveContext.beginPath();\n        this.waveContext.moveTo(offset, 0);\n        this.waveContext.lineTo(offset, WAVE_HEIGHT_PIXELS);\n        this.waveContext.stroke();\n    }\n\n    confirmLeave() {\n        return \"Unsaved beatmap - leave anyway?\";\n    }\n\n    alert(msg) {\n        this.statusMsg.classList.remove(\"editor__status-msg--fade\");\n        this.statusMsg.textContent = msg;\n        // Trigger a reflow and thus restart the animation\n        var useless = this.statusMsg.offsetWidth;\n        this.statusMsg.classList.add(\"editor__status-msg--fade\");\n    }\n\n    generateXML() {\n        if(!this.song) {\n            return null;\n        }\n        // Yes, this is just a bunch of strings. Simple XML, simple method.\n\n        let result = \"  <song name=\\\"\" + this.song.name + \"\\\">\\n\";\n        result += \"    <title>\" + this.song.title + \"</title>\\n\";\n        if(this.song.source) {\n            result += \"    <source>\" + this.song.source + \"</source>\\n\";\n        }\n        result += \"    <rhythm>\" + this.song.rhythm + \"</rhythm>\\n\";\n        if(this.song.buildup) {\n            result += \"    <buildup>\" + this.song.buildupName + \"</buildup>\\n\";\n            result += \"    <buildupRhythm>\" + this.song.buildupRhythm + \"</buildupRhythm>\\n\";\n            if(this.song.independentBuild) {\n                result += \"    <independentBuild>true</independentBuild>\\n\";\n            }\n        }\n        result += \"  </song>\\n\";\n        return result;\n    }\n\n    saveXML() {\n        let xml = this.generateXML();\n        if(!xml) {\n            return;\n        }\n        let result = \"<songs>\\n\";\n        result += xml;\n        result += \"</songs>\\n\";\n        \n        // http://stackoverflow.com/a/18197341\n        let element = document.createElement('a');\n        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(result));\n        element.setAttribute('download', \"0x40Hues - \" + this.song.name + \".xml\");\n\n        element.style.display = 'none';\n        document.body.appendChild(element);\n\n        element.click();\n\n        document.body.removeChild(element);\n        \n        window.onbeforeunload = null;\n    }\n\n    // http://stackoverflow.com/a/30810322\n    copyXML() {\n        let text = this.generateXML();\n        \n        // Clicking when disabled\n        if(!text) {\n            return;\n        }\n        \n        let textArea = document.createElement(\"textarea\");\n        textArea.className = \"copybox\";\n\n        textArea.value = text;\n\n        document.body.appendChild(textArea);\n\n        textArea.select();\n        \n        let success;\n\n        try {\n            success = document.execCommand('copy');\n        } catch (err) {\n            success = false;\n        }\n        \n        document.body.removeChild(textArea);\n        if(success) {\n            this.alert(\"Beatmap XML copied to clipboard!\");\n        } else {\n            this.alert(\"Copy failed! Try saving instead\");\n        }\n    }\n}\n    \nwindow.HuesEditor = HuesEditor;\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n * Portions Copyright (c) 2015 Calvin Walton <calvin.walton@kepstin.ca>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n(function(window, document) {\n\"use strict\"; \n\n /* HuesInfo.js populates the INFO tab in the Hues Window.\n  */\n\nconst beatGlossary = [\n    \"x Vertical blur (snare)\",\n    \"o Horizontal blur (bass)\",\n    \"- No blur\",\n    \"+ Blackout\",\n    \"¤ Whiteout\",\n    \"| Short blackout\",\n    \": Color only\",\n    \"* Image only\",\n    \"X Vertical blur only\",\n    \"O Horizontal blur only\",\n    \") Trippy cirle in\",\n    \"( Trippy circle out\",\n    \"~ Fade color\",\n    \"= Fade and change image\",\n    \"i Invert all colours\",\n    \"I Invert & change image\",\n    \"s Horizontal slice\",\n    \"S Horizontal slice and change image\",\n    \"v Vertical slice\",\n    \"V Vertical slice and change image\",\n    \"# Double slice\",\n    \"@ Double slice and change image\"\n];\n\nconst shortcuts = [\n    \"↑↓  Change song\",\n    \"←→  Change image\",\n    \"[N] Random song\",\n    \"-+  Change volume\",\n    \"[M] Toggle mute\",\n    \"[B] Restart song from build\",\n    \"[F] Toggle automode\",\n    \"[H] Toggle UI hide\",\n    \"[C] Character list\",\n    \"[S] Song list\",\n    \"[W] Toggle window\",\n    \"[R] Resource packs\",\n    \"[O] Options\",\n    \"[I] Information\",\n    \"[1-5] Change UI\"\n];\n\nfunction populateHuesInfo(version, huesWin, defaults) {\n    if(!defaults.enableWindow) {\n        return;\n    }\n    let verString = (parseInt(version)/10).toFixed(1);\n    \n    let info = document.createElement(\"div\");\n    info.className = \"hues-ref\";\n    \n    let huesName = defaults.huesName.replace(\"%VERSION%\", version);\n    let about = document.createElement(\"div\");\n    about.className = \"hues-about\";\n    about.innerHTML = \"<h1>\" + huesName + \"</h1>\" +\n        '<h2>Adapted from the <a target=\"_blank\" href=\"http://0x40hues.blogspot.com\">0x40 Flash</a></h2>' +\n        '<h2>Web-ified by <a target=\"_blank\" href=\"https://github.com/mon\">mon</a></h2>' +\n        '<h3>With help from <a target=\"_blank\" href=\"https://github.com/kepstin/0x40hues-html5\">Kepstin</a></h3>';\n    info.appendChild(about);\n    \n    addReference(info, \"Beat glossary\", beatGlossary);\n    addReference(info, \"Keyboard shortcuts\", shortcuts);\n    \n    huesWin.addTab(\"INFO\", info);\n}\n\nlet addReference = function(root, titleText, list) {\n    let ref = document.createElement(\"div\");\n    ref.className = \"hues-ref__info\";\n    root.appendChild(ref);\n    \n    let title = document.createElement(\"h3\");\n    title.textContent = titleText;\n    ref.appendChild(title);\n    \n    let listElem = document.createElement(\"ul\");\n    list.forEach(function(elem) {\n        let item = document.createElement(\"li\");\n        item.textContent = elem;\n        listElem.appendChild(item);\n    });\n    ref.appendChild(listElem);\n};\n\nwindow.populateHuesInfo = populateHuesInfo;\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n * Portions Copyright (c) 2015 Calvin Walton <calvin.walton@kepstin.ca>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n (function(window, document) {\n\"use strict\";\n\n/* If you're modifying settings for your hues, DON'T EDIT THIS\n   - Go to the HTML and edit the `defaults` object instead!\n */\nconst defaultSettings = {\n    // Location relative to root - where do the audio/zip workers live\n    // This is required because Web Workers need an absolute path\n    workersPath : \"lib/workers/\",\n    // ONLY USED FOR QUERY STRINGS this will be prepended to any respacks\n    // passed in as a ?packs=query\n    respackPath : \"respacks/\",\n    // Debugging var, for loading zips or not\n    load : true,\n    // Debug, play first song automatically?\n    autoplay : true,\n    // If true, defaults passed in initialiser override locally saved\n    overwriteLocal : false,\n    // If set, will attempt to play the named song first\n    firstSong: null,\n    // If set, will attempt to set the named image first\n    firstImage: null,\n    // If set, will disable the remote resources menu. For custom pages.\n    disableRemoteResources: false,\n    // You will rarely want to change this. Enables/disables the Hues Window.\n    enableWindow: true,\n    // Whether to show the Hues Window on page load\n    showWindow: false,\n    // What tab will be displayed first in the Hues Window\n    firstWindow: \"INFO\",\n    // Preloader customisation\n    preloadPrefix: \"0x\",\n    preloadBase: 16,\n    preloadMax: 0x40,\n    preloadTitle: \"\",\n    // Info customisation\n    huesName: \"0x40 Hues of JS, v%VERSION%\",\n    // If unset, uses <body>, otherwise sets which element to turn hues-y\n    root: null,\n    // If set, keyboard shortcuts are ignored\n    disableKeyboard: false,\n\n    // UI accessible config\n    smartAlign: \"on\",\n    blurAmount: \"medium\",\n    blurDecay: \"fast\",\n    blurQuality: \"medium\",\n    currentUI: \"modern\",\n    colourSet: \"normal\",\n    blackoutUI: \"off\",\n    playBuildups: \"on\",\n    visualiser: \"off\",\n    shuffleImages: \"on\",\n    autoSong: \"off\",\n    autoSongDelay: 5, // loops or minutes depending on autoSong value\n    autoSongShuffle: \"on\",\n    autoSongFadeout: \"on\",\n    trippyMode: \"off\",\n    volume: 0.7,\n    skipPreloader: \"off\"\n};\n\n// Don't get saved to localStorage\nconst ephemeralSettings = [\n    \"load\",\n    \"autoplay\",\n    \"overwriteLocal\",\n    \"respacks\",\n    \"respackPath\",\n    \"firstSong\",\n    \"firstImage\",\n    \"disableRemoteResources\",\n    \"preloadPrefix\",\n    \"preloadBase\",\n    \"preloadMax\",\n    \"enableWindow\",\n    \"firstWindow\",\n    \"workersPath\",\n    \"huesName\",\n    \"root\",\n    \"disableKeyboard\"\n];\n\n// To dynamically build the UI like the cool guy I am\nconst settingsCategories = {\n    \"Functionality\" : [\n        \"autoSong\",\n        \"autoSongShuffle\",\n        \"autoSongFadeout\",\n        \"playBuildups\"\n    ],\n    \"Graphics\" : [\n        \"blurAmount\",\n        \"blurDecay\",\n        \"blurQuality\",\n        \"trippyMode\"\n    ],\n    \"Visuals\" : [\n        \"smartAlign\",\n        \"shuffleImages\",\n        \"colourSet\",\n        \"visualiser\"\n    ],\n    \"Interface\" : [\n        \"currentUI\",\n        \"blackoutUI\",\n        \"skipPreloader\"\n    ]\n};\n\nconst settingsOptions = {\n    smartAlign : {\n        name : \"Smart Align images\",\n        options : [\"off\", \"on\"]\n    },\n    blurAmount : {\n        name : \"Blur amount\",\n        options : [\"low\", \"medium\", \"high\"]\n    },\n    blurDecay : {\n        name : \"Blur decay\",\n        options : [\"slow\", \"medium\", \"fast\", \"faster!\"]\n    },\n    blurQuality : {\n        name : \"Blur quality\",\n        options : [\"low\", \"medium\", \"high\", \"extreme\"]\n    },\n    visualiser : {\n        name : \"Spectrum analyser\",\n        options : [\"off\", \"on\"]\n    },\n    currentUI : {\n        name : \"UI style\",\n        options : [\"retro\", \"v4.20\", \"modern\", \"xmas\", \"hlwn\", \"mini\"]\n    },\n    colourSet : {\n        name : \"Colour set\",\n        options : [\"normal\", \"pastel\", \"v4.20\"]\n    },\n    blackoutUI : {\n        name : \"Blackout affects UI\",\n        options : [\"off\", \"on\"]\n    },\n    playBuildups : {\n        name : \"Play buildups\",\n        options : [\"off\", \"once\", \"on\"]\n    },\n    autoSong : {\n        name : \"AutoSong\",\n        options : [\"off\", \"loop\", \"time\", \n            {type:\"varText\", text:function() {\n                // only display if autosong is on\n                return localStorage[\"autoSong\"] == \"off\" ? \"\" : \"after\";\n            }}, \n            {type:\"input\", variable:\"autoSongDelay\", inputType:\"int\",\n                visiblity:function() {\n                    return localStorage[\"autoSong\"] != \"off\";\n                }\n            },\n            {type:\"varText\", text:function() {\n                let ret = \"\";\n                switch(localStorage[\"autoSong\"]) {\n                    case \"loop\":\n                        ret = \"loop\";\n                        break;\n                    case \"time\":\n                        ret = \"min\";\n                        break;\n                    case \"off\":\n                        /* falls through */\n                    default:\n                        return \"\";\n                }\n                if(localStorage[\"autoSongDelay\"] > 1) {\n                    ret += \"s\";\n                }\n                return ret;\n            }}\n        ]\n    },\n    autoSongShuffle : {\n        name : \"AutoSong shuffle\",\n        options : [\"off\", \"on\"]\n    },\n    autoSongFadeout : {\n        name : \"AutoSong fade out\",\n        options : [\"off\", \"on\"]\n    },\n    trippyMode : {\n        name : \"Trippy Mode\",\n        options : [\"off\", \"on\"]\n    },\n    shuffleImages : {\n        name : \"Shuffle images\",\n        options : [\"off\", \"on\"]\n    },\n    skipPreloader : {\n        name : \"Skip preloader warning\",\n        options : [\"off\", \"on\"]\n    }\n};\n\nclass HuesSettings {\n    constructor(defaults) {\n        this.eventListeners = {\n            /* callback updated()\n             *\n             * Called when settings are updated\n             */\n            updated : []\n        };\n        \n        this.hasUI = false;\n        \n        this.settingCheckboxes = {};\n        \n        this.textCallbacks = [];\n        this.visCallbacks = [];\n\n        for(let attr in defaultSettings) {\n          if(defaultSettings.hasOwnProperty(attr)) {\n              if(defaults[attr] === undefined) {\n                  defaults[attr] = defaultSettings[attr];\n              }\n              // don't write to local if it's a temp settings\n              if(ephemeralSettings.indexOf(attr) != -1) {\n                  continue;\n              }\n              if(defaults.overwriteLocal) {\n                  localStorage[attr] = defaults[attr];\n              }\n              // populate defaults, ignoring current\n              if(localStorage[attr] === undefined) {\n                  localStorage[attr] = defaults[attr];\n              }\n          }\n        }\n\n        this.defaults = defaults;\n        \n        // Override with our query string\n        let querySettings = this.getQuerySettings();\n        this.defaults.respacks = this.defaults.respacks.concat(querySettings.respacks);\n        for(let attr in querySettings) {\n          if(querySettings.hasOwnProperty(attr) && attr != \"respacks\") {\n              this.defaults[attr] = querySettings[attr];\n              \n              if(ephemeralSettings.indexOf(attr) == -1) {\n                  // TODO: Everything that checks localStorage for settings should\n                  // change to get() to preserve local changes\n                  localStorage[attr] = querySettings[attr];\n              }\n          }\n        }\n    }\n    \n    getQuerySettings() {\n        let results = {};\n        results.respacks = [];\n        let query = window.location.search.substring(1);\n        let vars = query.split(\"&\");\n        for (let i=0;i<vars.length;i++) {\n            let pair = vars[i].split(\"=\");\n            if(pair[0] == \"packs\" || pair[0] == \"respacks\"){\n                let packs = pair[1].split(\",\");\n                for(let j = 0; j < packs.length; j++) {\n                    results.respacks.push(this.defaults.respackPath + packs[j]);\n                }\n            } else if(pair[0] == \"song\") { // alias for firstSong\n                results.firstSong = pair[1];\n            } else {\n                results[pair[0]] = pair[1];\n            }\n        }\n        return results;\n    }\n\n    initUI(huesWin) {\n        let root = document.createElement(\"div\");\n        root.className = \"hues-options\";\n            \n        // Don't make in every loop\n        let intValidator = function(self, variable) {\n            this.value = this.value.replace(/\\D/g,'');\n            if(this.value === \"\" || this.value < 1) {\n                this.value = \"\";\n                return;\n            }\n            localStorage[variable] = this.value;\n            self.updateConditionals();\n            self.callEventListeners(\"updated\");\n        };\n\n        // To order things nicely\n        for(let cat in settingsCategories) {\n                if(settingsCategories.hasOwnProperty(cat)) {\n                let catContainer = document.createElement(\"div\");\n                catContainer.textContent = cat;\n                catContainer.className = \"settings-category\";\n                let cats = settingsCategories[cat];\n                for(let i = 0; i < cats.length; i++) {\n                    let setName = cats[i];\n                    let setContainer = document.createElement(\"div\");\n                    let setting = settingsOptions[setName];\n                    setContainer.textContent = setting.name;\n                    setContainer.className = \"settings-individual\";\n                    let buttonContainer = document.createElement(\"div\");\n                    buttonContainer.className = \"settings-buttons\";\n                    \n                    for(let j = 0; j < setting.options.length; j++) {\n                        let option = setting.options[j];\n                        if(typeof option === \"string\") {\n                            let checkbox = document.createElement(\"input\");\n                            // Save checkbox so we can update UI stuff\n                            this.settingCheckboxes[setName + \"-\" + option] = checkbox;\n                            checkbox.className = \"settings-checkbox\";\n                            checkbox.type = \"radio\";\n                            checkbox.value = option;\n                            let unique = 0;\n                            // Lets us have multiple hues on 1 page\n                            let id = setName + \"-\" + option + \"-\";\n                            while(document.getElementById(id + unique)) {\n                                unique++;\n                            }\n                            checkbox.name = setName + \"-\" + unique;\n                            checkbox.id = id + unique;\n                            if(localStorage[setName] == option) {\n                                checkbox.checked = true;\n                            }\n                            checkbox.onclick = function(self) {\n                                self.set(setName, this.value);\n                            }.bind(checkbox, this);\n                            buttonContainer.appendChild(checkbox);\n                            // So we can style this nicely\n                            let label = document.createElement(\"label\");\n                            label.className = \"settings-label\";\n                            label.htmlFor = checkbox.id;\n                            label.textContent = option.toUpperCase();\n                            buttonContainer.appendChild(label);\n                        } else { // special option\n                            if(option.type == \"varText\") {\n                                let text = document.createElement(\"span\");\n                                text.textContent = option.text();\n                                buttonContainer.appendChild(text);\n                                this.textCallbacks.push({func:option.text, element:text});\n                            } else if(option.type == \"input\") {\n                                let input = document.createElement(\"input\");\n                                input.setAttribute(\"type\", \"text\");\n                                input.className = \"settings-input\";\n                                input.value = localStorage[option.variable];\n                                // TODO: support more than just positive ints when the need arises\n                                if(option.inputType == \"int\") {\n                                    input.oninput = intValidator.bind(input, this, option.variable);\n                                }\n                                input.autofocus = false;\n                                buttonContainer.appendChild(input);\n                                if(option.visiblity) {\n                                    this.visCallbacks.push({func:option.visiblity, element:input});\n                                    input.style.visibility = option.visiblity() ? \"visible\" : \"hidden\";\n                                }\n                            }\n                        }\n\n                    }\n                    setContainer.appendChild(buttonContainer);\n                    catContainer.appendChild(setContainer);\n                }\n                root.appendChild(catContainer);\n            }\n        }\n        huesWin.addTab(\"OPTIONS\", root);\n        this.hasUI = true;\n    }\n\n    get(setting) {\n        if(this.defaults.hasOwnProperty(setting)) {\n            if(ephemeralSettings.indexOf(setting) != -1) {\n                return this.defaults[setting];\n            } else {\n                return localStorage[setting];\n            }\n        } else {\n            console.log(\"WARNING: Attempted to fetch invalid setting:\", setting);\n            return null;\n        }\n    }\n\n    // Set a named index to its named value, returns false if name doesn't exist\n    set(setting, value) {\n        value = value.toLowerCase();\n        let opt = settingsOptions[setting];\n        if(!opt || opt.options.indexOf(value) == -1) {\n            console.log(value, \"is not a valid value for\", setting);\n            return false;\n        }\n        // for updating the UI selection\n        try {\n            this.settingCheckboxes[setting + \"-\" + value].checked = true;\n        } catch(e) {}\n        localStorage[setting] = value;\n        this.updateConditionals();\n        this.callEventListeners(\"updated\");\n        return true;\n    }\n\n    updateConditionals() {\n        // update any conditionally formatted settings text\n        for(let i = 0; i < this.textCallbacks.length; i++) {\n            let text = this.textCallbacks[i];\n            text.element.textContent = text.func();\n        }\n        for(let i = 0; i < this.visCallbacks.length; i++) {\n            let callback = this.visCallbacks[i];\n            callback.element.style.visibility = callback.func() ? \"visible\" : \"hidden\";\n        }\n    }\n\n    // Note: This is not defaults as per defaultSettings, but those merged with\n    // the defaults given in the initialiser\n    setDefaults() {\n        for(let attr in this.defaults) {\n            if(this.defaults.hasOwnProperty(attr)) {\n                if(ephemeralSettings.indexOf(attr) != -1) {\n                    continue;\n                }\n                localStorage[attr] = this.defaults[attr];\n            }\n        }\n    }\n\n    callEventListeners(ev) {\n        let args = Array.prototype.slice.call(arguments, 1);\n        this.eventListeners[ev].forEach(function(callback) {\n            callback.apply(null, args);\n        });\n    }\n\n    addEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev].push(callback);\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n\n    removeEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\n                return (a !== callback);\n            });\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n}\n\nwindow.HuesSettings = HuesSettings;\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n (function(window, document) {\n\"use strict\";\n\n/*\n    Base UI Class for Hues display. Parent is an element\n    to put all your own elements under, but make a div\n    underneath so it can be entirely hidden.\n*/\nclass HuesUI {\n    \n    constructor(parent, name) {\n        if(!parent) {\n            return;\n        }\n        this.root = document.createElement(\"div\");\n        this.root.className = name ? name : this.constructor.name;\n        parent.appendChild(this.root);\n        this.root.style.visibility = \"hidden\";\n\n        this.core = null;\n\n        this.imageName = null;\n        this.imageLink = null;\n\n        this.songName = null;\n        this.songLink = null;\n\n        this.hueName = null;\n\n        this.imagePrev = null;\n        this.imageNext = null;\n        this.songPrev = null;\n        this.songNext = null;\n\n        this.beatCount = null;\n        this.timer = null;\n        this.xBlur = null;\n        this.yBlur = null;\n\n        this.settingsToggle = null;\n        this.hideToggle = null;\n        \n        // To deregister on UI hide we need to keep track of these\n        // Each callback is { name : \"callbackname\", func : function }\n        // Add using this.addCoreCallback\n        this.callbacks = [];\n\n        // Put this near the links to song/image lists/ Bottom right alignment\n        this.listContainer = null;\n        // Must be dynamic width, 64 pixels high. Will be filled with visualiser\n        this.visualiserContainer = null;\n\n        this.hidden = false;\n\n        this.initUI();\n    }\n\n    addCoreCallback(name, func) {\n        this.callbacks.push({name : name, func : func});\n    }\n\n    initUI() {\n        // Major info, image, song names\n        let imageName = document.createElement(\"div\");\n        this.imageName = imageName;\n\n        this.imageLink = document.createElement(\"a\");\n        this.imageLink.target = \"_blank\";\n        this.imageName.appendChild(this.imageLink);\n\n        let songName = document.createElement(\"div\");\n        this.songName = songName;\n\n        this.songLink = document.createElement(\"a\");\n        this.songLink.target = \"_blank\";\n        this.songName.appendChild(this.songLink);\n\n        let hueName = document.createElement(\"div\");\n        this.hueName = hueName;\n\n        // Prev/next controls\n        let imagePrev = document.createElement(\"div\");\n        imagePrev.textContent = \"<\";\n        imagePrev.onclick = () => {this.core.previousImage();};\n        this.imagePrev = imagePrev;\n        let imageNext = document.createElement(\"div\");\n        imageNext.textContent = \">\";\n        imageNext.onclick = () =>{this.core.nextImage();};\n        this.imageNext = imageNext;\n        let songPrev = document.createElement(\"div\");\n        songPrev.textContent = \"<\";\n        this.songPrev = songPrev;\n        songPrev.onclick = () =>{this.core.previousSong();};\n        let songNext = document.createElement(\"div\");\n        songNext.textContent = \">\";\n        songNext.onclick = () =>{this.core.nextSong();};\n        this.songNext = songNext;\n\n        let songList = document.createElement(\"div\");\n        songList.textContent = \"SONGS\";\n        songList.onclick = () =>{this.core.toggleSongList();};\n        this.songList = songList;\n        let imageList = document.createElement(\"div\");\n        imageList.textContent = \"IMAGES\";\n        imageList.onclick = () =>{this.core.toggleImageList();};\n        this.imageList = imageList;\n\n        // Beat timer, x and y blur, millis timer\n        this.timer = document.createElement(\"div\");\n        this.timer.textContent = \"T=$0x00000\";\n\n        this.beatCount = document.createElement(\"div\");\n        this.beatCount.textContent = \"B=$0x0000\";\n\n        this.xBlur = document.createElement(\"div\");\n        this.xBlur.textContent = \"X=$0x00\";\n\n        this.yBlur = document.createElement(\"div\");\n        this.yBlur.textContent = \"Y=$0x00\";\n\n        // Config stuff\n        this.settingsToggle = document.createElement(\"div\");\n        this.settingsToggle.innerHTML = '&#xe900;'; // COG\n        this.settingsToggle.className = 'hues-icon';\n        this.settingsToggle.onclick = () => {\n            this.core.window.toggle();\n        };\n\n        this.hideToggle = document.createElement(\"div\");\n        this.hideToggle.innerHTML = \"&#x25BC;\";\n        this.hideToggle.onclick = () => {\n            this.toggleHide();\n        };\n\n        this.listContainer = document.createElement(\"div\");\n        this.visualiserContainer = document.createElement(\"div\");\n\n        this.addCoreCallback(\"newsong\", this.newSong.bind(this));\n        this.addCoreCallback(\"newimage\", this.newImage.bind(this));\n        this.addCoreCallback(\"newcolour\", this.newColour.bind(this));\n        this.addCoreCallback(\"blurupdate\", this.blurUpdated.bind(this));\n        this.addCoreCallback(\"time\", this.updateTime.bind(this));\n        this.addCoreCallback(\"invert\", this.invert.bind(this));\n        this.resizeHandler = this.resize.bind(this);\n    }\n\n    connectCore(core) {\n        this.core = core;\n        this.root.style.visibility = \"visible\";\n        if(core.resourceManager.hasUI) {\n            this.listContainer.appendChild(core.resourceManager.listView);\n        }\n        this.visualiserContainer.appendChild(this.core.visualiser);\n\n        this.callbacks.forEach(function(callback) {\n            core.addEventListener(callback.name, callback.func);\n        });\n        window.addEventListener('resize', this.resizeHandler);\n        this.resizeHandler();\n    }\n\n    disconnect() {\n        this.callbacks.forEach(callback => {\n            this.core.removeEventListener(callback.name, callback.func);\n        });\n        this.core = null;\n        this.root.style.visibility = \"hidden\";\n        while (this.listContainer.firstElementChild) {\n            this.listContainer.removeChild(this.listContainer.firstElementChild);\n        }\n        while (this.visualiserContainer.firstElementChild) {\n            this.visualiserContainer.removeChild(this.visualiserContainer.firstElementChild);\n        }\n        window.removeEventListener('resize', this.resizeHandler);\n    }\n\n    // ONLY FOR CHANGING UI, NOT FOR \"HIDE\" FEATURE\n    show() {\n        this.root.style.visibility = \"visible\";\n    }\n\n    // ONLY FOR CHANGING UI, NOT FOR \"HIDE\" FEATURE\n    hide() {\n        this.root.style.visibility = \"hidden\";\n    }\n\n    toggleHide() {\n        this.hidden = !this.hidden;\n        if(this.hidden) {\n            this.root.classList.add(\"hues-ui--hidden\");\n        } else {\n            this.root.classList.remove(\"hues-ui--hidden\");\n        }\n    }\n\n    resize() {}\n    updateVolume(vol) {}\n\n    newSong(song) {\n        if(!song) {\n            return;\n        }\n\n        this.songLink.textContent = song.title.toUpperCase();\n        this.songLink.href = song.source;\n    }\n\n    newImage(image) {\n        if(!image) {\n            return;\n        }\n\n        let name = image.fullname ? image.fullname : image.name;\n\n        this.imageLink.textContent = name.toUpperCase();\n        this.imageLink.href = image.source ? image.source : \"\";\n    }\n\n    newColour(colour) {\n        this.hueName.textContent = colour.n.toUpperCase();\n    }\n\n    blurUpdated(x, y) {\n        x = Math.floor(x * 0xFF);\n        y = Math.floor(y * 0xFF);\n        this.xBlur.textContent = \"X=\" + this.intToHex(x, 2);\n        this.yBlur.textContent = \"Y=\" + this.intToHex(y, 2);\n    }\n\n    updateTime(time) {\n        time = Math.floor(time * 1000);\n        this.timer.textContent = \"T=\" + this.intToHex(time, 5);\n    }\n\n    intToHex(num, pad) {\n        let str = Math.abs(num).toString(16);\n        while (str.length < pad)\n            str = \"0\" + str;\n        let prefix = num < 0 ? \"-\" : \"$\";\n        return prefix + \"0x\" + str;\n    }\n\n    invert(invert) {\n        if (invert) {\n            this.root.classList.add(\"inverted\");\n        } else {\n            this.root.classList.remove(\"inverted\");\n        }\n    }\n}\n\n/*\n Individual UIs ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n*/\n\nclass RetroUI extends HuesUI {\n    constructor(parent, name) {\n        super(parent, name ? name : \"RetroUI\");\n    }\n\n    initUI() {\n        super.initUI();\n\n        let container = document.createElement(\"div\");\n        container.className = \"hues-r-container\";\n        this.root.appendChild(container);\n        this.container = container;\n\n        this.mode = document.createElement(\"div\");\n        container.appendChild(this.mode);\n        container.appendChild(this.imageName);\n        container.appendChild(this.timer);\n        container.appendChild(this.beatCount);\n        container.appendChild(this.xBlur);\n        container.appendChild(this.yBlur);\n\n        this.colourIndex = document.createElement(\"div\");\n        this.colourIndex.textContent = \"C=$0x00\";\n        container.appendChild(this.colourIndex);\n\n        this.version = document.createElement(\"div\");\n        container.appendChild(this.version);\n\n        container.appendChild(this.hueName);\n        container.appendChild(this.songName);\n\n        this.beatBar = document.createElement(\"div\");\n        container.appendChild(this.beatBar);\n\n        this.controls = document.createElement(\"div\");\n        this.controls.className = \"hues-r-controls\";\n\n        let imageMode = document.createElement(\"div\");\n        this.imageModeManual = document.createElement(\"div\");\n        this.imageModeManual.textContent = \"NORMAL\";\n        this.imageModeManual.onclick = () => {\n            this.core.setIsFullAuto(false);\n        };\n        this.imageModeManual.className = \"hues-r-manualmode hues-r-button\";\n        this.imageModeAuto = document.createElement(\"div\");\n        this.imageModeAuto.textContent = \"FULL AUTO\";\n        this.imageModeAuto.onclick = () => {\n            this.core.setIsFullAuto(true);\n        };\n        this.imageModeAuto.className = \"hues-r-automode hues-r-button\";\n        imageMode.appendChild(this.imageModeManual);\n        imageMode.appendChild(this.imageModeAuto);\n\n        this.imagePrev.className = \"hues-r-button\";\n        this.imageNext.className = \"hues-r-button\";\n        this.songPrev.className = \"hues-r-button\";\n        this.songNext.className = \"hues-r-button\";\n        this.controls.appendChild(this.imagePrev);\n        this.controls.appendChild(imageMode);\n        this.controls.appendChild(this.imageNext);\n\n        this.songList.className = \"hues-r-songs hues-r-button\";\n        this.controls.appendChild(this.songPrev);\n        this.controls.appendChild(this.songList);\n        this.controls.appendChild(this.songNext);\n\n        this.root.appendChild(this.controls);\n\n        let subControl = document.createElement(\"div\");\n        subControl.className = \"hues-r-subcontrols\";\n        subControl.appendChild(this.settingsToggle);\n        this.imageList.textContent = \"C\";\n        subControl.appendChild(this.imageList);\n        subControl.appendChild(this.hideToggle);\n        this.subControls = subControl;\n\n        this.root.appendChild(subControl);\n\n        this.hideRestore = document.createElement(\"div\");\n        this.hideRestore.className = \"hues-r-hiderestore\";\n        this.hideRestore.innerHTML = \"&#x25B2;\";\n        this.hideRestore.onclick = () => {\n            this.toggleHide();\n        };\n        this.root.appendChild(this.hideRestore);\n\n        this.listContainer.className = \"hues-r-listcontainer\";\n        this.root.appendChild(this.listContainer);\n        \n        this.visualiserContainer.className = \"hues-r-visualisercontainer\";\n        this.root.appendChild(this.visualiserContainer);\n        \n        this.addCoreCallback(\"beat\", this.beat.bind(this));\n        this.addCoreCallback(\"newmode\", this.newMode.bind(this));\n    }\n\n    toggleHide() {\n        this.hidden = !this.hidden;\n        if(this.hidden) {\n            this.subControls.classList.add(\"hues-ui--hidden\");\n            this.controls.classList.add(\"hues-ui--hidden\");\n            this.container.classList.add(\"hues-ui--hidden\");\n            this.hideRestore.classList.add(\"hues-ui--hidden\");\n        } else {\n            this.subControls.classList.remove(\"hues-ui--hidden\");\n            this.controls.classList.remove(\"hues-ui--hidden\");\n            this.container.classList.remove(\"hues-ui--hidden\");\n            this.hideRestore.classList.remove(\"hues-ui--hidden\");\n        }\n    }\n\n    connectCore(core) {\n        super.connectCore(core);\n\n        this.version.textContent = \"V=$\" + core.versionHex;\n    }\n\n    newMode(isAuto) {\n        this.mode.textContent = \"M=\" + (isAuto ? \"FULL AUTO\" : \"NORMAL\");\n    }\n\n    newImage(image) {\n        if(!image) {\n            return;\n        }\n\n        this.imageLink.textContent = \"I=\" + image.name.toUpperCase();\n        this.imageLink.href = image.source;\n    }\n\n    newColour(colour) {\n        super.newColour(colour);\n\n        this.colourIndex.textContent = \"C=\" + this.intToHex(this.core.colourIndex, 2);\n    }\n\n    beat(beats, index) {\n        let rest = beats.slice(1);\n        this.beatBar.textContent = \">>\" + rest;\n        this.beatCount.textContent = \"B=\" + this.intToHex(index, 4);\n    }\n\n    resize() {\n        this.core.visualiser.width = this.visualiserContainer.offsetWidth;\n        this.core.resizeVisualiser();\n    }\n}\n\nclass MinimalUI extends RetroUI {\n    constructor(parent, name) {\n        super(parent, name ? name : \"MinimalUI\");\n    }\n\n    initUI() {\n        super.initUI();\n        \n        this.root.removeChild(this.controls);\n        this.root.removeChild(this.subControls);\n        this.container.removeChild(this.beatBar);\n        this.container.innerHTML = \"\";\n        this.container.appendChild(this.beatBar);\n    }\n}\n\nclass WeedUI extends RetroUI {\n    constructor(parent, name) {\n        super(parent, name ? name : \"WeedUI\");\n\n        this.xVariance = 10;\n        this.yVariance = 20;\n    }\n\n    initUI() {\n        super.initUI();\n\n        this.container.removeChild(this.beatBar);\n\n        this.controls.className = \"hues-w-controls\";\n        this.subControls.className = \"hues-w-subcontrols\";\n\n        let beatBar = document.createElement(\"div\");\n        beatBar.className = \"hues-w-beatbar\";\n        this.root.appendChild(beatBar);\n        this.beatBar = beatBar;\n\n        let beatLeft = document.createElement(\"div\");\n        beatLeft.className = \"hues-w-beatleft\";\n        beatBar.appendChild(beatLeft);\n        this.beatLeft = beatLeft;\n\n        let beatRight = document.createElement(\"div\");\n        beatRight.className = \"hues-w-beatright\";\n        beatBar.appendChild(beatRight);\n        this.beatRight = beatRight;\n\n        this.imageModeManual.textContent = \"ONE\";\n        this.imageModeAuto.textContent = \"MANY\";\n        \n        this.visualiserContainer.className += \" hues-w-visualisercontainer\";\n    }\n\n    toggleHide() {\n        super.toggleHide(this);\n        if(this.hidden) {\n            this.beatBar.classList.add(\"hues-ui--hidden\");\n        } else {\n            this.beatBar.classList.remove(\"hues-ui--hidden\");\n        }\n    }\n\n    beat(beats, index) {\n        let rest = beats.slice(1);\n\n        this.beatLeft.textContent = rest;\n        this.beatRight.textContent = rest;\n        \n        this.beatCount.textContent = \"B=\" + this.intToHex(index, 4);\n\n        if([\"x\", \"o\", \"X\", \"O\"].indexOf(beats[0]) != -1) {\n            let beatCenter = document.createElement(\"div\");\n            beatCenter.className = \"hues-w-beataccent\";\n            let rot = this.round10(15 - Math.random() * 30);\n            let x = this.round10(- this.xVariance / 2 + Math.random() * this.xVariance);\n            let y = this.round10(30 - this.yVariance / 2 + Math.random() * this.yVariance);\n            let transform = \"rotate(\" + rot + \"deg) translate(\" + x + \"px, \" + y + \"px)\";\n            beatCenter.style.MozTransform    = transform;\n            beatCenter.style.webkitTransform = transform;\n            beatCenter.style.transform       = transform;\n            beatCenter.textContent = beats[0].toUpperCase();\n            this.root.appendChild(beatCenter);\n            window.setTimeout(this.removeBeat.bind(this, beatCenter), 1500);\n        }\n    }\n\n    round10(num) {\n        return Math.round(num * 10) / 10;\n    }\n\n    removeBeat(element) {\n        this.root.removeChild(element);\n    }\n}\n\nclass ModernUI extends HuesUI {\n    constructor(parent, name) {\n        super(parent, name ? name : \"ModernUI\");\n        \n        this.textSize_normal = 0;\n        this.textSize_small = 0;\n        this.songLink_size = 0;\n        this.imageLink_size = 0;\n\n        this.currentBeat = \".\";\n\n        this.hidden = 0; // we have a 3 stage hide\n    }\n\n    initUI() {\n        super.initUI();\n\n        this.imageName.className = \"hues-m-imagename\";\n        this.songName.className = \"hues-m-songtitle\";\n\n        let controls = document.createElement(\"div\");\n        controls.className = \"hues-m-controls\";\n        this.root.appendChild(controls);\n        this.controls = controls;\n\n        controls.appendChild(this.imageName);\n        controls.appendChild(this.songName);\n\n        let leftBox = document.createElement(\"div\");\n        leftBox.className = \"hues-m-leftbox\";\n        controls.appendChild(leftBox);\n        this.leftBox = leftBox;\n\n        this.hueName.className = \"hues-m-huename\";\n        leftBox.appendChild(this.hueName);\n\n        let volCluster = document.createElement(\"div\");\n        volCluster.className = \"hues-m-vol-cluster\";\n        leftBox.appendChild(volCluster);\n\n        this.settingsToggle.className += \" hues-m-cog\";\n        volCluster.appendChild(this.settingsToggle);\n\n        this.hideToggle.className = \"hues-m-hide\";\n        volCluster.appendChild(this.hideToggle);\n\n        let volBar = document.createElement(\"div\");\n        volBar.className = \"hues-m-vol-bar\";\n        this.volBar = volBar;\n        volCluster.appendChild(volBar);\n\n        let label = document.createElement(\"div\");\n        label.textContent = \"VOL\";\n        label.className = \"hues-m-vol-label\";\n        label.onclick = () => {\n            this.core.soundManager.toggleMute();\n        };\n        volBar.appendChild(label);\n        this.volLabel = label;\n\n        this.infoToggle = document.createElement(\"div\");\n        this.infoToggle.innerHTML = '?';\n        this.infoToggle.className = \"hues-m-question\";\n        this.infoToggle.onclick = () => {\n            this.core.window.selectTab(\"INFO\");\n        };\n        volCluster.appendChild(this.infoToggle);\n\n        let input = document.createElement(\"input\");\n        input.type = \"range\";\n        input.min = 0;\n        input.max = 1;\n        input.step = 0.1;\n        volBar.appendChild(input);\n        this.volInput = input;\n        input.oninput = () => {\n            this.core.soundManager.setVolume(parseFloat(input.value));\n        };\n\n        let rightBox = document.createElement(\"div\");\n        rightBox.className = \"hues-m-rightbox\";\n        controls.appendChild(rightBox);\n        this.rightBox = rightBox;\n\n        //Song/image controls\n        let songs = document.createElement(\"div\");\n        songs.className = \"hues-m-controlblock\";\n        this.songBlock = songs;\n        this.songList.className = \"hues-m-songbutton\";\n\n        let songControls = document.createElement(\"div\");\n        songControls.className = \"hues-m-controlbuttons\";\n        this.songPrev.className = \"hues-m-prevbutton\";\n        this.songNext.className = \"hues-m-nextbutton\";\n        this.songShuffle = document.createElement(\"div\");\n        this.songShuffle.innerHTML = '&#xe903;'; // SHUFFLE\n        this.songShuffle.className = \"hues-m-actbutton hues-icon\";\n        this.songShuffle.onclick = () => {this.core.randomSong();};\n        songs.appendChild(this.songList);\n        songControls.appendChild(this.songPrev);\n        songControls.appendChild(this.songShuffle);\n        songControls.appendChild(this.songNext);\n        songs.appendChild(songControls);\n        rightBox.appendChild(songs);\n\n        let images = document.createElement(\"div\");\n        images.className = \"hues-m-controlblock\";\n        this.imageList.className = \"hues-m-songbutton\";\n        this.imageBlock = images;\n\n        let imageControls = document.createElement(\"div\");\n        imageControls.className = \"hues-m-controlbuttons\";\n\n        this.imageMode = document.createElement(\"div\");\n        this.imageMode.innerHTML = \"&#xe901;\"; // PLAY\n        this.imageMode.className = \"hues-m-actbutton hues-icon\";\n        this.imageMode.onclick = () => {this.core.toggleFullAuto();};\n        this.imagePrev.className = \"hues-m-prevbutton\";\n        this.imageNext.className = \"hues-m-nextbutton\";\n        images.appendChild(this.imageList);\n        imageControls.appendChild(this.imagePrev);\n        imageControls.appendChild(this.imageMode);\n        imageControls.appendChild(this.imageNext);\n        images.appendChild(imageControls);\n        rightBox.appendChild(images);\n\n        let leftInfo = document.createElement(\"div\");\n        leftInfo.className = \"hues-m-leftinfo\";\n        let rightInfo = document.createElement(\"div\");\n        rightInfo.className = \"hues-m-rightinfo\";\n        leftInfo.appendChild(this.xBlur);\n        leftInfo.appendChild(this.yBlur);\n        rightInfo.appendChild(this.timer);\n        rightInfo.appendChild(this.beatCount);\n        this.rightInfo = rightInfo;\n        this.leftInfo = leftInfo;\n        controls.appendChild(leftInfo);\n        controls.appendChild(rightInfo);\n        \n        this.visualiserContainer.className = \"hues-m-visualisercontainer\";\n        controls.appendChild(this.visualiserContainer);\n\n        let beatBar = document.createElement(\"div\");\n        beatBar.className = \"hues-m-beatbar\";\n        this.root.appendChild(beatBar);\n        this.beatBar = beatBar;\n\n        let beatLeft = document.createElement(\"div\");\n        beatLeft.className = \"hues-m-beatleft\";\n        beatBar.appendChild(beatLeft);\n        this.beatLeft = beatLeft;\n\n        let beatRight = document.createElement(\"div\");\n        beatRight.className = \"hues-m-beatright\";\n        beatBar.appendChild(beatRight);\n        this.beatRight = beatRight;\n\n        let beatCenter = document.createElement(\"div\");\n        beatCenter.className = \"hues-m-beatcenter\";\n        this.root.appendChild(beatCenter);\n        this.beatCenter = beatCenter;\n\n        this.hideRestore = document.createElement(\"div\");\n        this.hideRestore.className = \"hues-m-hiderestore\";\n        this.hideRestore.onclick = () => {\n            this.toggleHide();\n        };\n        this.root.appendChild(this.hideRestore);\n\n        this.listContainer.className = \"hues-m-listcontainer\";\n        this.root.appendChild(this.listContainer);\n        \n        this.addCoreCallback(\"beat\", this.beat.bind(this));\n        this.addCoreCallback(\"newmode\", this.newMode.bind(this));\n    }\n\n    toggleHide() {\n        // classList is new-ish, but if you have web audio you'll have this\n        this.beatBar.classList.remove(\"hues-ui--hidden\");\n        this.beatCenter.classList.remove(\"hues-ui--hidden\");\n        this.controls.classList.remove(\"hues-ui--hidden\");\n        this.hideRestore.classList.remove(\"hues-ui--hidden\");\n        switch(this.hidden) {\n            case 1:\n                this.beatBar.classList.add(\"hues-ui--hidden\");\n                this.beatCenter.classList.add(\"hues-ui--hidden\");\n                /* falls through */\n            case 0:\n                this.controls.classList.add(\"hues-ui--hidden\");\n                this.hideRestore.classList.add(\"hues-ui--hidden\");\n        }\n        this.hidden = (this.hidden+1) % 3;\n    }\n\n    updateVolume(vol) {\n        this.volInput.value = vol;\n        if(vol === 0) {\n            this.volLabel.textContent = \"(VOL)\";\n        } else {\n            this.volLabel.textContent = \"VOL\";\n        }\n    }\n\n    newMode (isAuto) {\n        if(isAuto) {\n            this.imageMode.innerHTML = '&#xe902;'; // PAUSE;\n        } else {\n            this.imageMode.innerHTML = \"&#xe901;\"; // PLAY\n        }\n    }\n\n    beat(beats, index) {\n        this.currentBeat = beats[0];\n        let rest = beats.slice(1);\n\n        this.beatLeft.textContent = rest;\n        this.beatRight.textContent = rest;\n\n\n        if (this.currentBeat != \".\") {\n            while (this.beatCenter.firstElementChild) {\n                this.beatCenter.removeChild(this.beatCenter.firstElementChild);\n            }\n            let span = this.beatCenter.ownerDocument.createElement(\"span\");\n            span.textContent = this.currentBeat;\n            this.beatCenter.appendChild(span);\n        }\n        this.beatCount.textContent = \"B=\" + this.intToHex(index, 4);\n    }\n\n    // get the width of a single character in the link box for a given classname\n    textWidth(className) {\n        // Could be song or image link, don't care\n        let el = this.songLink;\n        let oldContent = el.innerHTML;\n\n        // offsetWidth is rounded, divide by 100\n        let text = \"\";\n        for(let i = 0; i < 100; i++) {\n            text += \"&nbsp;\";\n        }\n        el.innerHTML = text;\n        // We override this just after so don't bother to restore it\n        el.className = className;\n        let size = el.offsetWidth / 100;\n        \n        el.innerHTML = oldContent;\n        \n        return size;\n    }\n\n    resize() {\n        this.textSize_normal = this.textWidth(\"\");\n        this.textSize_small = this.textWidth(\"small\");\n        this.songLink_size = this.songName.clientWidth;\n        this.imageLink_size = this.imageName.clientWidth;\n\n        this.resizeSong();\n        this.resizeImage();\n        this.core.visualiser.width = this.controls.offsetWidth;\n        this.core.resizeVisualiser();\n    }\n\n    resizeElement(el, parentSize) {\n        let chars = el.textContent.length;\n        if (chars * this.textSize_normal < parentSize) {\n            el.className = \"\";\n        } else if(chars * this.textSize_small < parentSize) {\n            el.className = \"small\";\n        } else {\n            el.className = \"x-small\";\n        }\n    }\n\n    resizeSong() {\n        this.resizeElement(this.songLink, this.songLink_size);\n    }\n\n    resizeImage() {\n        this.resizeElement(this.imageLink, this.imageLink_size);\n    }\n\n    newSong(song) {\n        super.newSong(song);\n\n        if(!song) {\n            return;\n        }\n\n        this.resizeSong();\n    }\n\n    newImage(image) {\n        super.newImage(image);\n\n        if(!image) {\n            return;\n        }\n\n        this.resizeImage();\n    }\n}\n\nclass XmasUI extends ModernUI {\n    constructor(parent, name) {\n        super(parent, name ? name : \"XmasUI\");\n        this.initSnow();\n        \n         // This will cache our inverted lights images\n        this.invert(true);\n        \n        this.controls.removeChild(this.leftBox);\n        this.controls.removeChild(this.rightBox);\n        this.controls.removeChild(this.rightInfo);\n        this.controls.removeChild(this.leftInfo);\n\n        this.leftBox = null;\n        this.rightBox = null;\n        this.hueName = null;\n        this.xBlur = null;\n        this.yBlur = null;\n        this.timer = null;\n\n        this.controls.className += \" hues-x-controls\";\n        this.beatBar.className += \" hues-x-beatbar\";\n\n        this.lights = [];\n\n        let wires = document.createElement(\"div\");\n        wires.className = \"hues-x-wires\";\n\n        let left = document.createElement(\"div\");\n        left.className = \"hues-x-wiresleft\";\n        xleft.forEach(function(l, i, a) {\n            let light = this.newLight(l, left);\n            light.style.transform = \"rotate(\" + l.angle + \"deg)\";\n            light.style.left = l.x + \"px\";\n            light.style.top = l.y + \"px\";\n            this.lights.push(light);\n        }, this);\n\n        let right = document.createElement(\"div\");\n        right.className = \"hues-x-wiresright\";\n        xright.forEach(function(l, i, a) {\n            let light = this.newLight(l, right);\n            light.style.transform = \"rotate(\" + (-l.angle) + \"deg)\";\n            light.style.right = l.x + \"px\";\n            light.style.top = l.y + \"px\";\n            this.lights.push(light);\n        }, this);\n\n        let bottomHelper = document.createElement(\"div\");\n        bottomHelper.className = \"hues-x-wiresbottomhelper\";\n        let bottom = document.createElement(\"div\");\n        bottom.className = \"hues-x-wiresbottom\";\n        xbottom.forEach(function(l, i, a) {\n            let light = this.newLight(l, bottom);\n            light.style.transform = \"rotate(\" + l.angle + \"deg)\";\n            light.style.left = l.x + \"px\";\n            light.style.bottom = l.y + \"px\";\n            this.lights.push(light);\n        }, this);\n\n        wires.appendChild(left);\n        wires.appendChild(right);\n        bottomHelper.appendChild(bottom);\n        wires.appendChild(bottomHelper);\n        this.root.appendChild(wires);\n        \n        this.visualiserContainer.className = \"hues-x-visualisercontainer\";\n        this.controls.removeChild(this.visualiserContainer);\n        this.beatBar.appendChild(this.visualiserContainer);\n    }\n    \n    invert(invert) {\n        super.invert(invert);\n        \n        if(invert) {\n            this.snowContext.fillStyle = \"rgba(0, 0, 0, 0.8)\";\n        } else {\n            this.snowContext.fillStyle = \"rgba(255, 255, 255, 0.8)\";\n        }\n    }\n\n    connectCore(core) {\n        super.connectCore(core);\n        this.startSnow();\n    }\n\n    disconnect() {\n        this.stopSnow();\n        super.disconnect();\n    }\n\n    lightOn(light) {\n        light.on.className = \"hues-x-lighton\";\n        light.off.className = \"hues-x-lightoff\";\n    }\n\n    lightOff(light) {\n        light.on.className = \"hues-x-lighton off\";\n        light.off.className = \"hues-x-lightoff off\";\n    }\n\n    lightFadeOut(light) {\n        light.on.className = \"hues-x-lighton hues-x-fade off\";\n        light.off.className = \"hues-x-lightoff hues-x-fade off\";\n    }\n\n    lightRecolour(light) {\n        let hue = Math.floor(Math.random() * 7) * -56;\n        light.on.style.backgroundPosition = hue + \"px 0\";\n        light.off.style.backgroundPosition = hue + \"px 0\";\n    }\n\n    randomLight(light) {\n        if(Math.random() >= 0.5) {\n            this.lightOn(light);\n        } else {\n            this.lightOff(light);\n        }\n    }\n\n    newLight(l, parent) {\n        let light = document.createElement(\"div\");\n        light.className = \"hues-x-light\";\n        let bulb = document.createElement(\"div\");\n        let on = document.createElement(\"div\");\n        let off = document.createElement(\"div\");\n        bulb.appendChild(on);\n        bulb.appendChild(off);\n        light.appendChild(bulb);\n        parent.appendChild(light);\n        light.on = on;\n        light.off = off;\n        light.bulb = bulb;\n        this.randomLight(light);\n        this.lightRecolour(light);\n        return light;\n    }\n\n    beat(beats, index) {\n        super.beat(beats, index);\n        if(this.currentBeat != \".\") {\n            this.lights.forEach(function(light, i, a) {\n                switch(this.currentBeat) {\n                    case \":\": \n                        this.lightOn(light);\n                        this.lightRecolour(light);\n                        break;\n                    case \"+\": \n                        this.lightFadeOut(light);\n                        break;\n                    default:\n                        this.randomLight(light);\n                }\n            }, this);\n        }\n    }\n\n    initSnow() {\n        this.snowCanvas = document.createElement(\"canvas\");\n        this.snowContext = this.snowCanvas.getContext(\"2d\");\n        this.snowCanvas.width = 1280;\n        this.snowCanvas.height = 720;\n        this.snowCanvas.style.display = \"none\";\n        this.snowCanvas.className = \"hues-canvas hues-x-snow\";\n        \n        this.root.appendChild(this.snowCanvas);\n\n        this.snowing = false;\n        this.maxSnow = 30;\n        this.snowAngle = 0;\n        this.lastSnow = 0;\n        this.snowflakes = [];\n        \n        this.addCoreCallback(\"frame\", this.drawSnow.bind(this));\n    }\n\n    // From http://thecodeplayer.com/walkthrough/html5-canvas-snow-effect\n\n    startSnow() {\n        this.snowing = true;\n        this.snowCanvas.style.display = \"block\";\n        let height = this.snowCanvas.height;\n        let width = this.snowCanvas.width;\n        this.snowAngle = 0;\n        this.snowflakes = [];\n        for(let i = 0; i < this.maxSnow; i++) {\n            this.snowflakes.push({\n                x: Math.random()*width, //x-coordinate\n                y: Math.random()*height, //y-coordinate\n                r: Math.random()*4+1, //radius\n                d: Math.random()*25 //density\n            });\n        }\n        this.lastSnow = Date.now() / 1000;\n    }\n\n    stopSnow() {\n        this.snowing = false;\n        this.snowCanvas.style.display = \"none\";\n    }\n\n    drawSnow() {\n        let width = this.snowCanvas.width;\n        let height = this.snowCanvas.height;\n        let now = Date.now() / 1000;\n        let delta = this.lastSnow - now;\n        this.lastSnow = now;\n        this.snowContext.clearRect(0, 0, width, height);\n\n        this.snowContext.beginPath();\n        for(let i = 0; i < this.maxSnow; i++) {\n            let flake = this.snowflakes[i];\n            this.snowContext.moveTo(flake.x, flake.y);\n            this.snowContext.arc(flake.x, flake.y, flake.r, 0, Math.PI * 2, true);\n        }\n        this.snowContext.fill();\n\n        this.snowAngle += delta / 6;\n        for(let i = 0; i < this.maxSnow; i++) {\n            let flake = this.snowflakes[i];\n            //Updating X and Y coordinates\n            //We will add 1 to the cos function to prevent negative values which will lead flakes to move upwards\n            //Every particle has its own density which can be used to make the downward movement different for each flake\n            //Lets make it more random by adding in the radius\n            flake.y += Math.cos(this.snowAngle + flake.d) + 1 + flake.r / 2;\n            flake.x += Math.sin(this.snowAngle) * 2;\n\n            //Sending flakes back from the top when it exits\n            //Lets make it a bit more organic and let flakes enter from the left and right also.\n            if(flake.x > width + 5 || flake.x < -5 || flake.y > height) {\n                if(i % 3 > 0) {//66.67% of the flakes\n                    this.snowflakes[i] = {x: Math.random() * width, y: -10, r: flake.r, d: flake.d};\n                }\n                else {\n                    //If the flake is exitting from the right\n                    if(Math.sin(this.snowAngle) > 0) {\n                        //Enter from the left\n                        this.snowflakes[i] = {x: -5, y: Math.random() * height, r: flake.r, d: flake.d};\n                    }\n                    else {\n                        //Enter from the right\n                        this.snowflakes[i] = {x: width+5, y: Math.random() * height, r: flake.r, d: flake.d};\n                    }\n                }\n            }\n        }\n    }\n\n    resize() {\n        super.resize();\n        \n        let ratio = window.innerWidth / window.innerHeight;\n        // cleared on resize\n        let savedFill = this.snowContext.fillStyle;\n        this.snowCanvas.width = Math.ceil(720 * ratio);\n        this.snowContext.fillStyle = savedFill;\n    }\n\n    newColour(colour) {}\n    blurUpdated(x, y) {}\n    updateTime(time) {}\n}\n\nclass HalloweenUI extends ModernUI {\n    constructor(parent, name) {\n        super(parent, name ? name : \"HalloweenUI\");\n        // This will cache our inverted tombstone image\n        this.invert(true);\n    }\n\n    initUI() {\n        super.initUI();\n        \n        this.controls.className += \" hues-h-controls\";\n        this.beatBar.className += \" hues-h-beatbar\";\n        this.leftBox.className += \" hues-h-leftbox\";\n        this.rightBox.className += \" hues-h-rightbox\";\n        this.volBar.className += \" hues-h-vol-bar\";\n        \n        this.beatLeft.className += \" hues-h-text\";\n        this.beatRight.className += \" hues-h-text\";\n        this.beatCenter.className += \" hues-h-text\";\n        this.songShuffle.className += \" hues-h-text\";\n        this.songNext.className += \" hues-h-text\";\n        this.songPrev.className += \" hues-h-text\";\n        this.songList.className += \" hues-h-text\";\n        this.songName.className += \" hues-h-text\";\n        this.imageMode.className += \" hues-h-text\";\n        this.imageNext.className += \" hues-h-text\";\n        this.imagePrev.className += \" hues-h-text\";\n        this.imageList.className += \" hues-h-text\";\n        this.imageName.className += \" hues-h-text\";\n        this.hueName.className += \" hues-h-text\";\n        \n        this.settingsToggle.className += \" hues-h-text\";\n        this.hideToggle.className += \" hues-h-text\";\n        this.infoToggle.className += \" hues-h-text\";\n        this.volLabel.className += \" hues-h-text\";\n        \n        this.timer.className = \"hues-h-textfade\";\n        this.beatCount.className = \"hues-h-textfade\";\n        this.xBlur.className = \"hues-h-textfade\";\n        this.yBlur.className = \"hues-h-textfade\";\n        \n        let leftBoxTomb = document.createElement(\"div\");\n        leftBoxTomb.className = \"hues-h-tombstone\";\n        this.leftBox.appendChild(leftBoxTomb);\n        \n        let songTomb = document.createElement(\"div\");\n        songTomb.className = \"hues-h-tombstone\";\n        this.songBlock.insertBefore(songTomb,this.songBlock.firstChild);\n        \n        let imageTomb = document.createElement(\"div\");\n        imageTomb.className = \"hues-h-tombstone\";\n        this.imageBlock.insertBefore(imageTomb,this.imageBlock.firstChild);\n        \n        let topLeft = document.createElement(\"div\");\n        topLeft.className = \"hues-h-topleft\";\n        let topRight = document.createElement(\"div\");\n        topRight.className = \"hues-h-topright\";\n        let bottomRight = document.createElement(\"div\");\n        bottomRight.className = \"hues-h-bottomright\";\n        \n        this.root.appendChild(topLeft);\n        this.root.appendChild(topRight);\n        this.root.appendChild(bottomRight);\n        \n        let leftHand = document.createElement(\"div\");\n        leftHand.className = \"hues-h-left-hand\";\n        this.beatBar.appendChild(leftHand);\n        let rightHand = document.createElement(\"div\");\n        rightHand.className = \"hues-h-right-hand\";\n        this.beatBar.appendChild(rightHand);\n        \n        this.vignette = document.createElement(\"div\");\n        this.vignette.className = \"hues-h-vignette\";\n        this.root.appendChild(this.vignette);\n    }\n\n    beat(beats, index) {\n        super.beat(beats, index);\n        \n        if (this.currentBeat != \".\") {\n            let eyes = this.beatCenter.ownerDocument.createElement(\"div\");\n            eyes.className = \"hues-m-beatcenter hues-h-eyes\";\n            this.beatCenter.appendChild(eyes);\n        }\n    }\n\n    connectCore(core) {\n        super.connectCore(core);\n        \n        this.core.preloader.classList.add(\"hues-h-text\");\n    }\n\n    disconnect() {\n        this.core.preloader.classList.remove(\"hues-h-text\");\n        \n        super.disconnect();\n    }\n}\n\n// Positions and angles for the Xmas lights\nlet xleft = [\n    {\"angle\": 122.529582194, \"x\": 19.4, \"y\": -19.35},\n    {\"angle\": 92.5309436511, \"x\": 25.4, \"y\": 38.7},\n    {\"angle\": 107.530202659, \"x\": 39.4, \"y\": 107.75},\n    {\"angle\": 77.5309700777, \"x\": 20.75, \"y\": 184.8},\n    {\"angle\": 77.5309700777, \"x\": 32.3, \"y\": 249.8},\n    {\"angle\": 107.530202659, \"x\": 40.45, \"y\": 327.9},\n    {\"angle\": 88.3307935055, \"x\": 35, \"y\": 410.9},\n    {\"angle\": 107.530202659, \"x\": 54.35, \"y\": 490.95},\n    {\"angle\": 74.9981580491, \"x\": 28.15, \"y\": 573.8},\n    {\"angle\": 89.9973772074, \"x\": 23.45, \"y\": 675.35},\n    {\"angle\": 107.530202659, \"x\": 21.65, \"y\": 762.6},\n    {\"angle\": 107.530202659, \"x\": 15.8, \"y\": 842.75},\n    {\"angle\": 92.5309436511, \"x\": 36.55, \"y\": 905.7},\n    {\"angle\": 88.3307935055, \"x\": 31.1, \"y\": 988.7},\n    {\"angle\": 107.530202659, \"x\": 50.45, \"y\": 1068.75},\n    {\"angle\": 74.9981580491, \"x\": 45.75, \"y\": 1158.5},\n    {\"angle\": 88.3307935055, \"x\": 35.85, \"y\": 1238.55}\n];\nlet xright = [\n    {\"angle\": 120.001009518, \"x\": 33.3, \"y\": -29.75},\n    {\"angle\": 90.0026227926, \"x\": 35.35, \"y\": 53.65},\n    {\"angle\": 102.469029922, \"x\": 41.5, \"y\": 136.5},\n    {\"angle\": 91.6692064945, \"x\": 22.15, \"y\": 216.55},\n    {\"angle\": 72.4697973408, \"x\": 34.4, \"y\": 278.25},\n    {\"angle\": 102.469029922, \"x\": 45.75, \"y\": 361.85},\n    {\"angle\": 87.4699314665, \"x\": 26.65, \"y\": 426.35},\n    {\"angle\": 72.4697973408, \"x\": 41.6, \"y\": 502.15},\n    {\"angle\": 102.469029922, \"x\": 27.5, \"y\": 566},\n    {\"angle\": 72.4697973408, \"x\": 7.65, \"y\": 638.45},\n    {\"angle\": 102.469029922, \"x\": 11, \"y\": 721.25},\n    {\"angle\": 76.1887724128, \"x\": 7.65, \"y\": 792.7},\n    {\"angle\": 87.4690563489, \"x\": 36.15, \"y\": 850.35},\n    {\"angle\": 102.46813454, \"x\": 16.6, \"y\": 924.3},\n    {\"angle\": 72.4697973408, \"x\": 15.3, \"y\": 990.8},\n    {\"angle\": 76.1887724128, \"x\": 11.95, \"y\": 1062.25},\n    {\"angle\": 87.4690563489, \"x\": 40.45, \"y\": 1119.9},\n    {\"angle\": 102.46813454, \"x\": 20.9, \"y\": 1193.85}\n];\nlet xbottom = [\n    {\"angle\": 32.5804579323, \"x\": 110.35, \"y\": -12.1},\n    {\"angle\": 3.28979777069, \"x\": 168.05, \"y\": -5.55},\n    {\"angle\": 17.6989154099, \"x\": 238.35, \"y\": 7.7},\n    {\"angle\": -12.6587029361, \"x\": 314.8, \"y\": -10.4},\n    {\"angle\": -12.6587029361, \"x\": 379.4, \"y\": 1.05},\n    {\"angle\": 17.6989154099, \"x\": 457.75, \"y\": 9.4},\n    {\"angle\": 2.59102780115, \"x\": 540.6, \"y\": 3.75},\n    {\"angle\": 17.6989154099, \"x\": 620.35, \"y\": 22.7},\n    {\"angle\": -15.134241831, \"x\": 703, \"y\": -2.9},\n    {\"angle\": 2.30443717424, \"x\": 804.75, \"y\": -7.85},\n    {\"angle\": 17.6989154099, \"x\": 892.45, \"y\": -9.55},\n    {\"angle\": 17.6989154099, \"x\": 971.65, \"y\": -15.5},\n    {\"angle\": 3.28979777069, \"x\": 1035.2, \"y\": 4.35},\n    {\"angle\": 2.59102780115, \"x\": 1118, \"y\": 0.2},\n    {\"angle\": 17.6989154099, \"x\": 1198.05, \"y\": 18.95},\n    {\"angle\": -18.378894807, \"x\": 1288.2, \"y\": 14.2},\n    {\"angle\": -4.561224264, \"x\": 1367.9, \"y\": 4.6},\n    {\"angle\": 32.5804579323, \"x\": 1452.6, \"y\": -1.7},\n    {\"angle\": 3.28979777069, \"x\": 1511.45, \"y\": 4.45},\n    {\"angle\": 17.6989154099, \"x\": 1580.6, \"y\": 17.6},\n    {\"angle\": -12.6587029361, \"x\": 1656.6, \"y\": -0.95},\n    {\"angle\": -12.6587029361, \"x\": 1722.1, \"y\": 11.1},\n    {\"angle\": 17.6989154099, \"x\": 1800.5, \"y\": 18.8},\n    {\"angle\": 2.59102780115, \"x\": 1883.1, \"y\": 13},\n    {\"angle\": 17.6989154099, \"x\": 1963, \"y\": 32.6},\n    {\"angle\": -15.134241831, \"x\": 2045.8, \"y\": 7},\n    {\"angle\": 2.30443717424, \"x\": 2147.55, \"y\": 1.55},\n    {\"angle\": 17.6989154099, \"x\": 2234.1, \"y\": 0.4},\n    {\"angle\": 17.6989154099, \"x\": 2315, \"y\": -5.6},\n    {\"angle\": 3.28979777069, \"x\": 2377.8, \"y\": 14.5},\n    {\"angle\": 2.59102780115, \"x\": 2460.65, \"y\": 9.75},\n    {\"angle\": 17.6989154099, \"x\": 2540.2, \"y\": 28.5},\n    {\"angle\": -18.378894807, \"x\": 2627.55, \"y\": 24.9},\n    {\"angle\": -4.561224264, \"x\": 2710.4, \"y\": 14.4}\n];\n\nwindow.RetroUI = RetroUI;\nwindow.WeedUI = WeedUI;\nwindow.ModernUI = ModernUI;\nwindow.XmasUI = XmasUI;\nwindow.HalloweenUI = HalloweenUI;\nwindow.MinimalUI = MinimalUI;\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n(function(window, document) {\n\"use strict\"; \n\nclass HuesWindow {\n    constructor(root, defaults) {\n        this.eventListeners = {\n            /* callback windowshown(shown)\n             *\n             * When the window is shown, hidden or toggled this fires.\n             * 'shown' is true if the window was made visible, false otherwise\n             */\n            windowshown : [],\n            /* callback tabselected(tabName)\n             *\n             * The name of the tab that was selected\n             */\n            tabselected : []\n        };\n        \n        this.hasUI = defaults.enableWindow;\n        \n        if(!this.hasUI)\n            return;\n        \n        this.window = document.createElement(\"div\");\n        this.window.className = \"hues-win-helper\";\n        root.appendChild(this.window);\n        \n        let actualWindow = document.createElement(\"div\");\n        actualWindow.className = \"hues-win\";\n        this.window.appendChild(actualWindow);\n        \n        let closeButton = document.createElement(\"div\");\n        closeButton.className = \"hues-win__closebtn\";\n        closeButton.onclick = this.hide.bind(this);\n        actualWindow.appendChild(closeButton);\n        \n        this.tabContainer = document.createElement(\"div\");\n        this.tabContainer.className = \"hues-win__tabs\";\n        actualWindow.appendChild(this.tabContainer);\n        \n        this.contentContainer = document.createElement(\"div\");\n        this.contentContainer.className = \"hues-win__content\";\n        actualWindow.appendChild(this.contentContainer);\n        \n        this.contents = [];\n        this.tabs = [];\n        this.tabNames = [];\n\n        \n        if(defaults.showWindow) {\n            this.show();\n        } else {\n            this.hide();\n        }\n    }\n\n    addTab(tabName, tabContent) {\n        if(!this.hasUI)\n            return;\n        \n        let label = document.createElement(\"div\");\n        label.textContent = tabName;\n        label.className = \"tab-label\";\n        label.onclick = this.selectTab.bind(this, tabName);\n        this.tabContainer.appendChild(label);\n        this.tabs.push(label);\n        this.tabNames.push(tabName);\n        \n        let content = document.createElement(\"div\");\n        content.className = \"tab-content\";\n        content.appendChild(tabContent);\n        this.contentContainer.appendChild(content);\n        this.contents.push(content);\n    }\n\n    selectTab(tabName, dontShowWin) {\n        if(!this.hasUI)\n            return;\n        if(!dontShowWin) {\n            this.show();\n        }\n        for(let i = 0; i < this.tabNames.length; i++) {\n            let name = this.tabNames[i];\n            if(tabName.toLowerCase() == name.toLowerCase()) {\n                this.contents[i].classList.add(\"tab-content--active\");\n                this.tabs[i].classList.add(\"tab-label--active\");\n                this.callEventListeners(\"tabselected\", name);\n            } else {\n                this.contents[i].classList.remove(\"tab-content--active\");\n                this.tabs[i].classList.remove(\"tab-label--active\");\n            }\n        }\n    }\n\n    hide() {\n        if(!this.hasUI)\n            return;\n        \n        this.window.classList.add(\"hidden\");\n        this.callEventListeners(\"windowshown\", false);\n    }\n\n    show() {\n        if(!this.hasUI)\n            return;\n        \n        this.window.classList.remove(\"hidden\");\n        this.callEventListeners(\"windowshown\", true);\n    }\n\n    toggle() {\n        if(!this.hasUI)\n            return;\n        if(this.window.classList.contains(\"hidden\")) {\n            this.show();\n        } else {\n            this.hide();\n        }\n    }\n\n    callEventListeners(ev) {\n        let args = Array.prototype.slice.call(arguments, 1);\n        this.eventListeners[ev].forEach(function(callback) {\n            callback.apply(null, args);\n        });\n    }\n\n    addEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev].push(callback);\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n\n    removeEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\n                return (a !== callback);\n            });\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n}\n\nwindow.HuesWindow = HuesWindow;\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n (function(window, document) {\n\"use strict\";\n\nlet TAB_SONGS = 0;\nlet TAB_IMAGES = 1;\n\n// For multiple Hues on one page\nlet unique = 0;\nlet getAndIncrementUnique = function() {\n    return unique++;\n};\n\n// NOTE: Any packs referenced need CORS enabled or loads fail\nlet packsURL = \"https://cdn.0x40hu.es/getRespacks.php\";\n\nclass Resources {\n    constructor(core, huesWin) {\n        this.core = core;\n        this.hasUI = false;\n\n        this.resourcePacks = [];\n\n        this.allSongs = [];\n        this.allImages = [];\n        this.enabledSongs = [];\n        this.enabledImages = [];\n\n        this.progressState = [];\n        this.progressCallback = null;\n\n        // For songs/images\n        this.listView = null;\n        this.enabledSongList = null;\n        this.enabledImageList = null;\n        this.packView = {\n            pack: null,\n            name: null,\n            creator: null,\n            size: null,\n            desc: null,\n            songCount: null,\n            imageCount: null,\n            songList: null,\n            imageList: null,\n            packButtons: null,\n            totalSongs: null,\n            totalImages: null\n        };\n        this.packsView = {\n            respackList: null,\n            remoteList: null,\n            loadRemote: null,\n            progressBar: null,\n            progressStatus: null,\n            progressCurrent: null,\n            progressTop: null,\n            progressPercent: null\n        };\n        this.currentTab = TAB_SONGS;\n        this.unique = getAndIncrementUnique();\n        this.remotes = null;\n        this.fileInput = null;\n        this.fileParseQueue = [];\n        if(core.settings.defaults.enableWindow) {\n            this.initUI();\n            huesWin.addTab(\"RESOURCES\", this.root);\n        }\n    }\n\n    /* Uses HTTP HEAD requests to get the size of all the linked URLs\n       Returns an Promise.all which will resolve to an array of sizes */\n    getSizes(urls) {\n        let promises = [];\n        \n        urls.forEach(url => {\n            let p = new Promise((resolve, reject) => {\n                let xhr = new XMLHttpRequest();\n                xhr.open(\"HEAD\", url, true);\n                xhr.onreadystatechange = function() {\n                    if (this.readyState == this.DONE) {\n                        let bytes = parseInt(xhr.getResponseHeader(\"Content-Length\"));\n                        resolve(bytes / 1024 / 1024);\n                    }\n                };\n                xhr.onerror = function() {\n                    reject(Error(req.status + \": Could not fetch respack at \" + url));\n                };\n                xhr.send();\n            }).catch(error => {\n                // Infinitely more user friendly than the error Same Origin gives\n                if(error.code == 1012) {\n                    throw Error(\"Respack at URL \" + url + \" is restricted. Check CORS.\");\n                } else {\n                    throw error;\n                }\n            });\n            promises.push(p);\n        });\n        \n        return Promise.all(promises);\n    }\n\n    // Array of URLs to load, and a callback for when we're done\n    // Preserves order of URLs being loaded\n    addAll(urls, progressCallback) {\n        if(progressCallback) {\n            this.progressCallback = progressCallback;\n            this.progressState = Array.apply(null, Array(urls.length)).map(Number.prototype.valueOf,0);\n        }\n        \n        let respackPromises = [];\n        \n        let progressFunc = function(index, progress, pack) {\n                this.progressState[index] = progress;\n                this.updateProgress(pack);\n        };\n        \n        for(let i = 0; i < urls.length; i++) {\n            let r = new Respack();\n            respackPromises.push(r.loadFromURL(urls[i], progressFunc.bind(this, i)));\n        }\n        // Start all the promises at once, but add in sequence\n        return respackPromises.reduce((sequence, packPromise) => {\n            return sequence.then(() => {\n                return packPromise;\n            }).then(pack => {\n                this.addPack(pack);\n            });\n        }, Promise.resolve());\n    }\n\n    updateProgress(pack) {\n        let total = 0;\n        for(let i = 0; i < this.progressState.length; i++) {\n            total += this.progressState[i];\n        }\n        total /= this.progressState.length;\n        this.progressCallback(total, pack);\n    }\n\n    addPack(pack) {\n        console.log(\"Added\", pack.name, \"to respacks\");\n        let id = this.resourcePacks.length;\n        this.resourcePacks.push(pack);\n        this.addResourcesToArrays(pack);\n        this.rebuildEnabled();\n        this.updateTotals();\n\n        let self = this;\n        this.appendListItem(\"respacks\", pack.name, \"res\" + id, this.packsView.respackList,\n            function() {\n                pack.enabled = this.checked;\n                self.rebuildEnabled();\n            }, function(id) {\n                this.selectPack(id);\n            }.bind(this, id)\n        );\n    }\n\n    addResourcesToArrays(pack) {\n        this.allImages = this.allImages.concat(pack.images);\n        this.allSongs = this.allSongs.concat(pack.songs);\n    }\n\n    rebuildArrays() {\n        this.allSongs = [];\n        this.allImages = [];\n        this.allAnimations = [];\n\n        for(let i = 0; i < this.resourcePacks.length; i++) {\n            this.addResourcesToArrays(this.resourcePacks[i]);\n        }\n    }\n\n    rebuildEnabled() {\n        this.enabledSongs = [];\n        this.enabledImages = [];\n\n        for(let i = 0; i < this.resourcePacks.length; i++) {\n            let pack = this.resourcePacks[i];\n            if (pack.enabled !== true) {\n                continue;\n            }\n            for(let j = 0; j < pack.songs.length; j++) {\n                let song = pack.songs[j];\n                if (song.enabled && this.enabledSongs.indexOf(song) == -1) {\n                    this.enabledSongs.push(song);\n                }\n            }\n            for(let j = 0; j < pack.images.length; j++) {\n                let image = pack.images[j];\n                if (image.enabled && this.enabledImages.indexOf(image) == -1) {\n                   this.enabledImages.push(image);\n                }\n            }\n        }\n        if(this.hasUI) {\n            let songList = this.enabledSongList;\n            while(songList.firstElementChild) {\n                songList.removeChild(songList.firstElementChild);\n            }\n            let imageList = this.enabledImageList;\n            while(imageList.firstElementChild) {\n                imageList.removeChild(imageList.firstElementChild);\n            }\n            for(let i = 0; i < this.enabledSongs.length; i++) {\n                let song = this.enabledSongs[i];\n                this.appendSimpleListItem(song.title, songList, function(index) {\n                    this.core.setSong(index);\n                }.bind(this, i));\n            }\n            for(let i = 0; i < this.enabledImages.length; i++) {\n                let image = this.enabledImages[i];\n                this.appendSimpleListItem(image.name, imageList, function(index) {\n                    this.core.setImage(index);\n                    this.core.setIsFullAuto(false);\n                }.bind(this, i));\n            }\n        }\n        this.updateTotals();\n    }\n\n    removePack(pack) {\n        let index = this.resourcePacks.indexOf(pack);\n        if (index != -1) {\n            this.resourcePacks.splice(index, 1);\n            this.rebuildArrays();\n            this.rebuildEnabled();\n        }\n    }\n\n    removeAllPacks() {\n        this.resourcePacks = [];\n        this.rebuildArrays();\n        this.rebuildEnabled();\n    }\n\n    getSongNames() {\n        let names = [];\n        for(let i = 0; i < this.allSongs.length; i++) {\n            names.push(this.allSongs[i]);\n        }\n        return names;\n    }\n\n    loadLocal() {\n        console.log(\"Loading local zip(s)\");\n        \n        let files = this.fileInput.files;\n        let p = Promise.resolve();\n        for(let i = 0; i < files.length; i++) {\n            let r = new Respack();\n            /*jshint -W083 */\n            p = p.then(() => {\n                return r.loadFromBlob(files[i], (progress, respack) => {\n                    this.localProgress(progress, respack);\n                });\n            }).then(pack => {\n                this.addPack(pack);\n                this.localComplete();\n            });\n        }\n        return p.then(() => {\n            console.log(\"Local respack parsing complete\");\n        });\n    }\n\n    localProgress(progress, respack) {\n        if(!this.hasUI) {return;}\n        this.packsView.progressStatus.textContent = \"Processing...\";\n\n        this.packsView.progressBar.style.width = (progress * 100) + \"%\";\n        this.packsView.progressCurrent.textContent = respack.filesLoaded;\n        this.packsView.progressTop.textContent = respack.filesToLoad;\n        this.packsView.progressPercent.textContent = Math.round(progress * 100) + \"%\";\n    }\n\n    localComplete(progress) {\n        let progStat = this.packsView.progressStatus;\n        progStat.textContent = \"Complete\";\n        window.setTimeout(function() {progStat.textContent = \"Idle\";}, 2000);\n\n        this.packsView.progressBar.style.width = \"100%\";\n        this.packsView.progressCurrent.textContent = \"0b\";\n        this.packsView.progressTop.textContent = \"0b\";\n        this.packsView.progressPercent.textContent = \"0%\";\n    }\n\n    initUI() {\n        this.root = document.createElement(\"div\");\n        this.root.className = \"respacks\";\n        \n        let packsContainer = document.createElement(\"div\");\n        packsContainer.className = \"respacks__manager\";\n\n        let packHeader = document.createElement(\"div\");\n        packHeader.textContent = \"Current respacks\";\n        packHeader.className = \"respacks__header\";\n        let packList = document.createElement(\"div\");\n        packList.className = \"resource-list\";\n        this.packsView.respackList = packList;\n        // so we don't use it out of scope in the next if\n        let remoteHeader = null;\n        let remoteList = null;\n        if(!this.core.settings.defaults.disableRemoteResources) {\n            remoteHeader = document.createElement(\"div\");\n            remoteHeader.textContent = \"Remote respacks\";\n            remoteHeader.className = \"respacks__header\";\n            remoteList = document.createElement(\"div\");\n            remoteList.className = \"resource-list resource-list--fill\";\n            packList.classList.add(\"resource-list--fill\");\n            this.appendSimpleListItem(\"Click to load the list\", remoteList,\n                this.loadRemotes.bind(this));\n            this.packsView.remoteList = remoteList;\n        }\n\n        let buttons = document.createElement(\"div\");\n        buttons.className = \"respacks-buttons\";\n        let loadRemote = document.createElement(\"div\");\n        loadRemote.className = \"hues-button hidden\";\n        loadRemote.textContent = \"LOAD REMOTE\";\n        loadRemote.onclick = this.loadCurrentRemote.bind(this);\n        let loadLocal = document.createElement(\"div\");\n        loadLocal.className = \"hues-button\";\n        loadLocal.textContent = \"LOAD ZIPS\";\n        loadLocal.onclick = () => {this.fileInput.click();};\n        buttons.appendChild(loadLocal);\n        buttons.appendChild(loadRemote);\n        this.packsView.loadRemote = loadRemote;\n\n        this.fileInput = document.createElement(\"input\");\n        this.fileInput.type =\"file\";\n        this.fileInput.accept=\"application/zip\";\n        this.fileInput.multiple = true;\n        this.fileInput.onchange = this.loadLocal.bind(this);\n\n        let progressContainer = document.createElement(\"div\");\n        progressContainer.className = \"progress-container respacks-bottom-container\";\n        let progressBar = document.createElement(\"div\");\n        progressBar.className = \"progress-bar\";\n        let progressFilled = document.createElement(\"span\");\n        progressFilled.className = \"progress-bar--filled\";\n        progressBar.appendChild(progressFilled);\n        let progressStatus = document.createElement(\"div\");\n        progressStatus.textContent = \"Idle\";\n\n        let progressTexts = document.createElement(\"div\");\n        progressTexts.className = \"stat-text\";\n        let progressCurrent = document.createElement(\"div\");\n        progressCurrent.textContent = \"0b\";\n        let progressTop = document.createElement(\"div\");\n        progressTop.textContent = \"0b\";\n        let progressPercent = document.createElement(\"div\");\n        progressPercent.textContent = \"0%\";\n        progressTexts.appendChild(progressCurrent);\n        progressTexts.appendChild(progressTop);\n        progressTexts.appendChild(progressPercent);\n\n        this.packsView.progressBar = progressFilled;\n        this.packsView.progressStatus = progressStatus;\n        this.packsView.progressCurrent = progressCurrent;\n        this.packsView.progressTop = progressTop;\n        this.packsView.progressPercent = progressPercent;\n        progressContainer.appendChild(progressStatus);\n        progressContainer.appendChild(progressBar);\n        progressContainer.appendChild(progressTexts);\n\n        packsContainer.appendChild(packHeader);\n        packsContainer.appendChild(packList);\n        if(!this.core.settings.defaults.disableRemoteResources) {\n            packsContainer.appendChild(remoteHeader);\n            packsContainer.appendChild(remoteList);\n        }\n        packsContainer.appendChild(buttons);\n        packsContainer.appendChild(progressContainer);\n\n        let indivView = document.createElement(\"div\");\n        indivView.className = \"respacks__display\";\n\n        let packName = document.createElement(\"div\");\n        packName.textContent = \"<select a respack>\";\n        packName.className = \"respacks__header\";\n        let packInfo = document.createElement(\"div\");\n        packInfo.className = \"stat-text\";\n        let packCreator = document.createElement(\"div\");\n        let packCreatorText = document.createElement(\"a\");\n        packCreatorText.className = \"unstyled-link\";\n        packCreatorText.textContent = \"<author>\";\n        packCreator.appendChild(packCreatorText);\n        packInfo.appendChild(packCreator);\n        let packSize = document.createElement(\"div\");\n        packSize.textContent = \"0b\";\n        packInfo.appendChild(packSize);\n        let packDesc = document.createElement(\"div\");\n        packDesc.className = \"respack-description\";\n        packDesc.textContent = \"<no description>\";\n        \n        let tabContainer = document.createElement(\"div\");\n        tabContainer.className = \"respack-tab-container\";\n        \n        let songCount = document.createElement(\"div\");\n        songCount.textContent = \"Songs:\";\n        songCount.className = \"respack-tab respack-tab--checked\";\n\n        let imageCount = document.createElement(\"div\");\n        imageCount.textContent = \"Images:\";\n        imageCount.className = \"respack-tab\";\n\n        let songList = document.createElement(\"div\");\n        songList.className = \"resource-list respack-tab__content respack-tab__content--checked\";\n        let imageList = document.createElement(\"div\");\n        imageList.className = \"resource-list respack-tab__content\";\n        \n        songCount.onclick = () => {\n            songCount.classList.add(\"respack-tab--checked\");\n            imageCount.classList.remove(\"respack-tab--checked\");\n            \n            songList.classList.add(\"respack-tab__content--checked\");\n            imageList.classList.remove(\"respack-tab__content--checked\");\n            \n            this.currentTab = TAB_SONGS;\n        };\n        \n        imageCount.onclick = () => {\n            imageCount.classList.add(\"respack-tab--checked\");\n            songCount.classList.remove(\"respack-tab--checked\");\n            \n            imageList.classList.add(\"respack-tab__content--checked\");\n            songList.classList.remove(\"respack-tab__content--checked\");\n            \n            this.currentTab = TAB_IMAGES;\n        };\n\n        let packButtons = document.createElement(\"div\");\n        packButtons.className = \"respacks-buttons respacks-buttons--fill invisible\";\n        let enableAll = document.createElement(\"div\");\n        enableAll.textContent = \"ENABLE ALL\";\n        enableAll.className = \"hues-button\";\n        enableAll.onclick = this.enableAll.bind(this);\n        let invert = document.createElement(\"div\");\n        invert.textContent = \"INVERT\";\n        invert.className = \"hues-button\";\n        invert.onclick = this.invert.bind(this);\n        let disableAll = document.createElement(\"div\");\n        disableAll.textContent = \"DISABLE ALL\";\n        disableAll.className = \"hues-button\";\n        disableAll.onclick = this.disableAll.bind(this);\n        packButtons.appendChild(enableAll);\n        packButtons.appendChild(invert);\n        packButtons.appendChild(disableAll);\n\n        let totalCounts = document.createElement(\"div\");\n        totalCounts.className = \"respacks-bottom-container\";\n\n        let totalSongsCont = document.createElement(\"div\");\n        totalSongsCont.className = \"respacks-count-container\";\n        let totalSongsLabel = document.createElement(\"span\");\n        totalSongsLabel.textContent = \"Total Songs:\";\n        let totalSongs = document.createElement(\"span\");\n        totalSongs.className = \"respacks-counts\";\n        totalSongsCont.appendChild(totalSongsLabel);\n        totalSongsCont.appendChild(totalSongs);\n\n        let totalImagesCont = document.createElement(\"div\");\n        totalImagesCont.className = \"respacks-count-container\";\n        let totalImagesLabel = document.createElement(\"span\");\n        totalImagesLabel.textContent = \"Total images:\";\n        let totalImages = document.createElement(\"span\");\n        totalImages.className = \"respacks-counts\";\n        totalImagesCont.appendChild(totalImagesLabel);\n        totalImagesCont.appendChild(totalImages);\n\n        totalCounts.appendChild(totalSongsCont);\n        totalCounts.appendChild(totalImagesCont);\n\n        this.packView.name = packName;\n        this.packView.creator = packCreatorText;\n        this.packView.size = packSize;\n        this.packView.desc = packDesc;\n        this.packView.songCount = songCount;\n        this.packView.imageCount = imageCount;\n        this.packView.songList = songList;\n        this.packView.imageList = imageList;\n        this.packView.packButtons = packButtons;\n        this.packView.totalSongs = totalSongs;\n        this.packView.totalImages = totalImages;\n\n        indivView.appendChild(packName);\n        indivView.appendChild(packInfo);\n        indivView.appendChild(packDesc);\n        \n        tabContainer.appendChild(songCount);\n        tabContainer.appendChild(imageCount);\n        indivView.appendChild(tabContainer);\n        indivView.appendChild(songList);\n        indivView.appendChild(imageList);\n        \n        indivView.appendChild(packButtons);\n        indivView.appendChild(totalCounts);\n\n        this.root.appendChild(packsContainer);\n        this.root.appendChild(indivView);\n\n        this.listView = document.createElement(\"div\");\n        this.enabledSongList = document.createElement(\"div\");\n        this.enabledSongList.className = \"resource-list respacks-enabledsongs hidden\";\n        this.enabledImageList = document.createElement(\"div\");\n        this.enabledImageList.className = \"resource-list respacks-enabledimages hidden\";\n\n        this.listView.appendChild(this.enabledSongList);\n        this.listView.appendChild(this.enabledImageList);\n        \n        this.hasUI = true;\n    }\n\n    hideLists() {\n        if(!this.hasUI) {return;}\n        this.enabledSongList.classList.add(\"hidden\");\n        this.enabledImageList.classList.add(\"hidden\");\n    }\n\n    toggleVisible(me, other) {\n        if(!this.hasUI) {return;}\n        if(me.classList.contains(\"hidden\")) {\n            me.classList.remove(\"hidden\");\n        } else {\n            me.classList.add(\"hidden\");\n        }\n        other.classList.add(\"hidden\");\n    }\n\n    toggleSongList() {\n        this.toggleVisible(this.enabledSongList, this.enabledImageList);\n    }\n\n    toggleImageList() {\n        this.toggleVisible(this.enabledImageList, this.enabledSongList);\n    }\n\n    updateTotals() {\n        if(!this.hasUI) {return;}\n        this.packView.totalSongs.textContent =\n                this.enabledSongs.length + \"/\" + this.allSongs.length;\n        this.packView.totalImages.textContent =\n                this.enabledImages.length + \"/\" + this.allImages.length;\n    }\n\n    truncateNum(num) {\n        return Math.round(num * 100) / 100;\n    }\n\n    selectPack(id) {\n        let pack = this.resourcePacks[id];\n        this.packView.pack = pack;\n\n        this.packView.packButtons.classList.remove(\"invisible\");\n        this.packsView.loadRemote.classList.add(\"hidden\");\n\n        this.packView.name.textContent = pack.name;\n        this.packView.creator.textContent = pack.author;\n        this.packView.creator.href = pack.link ? pack.link : \"\";\n        let size = pack.size / 1024;\n        if(size < 512) {\n            this.packView.size.textContent = this.truncateNum(size) + \"kB\";\n        } else {\n            this.packView.size.textContent = this.truncateNum(size / 1024) + \"MB\";\n        }\n        this.packView.desc.textContent = pack.description;\n        this.packView.songCount.textContent = \"Songs: \" + pack.songs.length;\n        this.packView.imageCount.textContent = \"Images: \" + pack.images.length;\n\n        let songList = this.packView.songList;\n        let imageList = this.packView.imageList;\n        while (songList.firstElementChild) {\n            songList.removeChild(songList.firstElementChild);\n        }\n        while (imageList.firstElementChild) {\n            imageList.removeChild(imageList.firstElementChild);\n        }\n\n        for(let i = 0; i < pack.songs.length; i++) {\n            let song = pack.songs[i];\n            this.appendListItem(\"songs\", song.title, \"song\" + i, songList,\n                this.selectResourceCallback(song),\n                this.clickResourceCallback.bind(this, song, true),\n                song.enabled);\n        }\n\n        for(let i = 0; i < pack.images.length; i++) {\n            let image = pack.images[i];\n            this.appendListItem(\"images\", image.name, \"image\" + i, imageList,\n                this.selectResourceCallback(image),\n                this.clickResourceCallback.bind(this, image, false),\n                image.enabled);\n        }\n    }\n\n    selectResourceCallback(res) {\n        let self = this;\n        return function() {\n            res.enabled = this.checked;\n            self.rebuildEnabled();\n        };\n    }\n\n    clickResourceCallback(res, isSong) {\n        if(!res.enabled) {\n            res.enabled = true;\n            this.rebuildEnabled();\n            // rebuild display\n            this.selectPack(this.resourcePacks.indexOf(this.packView.pack));\n        }\n        if(isSong) {\n            this.core.setSong(this.enabledSongs.indexOf(res));\n        } else {\n            this.core.setImage(this.enabledImages.indexOf(res));\n            this.core.setIsFullAuto(false);\n        }\n    }\n\n    getEnabledTabContents() {\n        let pack = this.packView.pack;\n        if(!pack) {\n            return null;\n        }\n        if(this.currentTab == TAB_SONGS) {\n            return {arr: pack.songs,\n                    elName: \"song\"};\n        } else {\n            return {arr: pack.images,\n                    elName: \"image\"};\n        }\n    }\n\n    enableAll() {\n        let tab = this.getEnabledTabContents();\n        if(!tab)\n            return;\n        for(let i = 0; i < tab.arr.length; i++) {\n            tab.arr[i].enabled = true;\n            document.getElementById(tab.elName + i + \"-\" + this.unique).checked = true;\n        }\n        this.rebuildEnabled();\n    }\n\n    disableAll() {\n        let tab = this.getEnabledTabContents();\n        if(!tab)\n            return;\n        for(let i = 0; i < tab.arr.length; i++) {\n            tab.arr[i].enabled = false;\n            document.getElementById(tab.elName + i + \"-\" + this.unique).checked = false;\n        }\n        this.rebuildEnabled();\n    }\n\n    invert() {\n        let tab = this.getEnabledTabContents();\n        if(!tab)\n            return;\n        for(let i = 0; i < tab.arr.length; i++) {\n            tab.arr[i].enabled = !tab.arr[i].enabled;\n            document.getElementById(tab.elName + i + \"-\" + this.unique).checked = tab.arr[i].enabled;\n        }\n        this.rebuildEnabled();\n    }\n\n    appendListItem(name, value, id, root, oncheck, onclick, checked) {\n        if(!this.hasUI) {return;}\n        if(checked === undefined) {\n            checked = true;\n        }\n        let div = document.createElement(\"div\");\n        div.className = \"respacks-listitem\";\n        let checkbox = document.createElement(\"input\");\n        checkbox.type = \"checkbox\";\n        checkbox.name = name;\n        checkbox.value = value;\n        checkbox.id = id + \"-\" + this.unique;\n        checkbox.checked = checked;\n        checkbox.onclick = oncheck;\n        let checkStyler = document.createElement(\"label\");\n        checkStyler.htmlFor = checkbox.id;\n        let label = document.createElement(\"span\");\n        label.textContent = value;\n        label.onclick = onclick;\n        div.appendChild(checkbox);\n        div.appendChild(checkStyler);\n        div.appendChild(label);\n        root.appendChild(div);\n    }\n\n    loadRemotes() {\n        let remoteList = this.packsView.remoteList;\n        while(remoteList.firstElementChild) {\n            remoteList.removeChild(remoteList.firstElementChild);\n        }\n        let item = this.appendSimpleListItem(\"Loading...\", remoteList);\n\n        let req = new XMLHttpRequest();\n        req.open('GET', packsURL, true);\n        req.responseType = 'json';\n        req.onload = () => {\n            if(!req.response) {\n                req.onerror();\n            }\n            this.remotes = req.response;\n            this.populateRemotes();\n        };\n        req.onerror = () => {\n            item.textContent = \"Could not load list! Click to try again\";\n            item.onclick = this.loadRemotes.bind(this);\n        };\n        req.send();\n    }\n\n    populateRemotes() {\n        let remoteList = this.packsView.remoteList;\n        while(remoteList.firstElementChild) {\n            remoteList.removeChild(remoteList.firstElementChild);\n        }\n        for(let i = 0; i < this.remotes.length; i++) {\n            this.remotes[i].loaded = false;\n            this.appendSimpleListItem(this.remotes[i].name, remoteList,\n                function(index) {\n                    this.selectRemotePack(index);\n                }.bind(this, i));\n        }\n    }\n\n    selectRemotePack(id) {\n        let pack = this.remotes[id];\n        this.packView.pack = pack;\n\n        this.packView.packButtons.classList.add(\"invisible\");\n        this.packsView.loadRemote.classList.remove(\"hidden\");\n        if(pack.loaded) {\n            this.packsView.loadRemote.classList.add(\"hues-button--loaded\");\n            this.packsView.loadRemote.textContent = \"LOADED\";\n        } else {\n            this.packsView.loadRemote.classList.remove(\"hues-button--loaded\");\n            this.packsView.loadRemote.textContent = \"LOAD REMOTE\";\n        }\n\n        this.packView.name.textContent = pack.name;\n        this.packView.creator.textContent = pack.author;\n        this.packView.creator.href = pack.link ? pack.link : \"\";\n        let size = pack.size / 1024;\n        if(size < 512) {\n            this.packView.size.textContent = this.truncateNum(size) + \"kB\";\n        } else {\n            this.packView.size.textContent = this.truncateNum(size / 1024) + \"MB\";\n        }\n        this.packView.desc.textContent = pack.description;\n        this.packView.songCount.textContent = \"Songs: \" + pack.songcount;\n        this.packView.imageCount.textContent = \"Images: \" + pack.imagecount;\n\n        let songList = this.packView.songList;\n        let imageList = this.packView.imageList;\n        while (songList.firstElementChild) {\n            songList.removeChild(songList.firstElementChild);\n        }\n        while (imageList.firstElementChild) {\n            imageList.removeChild(imageList.firstElementChild);\n        }\n\n        for(let i = 0; i < pack.songs.length; i++) {\n            let song = pack.songs[i];\n            this.appendSimpleListItem(song, songList);\n        }\n        let moreSongs = pack.songcount - pack.songs.length;\n        if(moreSongs > 0) {\n            let text = \"... and \" + moreSongs + \" more song\";\n            if(moreSongs > 1) {\n                text += \"s\";\n            }\n            this.appendSimpleListItem(text + \".\", songList);\n            this.appendSimpleListItem(\"Load the respack to show the rest!\", songList);\n        }\n\n        for(let i = 0; i < pack.images.length; i++) {\n            let image = pack.images[i];\n            this.appendSimpleListItem(image, imageList);\n        }\n        let moreImages = pack.imagecount - pack.images.length;\n        if(moreImages > 0) {\n            let text = \"... and \" + moreImages + \" more image\";\n            if(moreImages > 1) {\n                text += \"s\";\n            }\n            this.appendSimpleListItem(text + \".\", imageList);\n            this.appendSimpleListItem(\"Load the respack to show the rest!\", imageList);\n        }\n    }\n\n    loadCurrentRemote() {\n        let pack = this.packView.pack;\n\n        // Not actually a remote, ignore. How did you press this :<\n        if(pack.loaded === undefined || pack.loaded) {\n            return;\n        }\n\n        // TODO Error checking on failure\n        pack.loaded = true;\n        this.packsView.loadRemote.className = \"hues-button hues-button--loaded\";\n        this.packsView.loadRemote.textContent = \"LOADING\";\n        this.addAll([pack.url], (progress, respack) => {\n                this.remoteProgress(progress, respack);\n            }\n        ).then(this.remoteComplete.bind(this));\n    }\n\n    remoteProgress(progress, respack) {\n        if(progress < 0.5) {\n            this.packsView.progressStatus.textContent = \"Downloading...\";\n            this.packsView.progressCurrent.textContent = Math.round(respack.downloaded / 1024) + \"b\";\n            this.packsView.progressTop.textContent = Math.round(respack.size / 1024) + \"b\";\n            this.packsView.progressBar.style.width = (progress * 2 * 100) + \"%\";\n            this.packsView.progressPercent.textContent = Math.round(progress * 2 * 100) + \"%\";\n        } else {\n            this.packsView.progressStatus.textContent = \"Processing...\";\n            this.packsView.progressCurrent.textContent = respack.filesLoaded;\n            this.packsView.progressTop.textContent = respack.filesToLoad;\n            this.packsView.progressBar.style.width = ((progress - 0.5) * 2 * 100) + \"%\";\n            this.packsView.progressPercent.textContent = Math.round((progress - 0.5) * 2 * 100) + \"%\";\n        }\n    }\n\n    remoteComplete() {\n        let progStat = this.packsView.progressStatus;\n        progStat.textContent = \"Complete\";\n        window.setTimeout(function() {progStat.textContent = \"Idle\";}, 2000);\n        this.packsView.loadRemote.textContent = \"LOADED\";\n\n        this.packsView.progressBar.style.width = \"100%\";\n        this.packsView.progressCurrent.textContent = \"0b\";\n        this.packsView.progressTop.textContent = \"0b\";\n        this.packsView.progressPercent.textContent = \"0%\";\n    }\n\n    appendSimpleListItem(value, root, onclick) {\n        let div = document.createElement(\"div\");\n        div.className = \"respacks-listitem\";\n        let label = document.createElement(\"span\");\n        // Because we're using textContent, we replace with literal &\n        label.textContent = value.replace(/&amp;/g, '&');\n        label.onclick = onclick;\n        div.appendChild(label);\n        root.appendChild(div);\n        return label;\n    }\n}\n\nwindow.Resources = Resources;\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n (function(window, document) {\n\"use strict\";\n\nconst debugConsole = false;\nfunction debug() {\n    if(debugConsole) {\n        console.log.apply(window.console, arguments);\n    }\n}\n\nconst audioExtensions = new RegExp(\"\\\\.(mp3|ogg|wav)$\", \"i\");\nconst imageExtensions = new RegExp(\"\\\\.(png|gif|jpg|jpeg)$\", \"i\");\nconst animRegex = new RegExp(\"(.*?)_\\\\d+$\");\n\nclass Respack {\n    constructor() {\n        this.songs = [];\n        this.songQueue = [];\n        this.images = [];\n        this.imageQueue = [];\n\n        this.name = \"<no name>\";\n        this.author = \"<unknown>\";\n        this.description = \"<no description>\";\n        this.link = null;\n\n        this.size = -1;\n        this.downloaded = -1;\n        this.enabled = true;\n\n        this._xmlQueue = [];\n\n        this.totalFiles = -1;\n\n        // For zip parsing progress events\n        this.progressCallback = null;\n        this.filesToLoad = 0;\n        this.filesLoaded = 0;\n        this.loadedFromURL = false;\n    }\n\n    updateProgress(override) {\n        if(this.progressCallback) {\n            let percent = this.filesLoaded / this.filesToLoad;\n            if(this.loadedFromURL) {\n                percent = (percent / 2) + 0.5;\n            }\n            this.progressCallback(typeof override === \"number\" ? override : percent, this);\n        }\n    }\n\n    loadFromURL(url, progress) {\n        this.loadedFromURL = true;\n        if(progress) {\n            this.progressCallback = progress;\n        }\n\n        return this.getBlob(url)\n        .then(response => {\n            return this.loadFromBlob(response);\n        });\n    }\n\n    getBlob(url, progress) {\n        if(progress) {\n            this.progressCallback = progress;\n        }\n        return new Promise ((resolve, reject) => {\n            let req = new XMLHttpRequest();\n            req.open('GET', url, true);\n            req.responseType = 'blob';\n            req.onload = () => {\n                if(req.status == 200) {\n                    resolve(req.response);\n                } else {\n                    reject(Error(req.status + \": Could not fetch respack at \" + url));\n                }\n            };\n            req.onerror = function() {\n                reject(Error(req.status + \": Could not fetch respack at \" + url));\n            };\n            req.onprogress = event => {\n                if (event.lengthComputable) {\n                    this.size = event.total;\n                    this.downloaded = event.loaded;\n                    let percent = event.loaded / event.total;\n                    if(this.progressCallback) {\n                        this.progressCallback(percent / 2, this); // because of processing too\n                    }\n                }\n            };\n            req.send();\n        }).catch(error => {\n            // Infinitely more user friendly than the error Same Origin gives\n            if(error.code == 1012) {\n                throw Error(\"Respack at URL \" + url + \" is restricted. Check CORS.\");\n            } else {\n                throw error;\n            }\n        });\n    }\n\n    loadFromBlob(blob, progress) {\n        if(progress) {\n            this.progressCallback = progress;\n        }\n        // We don't get progress events for loading the zip, set 0 progress\n        this.updateProgress(this.loadedFromURL ? 0.5 : 0);\n        return new Promise((resolve, reject) => {\n            this.size = blob.size;\n            let file = new zip.fs.FS();\n            file.importBlob(blob,\n                () => {\n                    resolve(file);\n                },\n                error => {   // failure\n                    reject(Error(\"Respack error:\", error.toString()));\n                }\n            );\n        }).then(zip => {\n            return this.parseZip(zip);\n        }).then(() => {\n            return this;\n        });\n    }\n\n    parseZip(zip) {\n        let entries = zip.entries;\n\n        this.totalFiles = 0;\n        // Progress events\n        this.filesToLoad = 0;\n        this.filesLoaded = 0;\n\n        // Get everything started\n        for(let i = 0; i < entries.length; i++) {\n            if(!entries[i].directory && entries[i].name) {\n                this.totalFiles++;\n                this.parseFile(entries[i]);\n            }\n        }\n\n        return this.parseSongQueue()\n        .then(() => {\n            return this.parseImageQueue();\n        }).then(() => {\n            return this.parseXML();\n        }).then(() => {\n            // Cleanup\n            this._xmlQueue = [];\n            console.log(\"Loaded\", this.name, \"successfully with\", this.songs.length,\n                        \"songs and\", this.images.length, \"images.\");\n        });\n    }\n\n    parseFile(file) {\n        let name = file.name;\n        if (name.match(audioExtensions)) {\n            this.songQueue.push(this.parseSong(file));\n            this.filesToLoad++;\n        } else if (name.match(imageExtensions)) {\n            this.imageQueue.push(this.parseImage(file));\n            this.filesToLoad++;\n        } else if(name.toLowerCase().endsWith(\".xml\")){\n            this._xmlQueue.push(this.loadXML(file));\n        }\n    }\n\n    parseSong(file) {\n        let name = file.name.replace(audioExtensions, \"\");\n        debug(\"parsing song: \" + name);\n        if (this.containsSong(name)) {\n            let oldSong = this.getSong(name);\n            debug(\"WARNING: Song\", name, \"already exists! Conflict with\", name, \"and\", oldSong.name);\n        } else {\n            let newSong = {\"name\":name,\n                           \"title\":null,\n                           \"rhythm\":null,\n                           \"source\":null,\n                           //\"crc\":this.quickCRC(file), TODO\n                           \"sound\":null,\n                           \"enabled\":true,\n                           \"filename\":file.name,\n                           \"charsPerBeat\": null};\n            let extension = file.name.split('.').pop().toLowerCase();\n            let mime = \"\";\n            switch(extension) {\n                case \"mp3\":\n                    mime = \"audio/mpeg3\";\n                    break;\n                case \"ogg\":\n                    mime = \"audio/ogg\";\n                    break;\n                case \"wav\":\n                    mime = \"audio/wav\";\n                    break;\n                default:\n                    mime = \"application/octet-stream\";\n            }\n            this.songs.push(newSong);\n            return new Promise((resolve, reject) => {\n                file.getBlob(mime, sound => {\n                    resolve(sound);\n                });\n            }).then(blob => {\n                return new Promise((resolve, reject) => {\n                    // Because blobs are crap\n                    let fr = new FileReader();\n                    fr.onload = () => {\n                        resolve(fr.result);\n                    };\n                    fr.readAsArrayBuffer(blob);\n                });\n            }).then(sound => {\n                newSong.sound = sound;\n                this.filesLoaded++;\n                this.updateProgress();\n            });\n        }\n    }\n\n    parseSongQueue() {\n        return this.songQueue.reduce((sequence, songPromise) => {\n            return sequence.then(() => {\n                // Maintain order\n                return songPromise;\n            });\n        }, Promise.resolve());\n    }\n\n    parseImage(file) {\n        let match;\n        let name = file.name.replace(imageExtensions, \"\");\n        let img;\n\n        // Animation\n        if((match = name.match(new RegExp(\"^(.*)_(\\\\d+)$\")))) {\n            img = this.getImage(match[1]);\n            if(!img) { // make a fresh one\n                img = {\"name\":match[1],\n                        \"fullname\":match[1],\n                        \"align\":\"center\",\n                        //\"crc\":this.quickCRC(file),\n                        \"bitmaps\":[],\n                        \"frameDurations\":[33],\n                        \"source\":null,\n                        \"enabled\":true,\n                        \"animated\":true,\n                        \"beatsPerAnim\": null};\n                this.images.push(img);\n            }\n        // Normal image\n        } else if (!this.containsImage(name)) {\n            img = {\"name\":name,\n                    \"fullname\":name,\n                    \"bitmap\":null,\n                    \"align\":\"center\",\n                    //\"crc\":this.quickCRC(file),\n                    \"source\":null,\n                    \"enabled\":true,\n                    \"filename\":file.name,\n                    \"animated\":false};\n            this.images.push(img);\n        } else {\n            let existing = this.getImage(name);\n            console.log(\"WARNING: Image\", name, \"already exists! Conflict with\", file.name, \"and\", existing.name);\n            return;\n        }\n        \n        return this.loadImage(file, img);\n    }\n\n    loadImage(imgFile, imageObj) {\n        let extension = imgFile.name.split('.').pop().toLowerCase();\n        let mime = \"\";\n        switch(extension) {\n            case \"png\":\n                mime = \"image/png\";\n                break;\n            case \"gif\":\n                mime = \"image/gif\";\n                break;\n            case \"jpg\":\n            case \"jpeg\":\n                mime = \"image/jpeg\";\n                break;\n            default:\n                mime = \"application/octet-stream\";\n        }\n        return new Promise((resolve, reject) => {\n            imgFile.getData64URI(mime, resolve);\n        }).then(bitmap => {\n            this.filesLoaded++;\n            this.updateProgress();\n            return {bitmap: bitmap, img: imageObj};\n        });\n    }\n\n    parseImageQueue() {\n        return this.imageQueue.reduce((sequence, imagePromise) => {\n            return sequence.then(() => {\n                // Maintain order\n                return imagePromise;\n            }).then(response => {\n                // Don't crash if the respack had duplicate images\n                if(!response)\n                    return;\n                let newImg = new Image();\n                newImg.src = response.bitmap;\n                if (response.img.animated) {\n                    response.img.bitmaps.push(newImg);\n                } else {\n                    response.img.bitmap = newImg;\n                }\n            });\n        }, Promise.resolve());\n    }\n\n    loadXML(file) {\n        return new Promise((resolve, reject) => {\n            file.getText(text => {\n                //XML parser will complain about a bare '&', but some respacks use &amp\n                text = text.replace(/&amp;/g, '&');\n                text = text.replace(/&/g, '&amp;');\n                let parser = new DOMParser();\n                let dom = parser.parseFromString(text, \"text/xml\");\n                resolve(dom);\n            });\n        });\n    }\n\n    parseXML() {\n        for(let i = 0; i < this._xmlQueue.length; i++) {\n            this._xmlQueue[i] = this._xmlQueue[i].then(dom => {\n                switch(dom.documentElement.nodeName) {\n                    case \"songs\":\n                        if(this.songs.length > 0)\n                            this.parseSongFile(dom);\n                        break;\n                    case \"images\":\n                        if(this.images.length > 0)\n                            this.parseImageFile(dom);\n                        break;\n                    case \"info\":\n                        this.parseInfoFile(dom);\n                        break;\n                    default:\n                        console.log(\"XML found with no songs, images or info\");\n                        break;\n                }\n            });\n        }\n        return Promise.all(this._xmlQueue);\n    }\n\n    parseSongFile(dom) {\n        debug(\" - Parsing songFile\");\n\n        let newSongs = [];\n        let el = dom.documentElement.firstElementChild;\n        for(; el; el = el.nextElementSibling) {\n            let song = this.getSong(el.attributes[0].value);\n            if(song) {\n                song.title = el.getTag(\"title\");\n                if(!song.title) {\n                    song.title = \"<no name>\";\n                    debug(\"  WARNING!\", song.name, \"has no title!\");\n                }\n\n                song.rhythm = el.getTag(\"rhythm\");\n                if(!song.rhythm) {\n                    song.rhythm = \"..no..rhythm..\";\n                    debug(\"  WARNING!!\", song.name, \"has no rhythm!!\");\n                }\n\n                song.buildupName = el.getTag(\"buildup\");\n                if(song.buildupName) {\n                    debug(\"  Finding a buildup '\" + song.buildupName + \"' for \", song.name);\n                    let build = this.getSong(song.buildupName);\n                    if(build) {\n                        song.buildup = build.sound;\n                        song.buildupPlayed = false;\n                        // get rid of the junk\n                        this.songs.splice(this.songs.indexOf(build), 1);\n                    } else {\n                        debug(\"  WARNING!\", \"Didn't find a buildup '\" + song.buildupName + \"'!\");\n                    }\n                }\n\n                song.buildupRhythm = el.getTag(\"buildupRhythm\");\n                song.independentBuild = el.getTag(\"independentBuild\");\n                song.source = el.getTag(\"source\");\n                song.charsPerBeat = parseFloat(el.getTag(\"charsPerBeat\"));\n\n                // Because PackShit breaks everything\n                if(this.name == \"PackShit\") {\n                    song.forceTrim  = true;\n                }\n                newSongs.push(song);\n                debug(\"  [I] \" + song.name, \": '\" + song.title + \"' added to songs\");\n            } else {\n                debug(\"  WARNING!\", \"songs.xml: <song> element\", \n                    + el.attributes[0].value + \"- no song found\");\n            }\n        }\n        for(let i = 0; i < this.songs.length; i++) {\n            if(newSongs.indexOf(this.songs[i]) == -1) {\n                debug(\"  WARNING!\", \"We have a file for\", this.songs[i].name, \"but no information for it\");\n            }\n        }\n        this.songs = newSongs;\n    }\n\n    parseInfoFile(dom) {\n        debug(\" - Parsing infoFile\");\n\n        let info = dom.documentElement;\n\n        // self reference strings to avoid changing strings twice in future\n        this.name = info.getTag(\"name\", this.name);\n        this.author = info.getTag(\"author\", this.author);\n        this.description = info.getTag(\"description\", this.description);\n        this.link = info.getTag(\"link\", this.link);\n    }\n\n    parseImageFile(dom) {\n        debug(\" - Parsing imagefile\");\n\n        let newImages = [];\n        let el = dom.documentElement.firstElementChild;\n        for(; el; el = el.nextElementSibling) {\n            let image = this.getImage(el.attributes[0].value);\n            if(image) {\n                image.fullname = el.getTag(\"fullname\");\n                if(!image.fullname) {\n                    debug(\"  WARNING!\", image.name, \"has no full name!\");\n                }\n                image.source = el.getTag(\"source\");\n                // self reference defaults to avoid changing strings twice in future\n                image.align = el.getTag(\"align\", image.align);\n                image.beatsPerAnim = parseFloat(el.getTag(\"beatsPerAnim\"));\n                image.syncOffset = parseFloat(el.getTag(\"syncOffset\"));\n                let frameDur = el.getTag(\"frameDuration\");\n                if(frameDur) {\n                    image.frameDurations = [];\n                    let strSplit = frameDur.split(\",\");\n                    for(let j = 0; j < strSplit.length; j++) {\n                        image.frameDurations.push(parseInt(strSplit[j]));\n                    }\n                    while (image.frameDurations.length < image.bitmaps.length) {\n                        image.frameDurations.push(image.frameDurations[image.frameDurations.length - 1]);\n                    }\n                    debug(\"Frame durations:\", image.frameDurations);\n                }\n                debug(\"  [I] \" + image.name, \":\", image.fullname, \"added to images\");\n                if (image.bitmap || image.bitmaps) {\n                    newImages.push(image);\n                }\n                else {\n                    debug(\"  WARNING!!\", \"Image\", image.name, \"has no bitmap nor animation frames!\");\n                }\n            } else {\n                debug(\"  WARNING!\", \"images.xml: no image '\" + el.attributes[0].value + \"' found\");\n            }\n        }\n        for(let i = 0; i < this.images.length; i++) {\n            let image = this.images[i];\n            // Add all images with no info\n            if(newImages.indexOf(image) == -1) {\n                newImages.push(image);\n            }\n        }\n        newImages.sort(function(a, b) {\n            return a.name.localeCompare(b.name);\n        });\n        this.images = newImages;\n    }\n\n    containsSong(name) {\n        return this.getSong(name) !== null;\n    }\n\n    containsImage(name) {\n        return this.getImage(name) !== null;\n    }\n\n    getSong(name) {\n        for(let i = 0; i < this.songs.length; i++) {\n            if (name == this.songs[i].name) {\n                return this.songs[i];\n            }\n        }\n        return null;\n    }\n\n    getImage(name) {\n        for(let i = 0; i < this.images.length; i++) {\n            if (name == this.images[i].name) {\n                return this.images[i];\n            }\n        }\n        return null;\n    }\n}\n\nwindow.Respack = Respack;\n\n// Save some chars\nElement.prototype.getTag = function(tag, def) {\n    let t = this.getElementsByTagName(tag)[0];\n    return t ? t.textContent : (def ? def : null);\n};\n\n})(window, document);","/* Copyright (c) 2015 William Toohey <will@mon.im>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\n(function(window, document) {\n\"use strict\";\n\nclass SoundManager {\n    constructor(core) {\n        // Perhaps this will do more later\n        this.eventListeners = {\n            /* callback seek()\n            *\n            * Called when the audio has been seeked - reset time determined transforms\n            */\n            seek : []\n        };\n        \n        this.core = core;\n        this.playing = false;\n        this.playbackRate = 1;\n        this.song = null;\n        \n        this.initPromise = null;\n        this.lockedPromise = null;\n        this.locked = true;\n\n        /* Lower level audio and timing info */\n        this.context = null; // Audio context, Web Audio API\n        this.oggSupport = false;\n        this.buildSource = null;\n        this.loopSource = null;\n        this.buildup = null;\n        this.loop = null;\n        this.startTime = 0;  // File start time - 0 is loop start, not build start\n        this.buildLength = 0;\n        this.loopLength = 0; // For calculating beat lengths\n\n        // Volume\n        this.gainNode = null;\n        this.mute = false;\n        this.lastVol = 1;\n        \n        // Visualiser\n        this.vReady = false;\n        this.vBars = 0;\n        this.vTotalBars = 0;\n        this.splitter = null;\n        this.analysers = [];\n        this.analyserArrays = [];\n        this.logArrays = [];\n        this.binCutoffs = [];\n        this.linBins = 0;\n        this.logBins = 0;\n        this.maxBinLin = 0;\n    }\n    \n    callEventListeners(ev) {\n        let args = Array.prototype.slice.call(arguments, 1);\n        this.eventListeners[ev].forEach(function(callback) {\n            callback.apply(null, args);\n        });\n    }\n\n    addEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev].push(callback);\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n\n    removeEventListener(ev, callback) {\n        ev = ev.toLowerCase();\n        if (typeof(this.eventListeners[ev]) !== \"undefined\") {\n            this.eventListeners[ev] = this.eventListeners[ev].filter(function(a) {\n                return (a !== callback);\n            });\n        } else {\n            throw Error(\"Unknown event: \" + ev);\n        }\n    }\n\n    init() {\n        if(!this.initPromise) {\n            this.initPromise = new Promise((resolve, reject) => {\n                // Check Web Audio API Support\n                try {\n                    // More info at http://caniuse.com/#feat=audio-api\n                    window.AudioContext = window.AudioContext || window.webkitAudioContext;\n                    // These don't always exist\n                    AudioContext.prototype.suspend = AudioContext.prototype.suspend || (() => {return Promise.resolve();});\n                    AudioContext.prototype.resume = AudioContext.prototype.resume || (() => {return Promise.resolve();});\n                    \n                    this.context = new window.AudioContext();\n                    this.gainNode = this.context.createGain();\n                    this.gainNode.connect(this.context.destination);\n                } catch(e) {\n                    reject(Error(\"Web Audio API not supported in this browser.\"));\n                    return;\n                }\n                resolve();\n            }).then(() => {\n                // check for .ogg support - if not, we'll have to load the ogg decoder\n                return new Promise((resolve, reject) => {\n                    this.context.decodeAudioData(miniOgg, success => {\n                            this.oggSupport = true;\n                            resolve();\n                        }, error => {\n                            this.oggSupport = false;\n                            resolve();\n                    });\n                });\n            }).then(() => {\n                return new Promise((resolve, reject) => {          \n                    // See if our audio decoder is working\n                    let audioWorker;\n                    try {\n                        audioWorker = this.createWorker();\n                    } catch(e) {\n                        console.log(e);\n                        reject(Error(\"Audio Worker cannot be started - correct path set in defaults?\"));\n                        return;\n                    }\n                    let pingListener = event => {\n                        audioWorker.terminate();\n                        resolve();\n                    };\n                    audioWorker.addEventListener('message', pingListener, false);\n                    audioWorker.addEventListener('error', () => {\n                        reject(Error(\"Audio Worker cannot be started - correct path set in defaults?\"));\n                    }, false);\n                    audioWorker.postMessage({ping:true, ogg:this.oggSupport});\n                });\n            }).then(() => {\n                this.locked = this.context.state != \"running\";\n            });\n        }\n        return this.initPromise;\n    }\n\n    unlock() {\n        if(this.lockedPromise) {\n            return this.lockedPromise;\n        }\n        this.lockedPromise = new Promise((resolve, reject) => {\n            // iOS and other some mobile browsers - unlock the context as\n            // it starts in a suspended state\n            let unlocker = () => {\n                // create empty buffer\n                let buffer = this.context.createBuffer(1, 1, 22050);\n                let source =  this.context.createBufferSource();\n                source.buffer = buffer;\n\n                // connect to output (your speakers)\n                source.connect( this.context.destination);\n\n                // play the file\n                source.start(0);\n                \n                window.removeEventListener('touchend', unlocker);\n                window.removeEventListener('click', unlocker);\n                this.core.clearMessage();\n                resolve();\n            };\n            window.addEventListener('touchend', unlocker, false);\n            window.addEventListener('click', unlocker, false);\n        });\n        return this.lockedPromise;\n    }\n\n    playSong(song, playBuild, forcePlay) {\n        let p = Promise.resolve();\n        // Editor forces play on audio updates\n        if(this.song == song && !forcePlay) {\n            return p;\n        }\n        this.stop();\n        this.song = song;\n        if(!song || (!song.sound)) { // null song\n            return p;\n        }\n        \n        // if there's a fadeout happening from AutoSong, kill it\n        this.gainNode.gain.cancelScheduledValues(0);\n        // Reset original volume\n        this.setVolume(this.lastVol);\n        if(this.mute) {\n            this.setMute(true);\n        }\n\n        p = p.then(() => {\n            return this.loadSong(song);\n        }).then(buffers => {\n            // To prevent race condition if you press \"next\" twice fast\n            if(song != this.song) {\n                return Promise.reject(\"Song changed between load and play - this message can be ignored\");\n            }\n            \n            this.buildup = buffers.buildup;\n            this.buildLength = this.buildup ? this.buildup.duration : 0;\n            this.loop = buffers.loop;\n            this.loopLength = this.loop.duration;\n\n            // This fixes sync issues on Firefox and slow machines.\n            return this.context.suspend();\n        }).then(() => {\n            if(playBuild) {\n                this.seek(-this.buildLength, true);\n            } else {\n                this.seek(0, true);\n            }\n            \n            return this.context.resume();\n        }).then(() => {\n            this.playing = true;\n        });\n        return p;\n    }\n\n    stop(dontDeleteBuffers) {\n        if (this.playing) {\n            if(this.buildSource) {\n                this.buildSource.stop(0);\n                this.buildSource.disconnect();\n                this.buildSource = null;\n                if(!dontDeleteBuffers)\n                    this.buildup = null;\n            }        \n            // arg required for mobile webkit\n            this.loopSource.stop(0);\n             // TODO needed?\n            this.loopSource.disconnect();\n            this.loopSource = null;\n            if(!dontDeleteBuffers)\n                this.loop = null;\n            this.vReady = false;\n            this.playing = false;\n            this.startTime = 0;\n        }\n    }\n\n    setRate(rate) {\n        // Double speed is more than enough. Famous last words?\n        rate = Math.max(Math.min(rate, 2), 0.25);\n        \n        let time = this.clampedTime;\n        this.playbackRate = rate;\n        this.seek(time);\n    }\n\n    seek(time, noPlayingUpdate) {\n        if(!this.song) {\n            return;\n        }\n        \n        this.callEventListeners(\"seek\");\n        \n        //console.log(\"Seeking to \" + time);\n        // Clamp the blighter\n        time = Math.min(Math.max(time, -this.buildLength), this.loopLength);\n        \n        this.stop(true);\n        \n        if(!this.loop) {\n            return;\n        }\n            \n        this.loopSource = this.context.createBufferSource();\n        this.loopSource.buffer = this.loop;\n        this.loopSource.playbackRate.value = this.playbackRate;\n        this.loopSource.loop = true;\n        this.loopSource.loopStart = 0;\n        this.loopSource.loopEnd = this.loopLength;\n        this.loopSource.connect(this.gainNode);\n        \n        if(time < 0 && this.buildup) {\n            this.buildSource = this.context.createBufferSource();\n            this.buildSource.buffer = this.buildup;\n            this.buildSource.playbackRate.value = this.playbackRate;\n            this.buildSource.connect(this.gainNode);\n            this.buildSource.start(0, this.buildLength + time);\n            this.loopSource.start(this.context.currentTime - (time / this.playbackRate));\n        } else {\n            this.loopSource.start(0, time);\n        }\n        \n        this.startTime = this.context.currentTime - (time / this.playbackRate);\n        if(!noPlayingUpdate) {\n            this.playing = true;\n        }\n        this.initVisualiser();\n        this.core.recalcBeatIndex();\n    }\n\n    // In seconds, relative to the loop start\n    get currentTime() {\n        if(!this.playing) {\n            return 0;\n        }\n        return (this.context.currentTime - this.startTime) * this.playbackRate;\n    }\n\n    get clampedTime() {\n        let time = this.currentTime;\n        \n        if(time > 0) {\n            time %= this.loopLength;\n        }\n        return time;\n    }\n\n    loadSong(song) {\n        if(song._loadPromise) {\n            /* Caused when moving back/forwards rapidly.\n               The sound is still loading. We reject this promise, and the already\n               running decode will finish and resolve instead.\n               NOTE: If anything but playSong calls loadSong, this idea is broken. */\n            return Promise.reject(\"Song changed between load and play - this message can be ignored\");\n        }\n        \n        let buffers = {loop: null, buildup: null};\n        \n        let promises = [this.loadBuffer(song, \"sound\").then(buffer => {\n            buffers.loop = buffer;\n        })];\n        if(song.buildup) {\n            promises.push(this.loadBuffer(song, \"buildup\").then(buffer => {\n                buffers.buildup = buffer;\n            }));\n        } else {\n            this.buildLength = 0;\n        }\n        song._loadPromise = Promise.all(promises)\n        .then(() => {\n            song._loadPromise = null;\n            return buffers;\n        });\n        return song._loadPromise;\n    }\n\n    loadBuffer(song, soundName) {\n        let buffer = song[soundName];\n        \n        // Is this an ogg file?\n        let view = new Uint8Array(buffer);\n        // Signature for ogg file: OggS\n        if(this.oggSupport && view[0] == 0x4F && view[1] == 0x67 && view[2] == 0x67 && view[3] == 0x53) {\n            // As we don't control decodeAudioData, we cannot do fast transfers and must copy\n            let backup = buffer.slice(0);\n            return new Promise((resolve, reject) => {\n                this.context.decodeAudioData(buffer, result => {\n                        resolve(result);\n                    }, error => {\n                        reject(Error(\"decodeAudioData failed to load track\"));\n                });\n            }).then(result => {\n                // restore copied buffer\n                song[soundName] = backup;\n                return result;\n            });\n        } else { // Use our JS decoder\n            return new Promise((resolve, reject) => {\n                let audioWorker = this.createWorker();\n                \n                audioWorker.addEventListener('error', () => {\n                    reject(Error(\"Audio Worker failed to convert track\"));\n                }, false);\n                \n                audioWorker.addEventListener('message', e => {\n                    let decoded = e.data;\n                    audioWorker.terminate();\n                    \n                    // restore transferred buffer\n                    song[soundName] = decoded.arrayBuffer;\n                    if(decoded.error) {\n                        reject(new Error(decoded.error));\n                        return;\n                    }\n                    // Convert to real audio buffer\n                    let audio = this.audioBufFromRaw(decoded.rawAudio);\n                    resolve(audio);\n                }, false);\n                \n                // transfer the buffer to save time\n                audioWorker.postMessage({buffer: buffer, ogg: this.oggSupport}, [buffer]);\n            });\n       }\n\n    }\n\n    // Converts continuous PCM array to Web Audio API friendly format\n    audioBufFromRaw(raw) {\n        let buffer = raw.array;\n        let channels = raw.channels;\n        let samples = buffer.length/channels;\n        let audioBuf = this.context.createBuffer(channels, samples, raw.sampleRate);\n        for(let i = 0; i < channels; i++) {\n            // Offset is in bytes, length is in elements\n            let channel = new Float32Array(buffer.buffer , i * samples * 4, samples);\n            // Most browsers\n            if(typeof audioBuf.copyToChannel === \"function\") {\n                audioBuf.copyToChannel(channel, i, 0);\n            } else { // Safari, Edge sometimes\n                audioBuf.getChannelData(i).set(channel);\n            }\n        }\n        return audioBuf;\n    }\n\n    createWorker() {\n        return new Worker(this.core.settings.defaults.workersPath + 'audio-worker.js');\n    }\n\n    initVisualiser(bars) {\n        // When restarting the visualiser\n        if(!bars) {\n            bars = this.vTotalBars;\n        }\n        this.vReady = false;\n        this.vTotalBars = bars;\n        for(let i = 0; i < this.analysers.length; i++) {\n            this.analysers[i].disconnect();\n        }\n        if(this.splitter) {\n            this.splitter.disconnect();\n            this.splitter = null;\n        }\n        this.analysers = [];\n        this.analyserArrays = [];\n        this.logArrays = [];\n        this.binCutoffs = [];\n        \n        this.linBins = 0;\n        this.logBins = 0;\n        this.maxBinLin = 0;\n        \n        this.attachVisualiser();\n    }\n\n    attachVisualiser() {\n        if(!this.playing || this.vReady) {\n            return;\n        }\n\n        // Get our info from the loop\n        let channels = this.loopSource.channelCount;\n        // In case channel counts change, this is changed each time\n        this.splitter = this.context.createChannelSplitter(channels);\n        // Connect to the gainNode so we get buildup stuff too\n        this.loopSource.connect(this.splitter);\n        if(this.buildSource) {\n            this.buildSource.connect(this.splitter);\n        }\n        // Split display up into each channel\n        this.vBars = Math.floor(this.vTotalBars/channels);\n        \n        for(let i = 0; i < channels; i++) {\n            let analyser = this.context.createAnalyser();\n            // big fft buffers are new-ish\n            try {\n                analyser.fftSize = 8192;\n            } catch(err) {\n                analyser.fftSize = 2048;\n            }\n            // Chosen because they look nice, no maths behind it\n            analyser.smoothingTimeConstant = 0.6;\n            analyser.minDecibels = -70;\n            analyser.maxDecibels = -25;\n            this.analyserArrays.push(new Uint8Array(analyser.frequencyBinCount));\n            analyser.getByteTimeDomainData(this.analyserArrays[i]);\n            this.splitter.connect(analyser, i);   \n            this.analysers.push(analyser);\n            this.logArrays.push(new Uint8Array(this.vBars));\n        }\n        let binCount = this.analysers[0].frequencyBinCount;\n        let binWidth = this.loopSource.buffer.sampleRate / binCount;\n        // first 2kHz are linear\n        this.maxBinLin = Math.floor(2000/binWidth);\n        // Don't stretch the first 2kHz, it looks awful\n        this.linBins = Math.min(this.maxBinLin, Math.floor(this.vBars/2));\n        // Only go up to 22KHz\n        let maxBinLog = Math.floor(22000/binWidth);\n        let logBins = this.vBars - this.linBins;\n\n        let logLow = Math.log2(2000);\n        let logDiff = Math.log2(22000) - logLow;\n        for(let i = 0; i < logBins; i++) {\n            let cutoff = i * (logDiff/logBins) + logLow;\n            let freqCutoff = Math.pow(2, cutoff);\n            let binCutoff = Math.floor(freqCutoff / binWidth);\n            this.binCutoffs.push(binCutoff);\n        }\n        this.vReady = true;\n    }\n\n    sumArray(array, low, high) {\n        let total = 0;\n        for(let i = low; i <= high; i++) {\n            total += array[i];\n        }\n        return total/(high-low+1);\n    }\n\n    getVisualiserData() {\n        if(!this.vReady) {\n            return null;\n        }\n        for(let a = 0; a < this.analyserArrays.length; a++) {\n            let data = this.analyserArrays[a];\n            let result = this.logArrays[a];\n            this.analysers[a].getByteFrequencyData(data);\n            \n            for(let i = 0; i < this.linBins; i++) {\n                let scaled = Math.round(i * this.maxBinLin / this.linBins);\n                result[i] = data[scaled];\n            }\n            result[this.linBins] = data[this.binCutoffs[0]];\n            for(let i = this.linBins+1; i < this.vBars; i++) {\n                let cutoff = i - this.linBins;\n                result[i] = this.sumArray(data, this.binCutoffs[cutoff-1], \n                                                this.binCutoffs[cutoff]);\n            }\n        }\n        return this.logArrays;\n    }\n\n    setMute(mute) {\n        if(!this.mute && mute) { // muting\n            this.lastVol = this.gainNode.gain.value;\n        }\n        if(mute) {\n            this.gainNode.gain.value = 0;\n        } else {\n            this.gainNode.gain.value = this.lastVol;\n        }\n        this.core.userInterface.updateVolume(this.gainNode.gain.value);\n        this.mute = mute;\n        return mute;\n    }\n\n    toggleMute() {\n        return this.setMute(!this.mute);\n    }\n\n    decreaseVolume() {\n        this.setMute(false);\n        let val = Math.max(this.gainNode.gain.value - 0.1, 0);\n        this.setVolume(val);\n    }\n\n    increaseVolume() {\n        this.setMute(false);\n        let val = Math.min(this.gainNode.gain.value + 0.1, 1);\n        this.setVolume(val);\n    }\n\n    setVolume(vol) {\n        this.gainNode.gain.value = vol;\n        this.lastVol = vol;\n        this.core.userInterface.updateVolume(vol);\n    }\n\n    fadeOut(callback) {\n        if(!this.mute) {\n            // Firefox hackery\n            this.gainNode.gain.setValueAtTime(this.lastVol, this.context.currentTime);\n            this.gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 2);\n        }\n        setTimeout(callback, 2000);\n    }\n}\n\nlet miniOggRaw = \n\"T2dnUwACAAAAAAAAAADFYgAAAAAAAMLKRdwBHgF2b3JiaXMAAAAAAUSsAAAA\" +\n\"AAAAgLsAAAAAAAC4AU9nZ1MAAAAAAAAAAAAAxWIAAAEAAACcKCV2Dzv/////\" +\n\"////////////MgN2b3JiaXMrAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAx\" +\n\"MjAyMDMgKE9tbmlwcmVzZW50KQAAAAABBXZvcmJpcx9CQ1YBAAABABhjVClG\" +\n\"mVLSSokZc5QxRplikkqJpYQWQkidcxRTqTnXnGusubUghBAaU1ApBZlSjlJp\" +\n\"GWOQKQWZUhBLSSV0EjonnWMQW0nB1phri0G2HIQNmlJMKcSUUopCCBlTjCnF\" +\n\"lFJKQgcldA465hxTjkooQbicc6u1lpZji6l0kkrnJGRMQkgphZJKB6VTTkJI\" +\n\"NZbWUikdc1JSakHoIIQQQrYghA2C0JBVAAABAMBAEBqyCgBQAAAQiqEYigKE\" +\n\"hqwCADIAAASgKI7iKI4jOZJjSRYQGrIKAAACABAAAMBwFEmRFMmxJEvSLEvT\" +\n\"RFFVfdU2VVX2dV3XdV3XdSA0ZBUAAAEAQEinmaUaIMIMZBgIDVkFACAAAABG\" +\n\"KMIQA0JDVgEAAAEAAGIoOYgmtOZ8c46DZjloKsXmdHAi1eZJbirm5pxzzjkn\" +\n\"m3PGOOecc4pyZjFoJrTmnHMSg2YpaCa05pxznsTmQWuqtOacc8Y5p4NxRhjn\" +\n\"nHOatOZBajbW5pxzFrSmOWouxeaccyLl5kltLtXmnHPOOeecc84555xzqhen\" +\n\"c3BOOOecc6L25lpuQhfnnHM+Gad7c0I455xzzjnnnHPOOeecc4LQkFUAABAA\" +\n\"AEEYNoZxpyBIn6OBGEWIacikB92jwyRoDHIKqUejo5FS6iCUVMZJKZ0gNGQV\" +\n\"AAAIAAAhhBRSSCGFFFJIIYUUUoghhhhiyCmnnIIKKqmkoooyyiyzzDLLLLPM\" +\n\"Muuws8467DDEEEMMrbQSS0211VhjrbnnnGsO0lpprbXWSimllFJKKQgNWQUA\" +\n\"gAAAEAgZZJBBRiGFFFKIIaaccsopqKACQkNWAQCAAAACAAAAPMlzREd0REd0\" +\n\"REd0REd0RMdzPEeUREmUREm0TMvUTE8VVdWVXVvWZd32bWEXdt33dd/3dePX\" +\n\"hWFZlmVZlmVZlmVZlmVZlmVZgtCQVQAACAAAgBBCCCGFFFJIIaUYY8wx56CT\" +\n\"UEIgNGQVAAAIACAAAADAURzFcSRHciTJkixJkzRLszzN0zxN9ERRFE3TVEVX\" +\n\"dEXdtEXZlE3XdE3ZdFVZtV1Ztm3Z1m1flm3f933f933f933f933f93UdCA1Z\" +\n\"BQBIAADoSI6kSIqkSI7jOJIkAaEhqwAAGQAAAQAoiqM4juNIkiRJlqRJnuVZ\" +\n\"omZqpmd6qqgCoSGrAABAAAABAAAAAAAomuIppuIpouI5oiNKomVaoqZqriib\" +\n\"suu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6ruu6LhAasgoAkAAA\" +\n\"0JEcyZEcSZEUSZEcyQFCQ1YBADIAAAIAcAzHkBTJsSxL0zzN0zxN9ERP9ExP\" +\n\"FV3RBUJDVgEAgAAAAgAAAAAAMCTDUixHczRJlFRLtVRNtVRLFVVPVVVVVVVV\" +\n\"VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVNU3TNE0gNGQlAAAEAMBijcHl\" +\n\"ICElJeXeEMIQk54xJiG1XiEEkZLeMQYVg54yogxy3kLjEIMeCA1ZEQBEAQAA\" +\n\"xiDHEHPIOUepkxI556h0lBrnHKWOUmcpxZhizSiV2FKsjXOOUketo5RiLC12\" +\n\"lFKNqcYCAAACHAAAAiyEQkNWBABRAACEMUgppBRijDmnnEOMKeeYc4Yx5hxz\" +\n\"jjnnoHRSKuecdE5KxBhzjjmnnHNSOieVc05KJ6EAAIAABwCAAAuh0JAVAUCc\" +\n\"AIBBkjxP8jRRlDRPFEVTdF1RNF3X8jzV9ExTVT3RVFVTVW3ZVFVZljzPND3T\" +\n\"VFXPNFXVVFVZNlVVlkVV1W3TdXXbdFXdlm3b911bFnZRVW3dVF3bN1XX9l3Z\" +\n\"9n1Z1nVj8jxV9UzTdT3TdGXVdW1bdV1d90xTlk3XlWXTdW3blWVdd2XZ9zXT\" +\n\"dF3TVWXZdF3ZdmVXt11Z9n3TdYXflWVfV2VZGHZd94Vb15XldF3dV2VXN1ZZ\" +\n\"9n1b14Xh1nVhmTxPVT3TdF3PNF1XdV1fV13X1jXTlGXTdW3ZVF1ZdmXZ911X\" +\n\"1nXPNGXZdF3bNl1Xll1Z9n1XlnXddF1fV2VZ+FVX9nVZ15Xh1m3hN13X91VZ\" +\n\"9oVXlnXh1nVhuXVdGD5V9X1TdoXhdGXf14XfWW5dOJbRdX1hlW3hWGVZOX7h\" +\n\"WJbd95VldF1fWG3ZGFZZFoZf+J3l9n3jeHVdGW7d58y67wzH76T7ytPVbWOZ\" +\n\"fd1ZZl93juEYOr/w46mqr5uuKwynLAu/7evGs/u+soyu6/uqLAu/KtvCseu+\" +\n\"8/y+sCyj7PrCasvCsNq2Mdy+biy/cBzLa+vKMeu+UbZ1fF94CsPzdHVdeWZd\" +\n\"x/Z1dONHOH7KAACAAQcAgAATykChISsCgDgBAI8kiaJkWaIoWZYoiqbouqJo\" +\n\"uq6kaaapaZ5pWppnmqZpqrIpmq4saZppWp5mmpqnmaZomq5rmqasiqYpy6Zq\" +\n\"yrJpmrLsurJtu65s26JpyrJpmrJsmqYsu7Kr267s6rqkWaapeZ5pap5nmqZq\" +\n\"yrJpmq6reZ5qep5oqp4oqqpqqqqtqqosW55nmproqaYniqpqqqatmqoqy6aq\" +\n\"2rJpqrZsqqptu6rs+rJt67ppqrJtqqYtm6pq267s6rIs27ovaZppap5nmprn\" +\n\"maZpmrJsmqorW56nmp4oqqrmiaZqqqosm6aqypbnmaoniqrqiZ5rmqoqy6Zq\" +\n\"2qppmrZsqqotm6Yqy65t+77ryrJuqqpsm6pq66ZqyrJsy77vyqruiqYpy6aq\" +\n\"2rJpqrIt27Lvy7Ks+6JpyrJpqrJtqqouy7JtG7Ns+7pomrJtqqYtm6oq27It\" +\n\"+7os27rvyq5vq6qs67It+7ru+q5w67owvLJs+6qs+ror27pv6zLb9n1E05Rl\" +\n\"UzVt21RVWXZl2fZl2/Z90TRtW1VVWzZN1bZlWfZ9WbZtYTRN2TZVVdZN1bRt\" +\n\"WZZtYbZl4XZl2bdlW/Z115V1X9d949dl3ea6su3Lsq37qqv6tu77wnDrrvAK\" +\n\"AAAYcAAACDChDBQashIAiAIAAIxhjDEIjVLOOQehUco55yBkzkEIIZXMOQgh\" +\n\"lJI5B6GUlDLnIJSSUgihlJRaCyGUlFJrBQAAFDgAAATYoCmxOEChISsBgFQA\" +\n\"AIPjWJbnmaJq2rJjSZ4niqqpqrbtSJbniaJpqqptW54niqapqq7r65rniaJp\" +\n\"qqrr6rpomqapqq7ruroumqKpqqrrurKum6aqqq4ru7Ls66aqqqrryq4s+8Kq\" +\n\"uq4ry7Jt68Kwqq7ryrJs27Zv3Lqu677v+8KRreu6LvzCMQxHAQDgCQ4AQAU2\" +\n\"rI5wUjQWWGjISgAgAwCAMAYhgxBCBiGEkFJKIaWUEgAAMOAAABBgQhkoNGRF\" +\n\"ABAnAAAYQymklFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSCmllFJKKaWU\" +\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSqmklFJKKaWU\" +\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWU\" +\n\"UkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimVUkoppZRS\" +\n\"SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRS\" +\n\"SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFIKAJCKcACQejCh\" +\n\"DBQashIASAUAAIxRSinGnIMQMeYYY9BJKClizDnGHJSSUuUchBBSaS23yjkI\" +\n\"IaTUUm2Zc1JaizHmGDPnpKQUW805h1JSi7HmmmvupLRWa64151paqzXXnHPN\" +\n\"ubQWa64515xzyzHXnHPOOecYc84555xzzgUA4DQ4AIAe2LA6wknRWGChISsB\" +\n\"gFQAAAIZpRhzzjnoEFKMOecchBAihRhzzjkIIVSMOeccdBBCqBhzzDkIIYSQ\" +\n\"OecchBBCCCFzDjroIIQQQgcdhBBCCKGUzkEIIYQQSighhBBCCCGEEDoIIYQQ\" +\n\"QgghhBBCCCGEUkoIIYQQQgmhlFAAAGCBAwBAgA2rI5wUjQUWGrISAAACAIAc\" +\n\"lqBSzoRBjkGPDUHKUTMNQkw50ZliTmozFVOQORCddBIZakHZXjILAACAIAAg\" +\n\"wAQQGCAo+EIIiDEAAEGIzBAJhVWwwKAMGhzmAcADRIREAJCYoEi7uIAuA1zQ\" +\n\"xV0HQghCEIJYHEABCTg44YYn3vCEG5ygU1TqIAAAAAAADADgAQDgoAAiIpqr\" +\n\"sLjAyNDY4OjwCAAAAAAAFgD4AAA4PoCIiOYqLC4wMjQ2ODo8AgAAAAAAAAAA\" +\n\"gICAAAAAAABAAAAAgIBPZ2dTAAQBAAAAAAAAAMViAAACAAAA22A/JwIBAQAK\";\n\n// write the bytes of the string to an ArrayBuffer\nlet miniOggBin = atob(miniOggRaw);\nlet miniOgg = new ArrayBuffer(miniOggBin.length);\nlet view = new Uint8Array(miniOgg);\nfor (var i = 0; i < miniOggBin.length; i++) {\n    view[i] = miniOggBin.charCodeAt(i);\n}\n\nwindow.SoundManager = SoundManager;\n\n})(window, document);","// String Scoring Algorithm 0.1.22 | (c) 2009-2015 Joshaven Potter <yourtech@gmail.com>\n// MIT License: http://opensource.org/licenses/MIT | https://github.com/joshaven/string_score\nString.prototype.score=function(e,f){if(this===e)return 1;if(\"\"===e)return 0;var d=0,a,g=this.toLowerCase(),n=this.length,h=e.toLowerCase(),k=e.length,b;a=0;var l=1,m,c;f&&(m=1-f);if(f)for(c=0;c<k;c+=1)b=g.indexOf(h[c],a),-1===b?l+=m:(a===b?a=.7:(a=.1,\" \"===this[b-1]&&(a+=.8)),this[b]===e[c]&&(a+=.1),d+=a,a=b+1);else for(c=0;c<k;c+=1){b=g.indexOf(h[c],a);if(-1===b)return 0;a===b?a=.7:(a=.1,\" \"===this[b-1]&&(a+=.8));this[b]===e[c]&&(a+=.1);d+=a;a=b+1}d=.5*(d/n+d/k)/l;h[0]===g[0]&&.85>d&&(d+=.15);return d};\n"]}